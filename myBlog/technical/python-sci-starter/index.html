<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Python 科学计算入门 | SJTU-XHW's blog</title><meta name="author" content="SJTU-XHW,sjtuxhw12345@sjtu.edu.cn"><meta name="copyright" content="SJTU-XHW"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="0.1 NumPyNumpy 库是 Python 科学计算的核心。 Numpy Array 是一个存放相同数据类型的数组（类型 numpy.ndarray），可以使用非负元组（Non-negative tuple）来索引。 我们称 Rank 为数组的维数，Shape 表示数组的各个维度的大小，使用整型元组表示。 0.1.1 Array Creation初始化 Numpy Array 的方法如下：">
<meta property="og:type" content="article">
<meta property="og:title" content="Python 科学计算入门">
<meta property="og:url" content="https://blog.sjtuxhw.top/technical/python-sci-starter/index.html">
<meta property="og:site_name" content="SJTU-XHW&#39;s blog">
<meta property="og:description" content="0.1 NumPyNumpy 库是 Python 科学计算的核心。 Numpy Array 是一个存放相同数据类型的数组（类型 numpy.ndarray），可以使用非负元组（Non-negative tuple）来索引。 我们称 Rank 为数组的维数，Shape 表示数组的各个维度的大小，使用整型元组表示。 0.1.1 Array Creation初始化 Numpy Array 的方法如下：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.sjtuxhw.top/cover_imgs/python_sci.jpg">
<meta property="article:published_time" content="2024-11-03T11:08:13.000Z">
<meta property="article:modified_time" content="2024-11-10T11:17:11.085Z">
<meta property="article:author" content="SJTU-XHW">
<meta property="article:tag" content="Programming">
<meta property="article:tag" content="Math">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.sjtuxhw.top/cover_imgs/python_sci.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://blog.sjtuxhw.top/technical/python-sci-starter/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功 ヾ(≧∇≦*)ゝ',
    error: '复制失败 (#`皿´)',
    noSupport: '浏览器不支持 ╮(╯_╰)╭'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#333","bgDark":"#1f1f1f","position":"top-center"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Python 科学计算入门',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-10 19:17:11'
}</script><link rel="stylesheet" href="/css/mouseConfig.css"/><link rel="stylesheet" href="/css/rightmenu.css"/><link rel="stylesheet" href="/css/custom_music.css"/><link rel="stylesheet" href="/css/addFonts.css"/><link rel="stylesheet" href="/css/titleFonts.css"/><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="SJTU-XHW's blog" type="application/atom+xml">
</head><body><div id="loading-box"><div id="main-loading-bg"><div class="truckWrapper"><div class="truckBody"><svg class="trucksvg" viewBox="0 0 198 93" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M135 22.5H177.264C178.295 22.5 179.22 23.133 179.594 24.0939L192.33 56.8443C192.442 57.1332 192.5 57.4404 192.5 57.7504V89C192.5 90.3807 191.381 91.5 190 91.5H135C133.619 91.5 132.5 90.3807 132.5 89V25C132.5 23.6193 133.619 22.5 135 22.5Z" fill="currentColor" stroke="#282828" stroke-width="3"></path><path d="M146 33.5H181.741C182.779 33.5 183.709 34.1415 184.078 35.112L190.538 52.112C191.16 53.748 189.951 55.5 188.201 55.5H146C144.619 55.5 143.5 54.3807 143.5 53V36C143.5 34.6193 144.619 33.5 146 33.5Z" fill="#7D7C7C" stroke="#282828" stroke-width="3"></path><path d="M150 65C150 65.39 149.763 65.8656 149.127 66.2893C148.499 66.7083 147.573 67 146.5 67C145.427 67 144.501 66.7083 143.873 66.2893C143.237 65.8656 143 65.39 143 65C143 64.61 143.237 64.1344 143.873 63.7107C144.501 63.2917 145.427 63 146.5 63C147.573 63 148.499 63.2917 149.127 63.7107C149.763 64.1344 150 64.61 150 65Z" fill="#282828" stroke="#282828" stroke-width="2"></path><rect x="187" y="63" width="5" height="7" rx="1" fill="#FFFCAB" stroke="#282828" stroke-width="2"></rect><rect x="193" y="81" width="4" height="11" rx="1" fill="#282828" stroke="#282828" stroke-width="2"></rect><rect x="6.5" y="1.5" width="121" height="90" rx="2.5" fill="#DFDFDF" stroke="#282828" stroke-width="3"></rect><rect x="1" y="84" width="6" height="4" rx="2" fill="#DFDFDF" stroke="#282828" stroke-width="2"></rect></svg></div><div class="truckTires"><svg class="tiresvg" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="13.5" fill="#282828" stroke="#282828" stroke-width="3"></circle><circle cx="15" cy="15" r="7" fill="#DFDFDF"></circle></svg><svg class="tiresvg" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="13.5" fill="#282828" stroke="#282828" stroke-width="3"></circle><circle cx="15" cy="15" r="7" fill="#DFDFDF"></circle></svg></div><div class="road"></div><svg class="lampPost" fill="currentColor" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 453.459 453.459" xml:space="preserve"><path d="M252.882,0c-37.781,0-68.686,29.953-70.245,67.358h-6.917v8.954c-26.109,2.163-45.463,10.011-45.463,19.366h9.993 c-1.65,5.146-2.507,10.54-2.507,16.017c0,28.956,23.558,52.514,52.514,52.514c28.956,0,52.514-23.558,52.514-52.514 c0-5.478-0.856-10.872-2.506-16.017h9.992c0-9.354-19.352-17.204-45.463-19.366v-8.954h-6.149C200.189,38.779,223.924,16,252.882,16 c29.952,0,54.32,24.368,54.32,54.32c0,28.774-11.078,37.009-25.105,47.437c-17.444,12.968-37.216,27.667-37.216,78.884v113.914 h-0.797c-5.068,0-9.174,4.108-9.174,9.177c0,2.844,1.293,5.383,3.321,7.066c-3.432,27.933-26.851,95.744-8.226,115.459v11.202h45.75 v-11.202c18.625-19.715-4.794-87.527-8.227-115.459c2.029-1.683,3.322-4.223,3.322-7.066c0-5.068-4.107-9.177-9.176-9.177h-0.795 V196.641c0-43.174,14.942-54.283,30.762-66.043c14.793-10.997,31.559-23.461,31.559-60.277C323.202,31.545,291.656,0,252.882,0z M232.77,111.694c0,23.442-19.071,42.514-42.514,42.514c-23.442,0-42.514-19.072-42.514-42.514c0-5.531,1.078-10.957,3.141-16.017 h78.747C231.693,100.736,232.77,106.162,232.77,111.694z"></path></svg></div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
      setTimeout(() => {
        $loadingBox.style.display = 'none'
      }, 800)
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()
</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.ico" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">50</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">63</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/dailyQ/"><i class="fa-fw fa-solid fa-pen-to-square"></i><span> DailyQuestion</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-gamepad"></i><span> ACG-Lab</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/ACGLab/MikuTap/"><i class="fa-fw fas fa-music"></i><span> MikuTap</span></a></li><li><a class="site-page child" href="/ACGLab/Live2D/"><i class="fa-fw fa-solid fa-face-kiss-wink-heart"></i><span> Live2D</span></a></li><li><a class="site-page child" href="/ACGLab/Folio-2019/"><i class="fa-fw fa-solid fa-car-side"></i><span> Folio-2019</span></a></li><li><a class="site-page child" href="/ACGLab/Cube/"><i class="fa-fw fa-solid fa-cube"></i><span> Cube</span></a></li><li><a class="site-page child" href="/ACGLab/TowerBlocks/"><i class="fa-fw fa-solid fa-gopuram"></i><span> TBlocks</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/friend-links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-camera"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.sjtuxhw.top/cover_imgs/python_sci.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/head_icon.png" alt="Logo"><span class="site-name">SJTU-XHW's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Python 科学计算入门</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/dailyQ/"><i class="fa-fw fa-solid fa-pen-to-square"></i><span> DailyQuestion</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-gamepad"></i><span> ACG-Lab</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/ACGLab/MikuTap/"><i class="fa-fw fas fa-music"></i><span> MikuTap</span></a></li><li><a class="site-page child" href="/ACGLab/Live2D/"><i class="fa-fw fa-solid fa-face-kiss-wink-heart"></i><span> Live2D</span></a></li><li><a class="site-page child" href="/ACGLab/Folio-2019/"><i class="fa-fw fa-solid fa-car-side"></i><span> Folio-2019</span></a></li><li><a class="site-page child" href="/ACGLab/Cube/"><i class="fa-fw fa-solid fa-cube"></i><span> Cube</span></a></li><li><a class="site-page child" href="/ACGLab/TowerBlocks/"><i class="fa-fw fa-solid fa-gopuram"></i><span> TBlocks</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/friend-links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-camera"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Python 科学计算入门</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-03T11:08:13.000Z" title="发表于 2024-11-03 19:08:13">2024-11-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-10T11:17:11.085Z" title="更新于 2024-11-10 19:17:11">2024-11-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/technical/">technical</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">4.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/technical/python-sci-starter/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="0-1-NumPy"><a href="#0-1-NumPy" class="headerlink" title="0.1 NumPy"></a>0.1 NumPy</h2><p><code>Numpy</code> 库是 Python 科学计算的核心。</p>
<p>Numpy Array 是一个存放相同数据类型的数组（类型 <code>numpy.ndarray</code>），可以使用非负元组（Non-negative tuple）来索引。</p>
<p>我们称 Rank 为数组的维数，Shape 表示数组的各个维度的大小，使用整型元组表示。</p>
<h3 id="0-1-1-Array-Creation"><a href="#0-1-1-Array-Creation" class="headerlink" title="0.1.1 Array Creation"></a>0.1.1 Array Creation</h3><p>初始化 Numpy Array 的方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(a))</span><br><span class="line"><span class="built_in">print</span>(a.shape)</span><br><span class="line"><span class="built_in">print</span>(a[<span class="number">0</span>], a[<span class="number">1</span>], a[<span class="number">2</span>])</span><br><span class="line"><span class="comment"># Reference Modification</span></span><br><span class="line">a[<span class="number">0</span>] = <span class="number">5</span></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line">b = np.array(</span><br><span class="line">    [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">     [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]]</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(b.shape)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(b))</span><br><span class="line"><span class="built_in">print</span>(b[<span class="number">0</span>, <span class="number">0</span>], b[<span class="number">1</span>, <span class="number">0</span>], b[<span class="number">0</span>, <span class="number">1</span>])</span><br></pre></td></tr></table></figure>
<p>类似 Matlab，提供多种方法创建数组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">a = np.zeros((<span class="number">2</span>, <span class="number">2</span>))    <span class="comment"># 2x2 0-matrix</span></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">b = np.ones((<span class="number">3</span>, <span class="number">3</span>))     <span class="comment"># 3x3 1-matrix</span></span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">c = np.eye(<span class="number">2</span>)           <span class="comment"># 2x2 identical matrix</span></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">d = np.full((<span class="number">4</span>, <span class="number">4</span>), <span class="number">5</span>)  <span class="comment"># 4x4 matrix filled with 5</span></span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="comment"># 2x2 matrix filled with uniformed ([0,1]) random value</span></span><br><span class="line">e = np.random.random((<span class="number">2</span>, <span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line">f = np.diag((-<span class="number">3</span>, -<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)) <span class="comment"># 4x4 matrix with -3, -4, 5, 6 on diagonal</span></span><br><span class="line"><span class="built_in">print</span>(f)</span><br><span class="line">g_dup = f</span><br><span class="line">g = f.copy()    <span class="comment"># Copy construction</span></span><br><span class="line">f[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(g_dup, g)</span><br><span class="line"></span><br><span class="line">h = np.linspace(<span class="number">0</span>, <span class="number">13</span>, <span class="number">5</span>)  <span class="comment"># start=0, end(included)=13, num=5</span></span><br><span class="line"><span class="built_in">print</span>(h)</span><br><span class="line"></span><br><span class="line"><span class="comment"># args are similar with range(), but return np.array</span></span><br><span class="line">k = np.arange(<span class="number">4</span>, <span class="number">5</span>, <span class="number">0.1</span>, dtype=<span class="built_in">float</span>)</span><br><span class="line"><span class="built_in">print</span>(k)</span><br></pre></td></tr></table></figure>
<p>更多创建方法用到再说。</p>
<h3 id="0-1-2-Array-Indexing"><a href="#0-1-2-Array-Indexing" class="headerlink" title="0.1.2 Array Indexing"></a>0.1.2 Array Indexing</h3><p>索引 Numpy Array 的方法和 Python 原生数组类似：</p>
<ul>
<li>整型索引 + slice <code>:</code> 切片；</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">a = np.array(</span><br><span class="line">    [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">     [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">     [<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use slice in each dimension (!!! Reference but NOT copy construction !!!)</span></span><br><span class="line">b = a[:<span class="number">2</span>, <span class="number">1</span>:<span class="number">3</span>]  <span class="comment"># row: 0-1 (2 not included), column: 1-2</span></span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="comment"># Reference Modification</span></span><br><span class="line">b[<span class="number">0</span>, <span class="number">1</span>] = <span class="number">99</span></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># We need to copy construct explicitly</span></span><br><span class="line">c = a[:<span class="number">2</span>, <span class="number">1</span>:<span class="number">3</span>].copy()</span><br><span class="line">b[<span class="number">0</span>, <span class="number">1</span>] = <span class="number">88</span></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># get by only one axis</span></span><br><span class="line">c = a[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">d = a[<span class="number">0</span>, <span class="number">2</span>] <span class="comment"># row=0, column=2</span></span><br><span class="line"><span class="built_in">print</span>(d)</span><br></pre></td></tr></table></figure>
<p>注意引用传递的问题。</p>
<p>还可以将 整型索引 和 slice 混合使用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">a = np.array(</span><br><span class="line">    [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">     [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">     [<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the whole row 0 (equivalent to a[0])</span></span><br><span class="line">row_r1 = a[<span class="number">0</span>, :]</span><br><span class="line"><span class="built_in">print</span>(row_r1, row_r1.shape)</span><br><span class="line"><span class="comment"># row 0 (but keep dimension)</span></span><br><span class="line">row_r2 = a[<span class="number">0</span>:<span class="number">1</span>, :]</span><br><span class="line"><span class="built_in">print</span>(row_r2, row_r2.shape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Same with column</span></span><br><span class="line">col_r1 = a[:, <span class="number">0</span>]</span><br><span class="line">col_r2 = a[:, <span class="number">0</span>:<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(col_r1, col_r1.shape)</span><br><span class="line"><span class="built_in">print</span>(col_r2, col_r2.shape)</span><br></pre></td></tr></table></figure>
<p>此外，Numpy 还支持：</p>
<ul>
<li>整型数组索引 + 布尔数组索引（更类似 Matlab）：仍然是引用传递。需要 <code>copy()</code> 来 copy construct；</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">a = np.array(</span><br><span class="line">    [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">     [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">     [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>],</span><br><span class="line">     [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Equivalent to: np.array([ a[0, 0], a[1, 1], a[2, 0] ])</span></span><br><span class="line"><span class="built_in">print</span>(a[[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Variable indexing</span></span><br><span class="line">b = np.array([<span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"><span class="comment"># Select each row, column: 0, 2, 0, 1, respectively.</span></span><br><span class="line"><span class="built_in">print</span>(a[np.arange(<span class="number">4</span>), b])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reference modification</span></span><br><span class="line">a[np.arange(<span class="number">4</span>), b] += <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">    [<span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Like Matlab</span></span><br><span class="line">bool_idx = (a &gt; <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(bool_idx)</span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> boolean indexing can only construct rank-1 array</span></span><br><span class="line"><span class="built_in">print</span>(a[bool_idx])  <span class="comment"># [3 4 5 6]</span></span><br><span class="line"><span class="built_in">print</span>(a[a &gt; <span class="number">2</span>])</span><br></pre></td></tr></table></figure>
<h3 id="0-1-3-Data-Types"><a href="#0-1-3-Data-Types" class="headerlink" title="0.1.3 Data Types"></a>0.1.3 Data Types</h3><p>Numpy 中提供来多种数据类型，可以用来构建数组等操作。默认情况下构建 array，在不指定 <code>dtype</code> 参数时，Numpy 会猜测数组的数据类型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line"><span class="built_in">print</span>(x.dtype)    <span class="comment"># np.int64</span></span><br><span class="line"></span><br><span class="line">x = np.array([<span class="number">1</span>, <span class="number">2</span>], dtype=np.uint64)</span><br><span class="line"><span class="built_in">print</span>(x.dtype)    <span class="comment"># np.uint64</span></span><br><span class="line"></span><br><span class="line">x = np.array([<span class="number">1.</span>, <span class="number">2.</span>])</span><br><span class="line"><span class="built_in">print</span>(x.dtype)    <span class="comment"># np.float64</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Python 原生类型，如 <code>int / bool / float / complex / bytes / str / object</code>，分别对应 <code>int_ / bool_ / float64 / complex128 / bytes_ / str_ / object_</code>；</p>
</blockquote>
<p>当数据类型比较复杂时（例如结构体数组），我们可以手动创建 <code>dtype</code> 并指定，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dt = np.dtype([</span><br><span class="line">    (<span class="string">&#x27;name&#x27;</span>, np.str_, <span class="number">16</span>),          <span class="comment"># Like database CHAR(16)</span></span><br><span class="line">    (<span class="string">&#x27;grades&#x27;</span>, np.float64, (<span class="number">2</span>,))    <span class="comment"># length=2, rank-1 array</span></span><br><span class="line">])</span><br><span class="line"><span class="built_in">print</span>(dt)    <span class="comment"># &lt; 表示小端序、U 代表 unicode char 数字就是占用的字节</span></span><br><span class="line">x = np.array([(<span class="string">&#x27;Sarah&#x27;</span>, (<span class="number">8.0</span>, <span class="number">7.0</span>)), (<span class="string">&#x27;John&#x27;</span>, (<span class="number">6.0</span>, <span class="number">7.0</span>))], dtype=dt)</span><br><span class="line"><span class="comment"># Get data like dict</span></span><br><span class="line"><span class="built_in">print</span>(x[<span class="number">1</span>][<span class="string">&#x27;grades&#x27;</span>])</span><br></pre></td></tr></table></figure>
<p>更多类型的使用、<code>dtype</code> 信息，请参见 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://numpy.org/doc/stable/reference/arrays.dtypes.html">Array DTypes - Numpy Doc</a>；</p>
<h3 id="0-1-4-Array-Math"><a href="#0-1-4-Array-Math" class="headerlink" title="0.1.4 Array Math"></a>0.1.4 Array Math</h3><p>数组运算，在 Numpy 中也是向量 / 矩阵运算。</p>
<p>在 Matlab 中，我们知道这些运算可以是向量整体点积/叉积、矩阵整体乘法/取逆、向量矩阵乘法；也可以是 element-wise（逐元素）的运算。</p>
<p>逐元素的四则运算、开方运算如下（会产生新对象）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>]], dtype=np.float64)</span><br><span class="line">y = np.array([[<span class="number">5</span>,<span class="number">6</span>],[<span class="number">7</span>,<span class="number">8</span>]], dtype=np.float64)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(x + y)</span><br><span class="line"><span class="built_in">print</span>(np.add(x, y))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(x - y)</span><br><span class="line"><span class="built_in">print</span>(np.subtract(x, y))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 和 matlab 不一样，* 符号是 element-wise 的</span></span><br><span class="line"><span class="built_in">print</span>(x * y)</span><br><span class="line"><span class="built_in">print</span>(np.multiply(x, y))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(x / y)</span><br><span class="line"><span class="built_in">print</span>(np.divide(x, y))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(np.sqrt(x))</span><br></pre></td></tr></table></figure>
<p>向量点积（内积）/ 矩阵整体乘法 / 向量矩阵乘法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># matrices</span></span><br><span class="line">x = np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">y = np.array([[<span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># vectors</span></span><br><span class="line">v = np.array([<span class="number">9</span>, <span class="number">10</span>])</span><br><span class="line">w = np.array([<span class="number">11</span>, <span class="number">12</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inner product of vectors</span></span><br><span class="line"><span class="built_in">print</span>(v.dot(w))</span><br><span class="line"><span class="built_in">print</span>(np.dot(v, w)) <span class="comment"># equivalence</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Matrix / vector product</span></span><br><span class="line"><span class="comment"># They have different answers!</span></span><br><span class="line"><span class="built_in">print</span>(v.dot(x)) <span class="comment"># v is regarded as row vector</span></span><br><span class="line"><span class="built_in">print</span>(x.dot(v)) <span class="comment"># v is regarded as column vector</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Matrix product</span></span><br><span class="line"><span class="built_in">print</span>(x.dot(y))</span><br></pre></td></tr></table></figure>
<p>我们发现，在 Numpy 中，通过 <code>array()</code> 定义的 <strong><u>rank-1 array 很灵活，既可以作行向量，又可以作列向量</u></strong>。</p>
<p>也正因如此，我们下面介绍的 <strong><u>转置操作</u></strong> 对 rank-1 array 毫无影响：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[<span class="number">1</span>,<span class="number">2</span>], [<span class="number">3</span>,<span class="number">4</span>]])</span><br><span class="line"><span class="built_in">print</span>(x)    <span class="comment"># Prints &quot;[[1 2]</span></span><br><span class="line">            <span class="comment">#          [3 4]]&quot;</span></span><br><span class="line"><span class="comment"># 注意：返回引用！</span></span><br><span class="line"><span class="built_in">print</span>(x.T)  <span class="comment"># Prints &quot;[[1 3]</span></span><br><span class="line">            <span class="comment">#          [2 4]]&quot;</span></span><br><span class="line"><span class="comment"># 等价于 x.transpose()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Note that taking the transpose of a rank 1 array does nothing:</span></span><br><span class="line">v = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(v)    <span class="comment"># Prints &quot;[1 2 3]&quot;</span></span><br><span class="line"><span class="built_in">print</span>(v.T)  <span class="comment"># Prints &quot;[1 2 3]&quot;</span></span><br></pre></td></tr></table></figure>
<p>此外，除了 element-wise 求和，Numpy 和 Matlab 一样提供了整体求和的方法 <code>sum</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>]])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(np.<span class="built_in">sum</span>(x))    <span class="comment"># 默认全部元素求和</span></span><br><span class="line"><span class="built_in">print</span>(np.<span class="built_in">sum</span>(x, axis=<span class="number">0</span>))  <span class="comment"># axis=0 对第一维度（列）求和</span></span><br><span class="line"><span class="built_in">print</span>(np.<span class="built_in">sum</span>(x, axis=<span class="number">1</span>))  <span class="comment"># axis=1 对第二维度（行）求和</span></span><br></pre></td></tr></table></figure>
<p>更多运算方法用到再说。</p>
<h3 id="0-1-5-Broadcasting"><a href="#0-1-5-Broadcasting" class="headerlink" title="0.1.5 Broadcasting"></a>0.1.5 Broadcasting</h3><p>广播（broadcasting）是 Numpy 运算中相当重要的性质之一，它为不同维度的 array 间的运算提供了更高效的方式。下面几种常用的手段：</p>
<h4 id="将-rank-1-array-加到-matrix-的每一行上"><a href="#将-rank-1-array-加到-matrix-的每一行上" class="headerlink" title="将 rank-1 array 加到 matrix 的每一行上"></a>将 rank-1 array 加到 matrix 的每一行上</h4><p>假设现在有个需求，将 <code>v</code> 向量加到 <code>x</code> 的每一行上，最后放到 <code>y</code> 中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]])</span><br><span class="line">v = np.array([<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"><span class="comment"># empty_like() 按照 x.shape 来创建一个空矩阵</span></span><br><span class="line">y = np.empty_like(x)</span><br></pre></td></tr></table></figure>
<p>如果不用 broadcasting 就应该这么做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">1</span>]):</span><br><span class="line">    y[i, :] = x[i, :] + v</span><br></pre></td></tr></table></figure>
<p>或者使用 <code>tile</code> 来堆叠重复向量：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vv = np.tile(v, (<span class="number">4</span>, <span class="number">1</span>))   <span class="comment"># Stack 4 copies of v on top of each other</span></span><br><span class="line"><span class="built_in">print</span>(vv)                 <span class="comment"># Prints &quot;[[1 0 1]</span></span><br><span class="line">                          <span class="comment">#          [1 0 1]</span></span><br><span class="line">                          <span class="comment">#          [1 0 1]</span></span><br><span class="line">                          <span class="comment">#          [1 0 1]]&quot;</span></span><br></pre></td></tr></table></figure>
<p>第一种方法虽然能实现需求，但是如果 <code>x</code> 相当大，那么 Python 自己的循环就非常慢，因此我们需要借助 broadcasting（写在 Numpy Library 中，C/C++ 实现）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不同维度的 array 通过 broadcast 直接运算</span></span><br><span class="line">y = x + v  <span class="comment"># Add v to each row of x using broadcasting</span></span><br></pre></td></tr></table></figure>
<p>但是如果使用不当会出现 shape mismatch 的情况。因此我们需要知道 broadcast 的算法：</p>
<ol>
<li><p>如果参与运算的 arrays 的 rank 不同，那么向 rank 小的 array 的 shape 中 <code>prepend</code> 数字 1（可以在不添加元素的前提下扩展维度），直至它们的 rank（就是 shape 元组的长度）相等；</p>
<blockquote>
<p>例如 <code>[1, 2, 3]</code>（shape <code>(3,)</code>）扩展一次维度后变成 <code>[[1, 2, 3]]</code>（shape <code>(1, 3)</code>）；</p>
</blockquote>
<p>定义：两个 arrays 在某个维度上 compatible（匹配），当且仅当它们的 shape 在这个维度上的值相同，<u>或者一方为 1</u>；</p>
<p>因此，第一步就是尝试让两个参与运算的 array 在每个维度上都匹配。数学上<strong>只有两个 array 在每个维度上都匹配，才能进行 broadcasting 操作</strong>。</p>
</li>
<li><p>两个 arrays 运算时，如果在某个维度上一方为 1，另一方大于 1，那么说明需要在这个维度上 broadcasting，具体做法就是让这个维度上为 1 的 array，在当前维度上重复多次直至与另一个 array 的相等；</p>
</li>
<li><p>如果两个 arrays 是匹配的，那么在最终运算结束时，结果是二者 shapes 的 element-wise 的最大值。</p>
</li>
</ol>
<p><strong>思考 1：为什么 broadcasting 会将向量加到矩阵的每一行，而不是每一列？</strong></p>
<p>答：由 broadcasting 算法决定。上面提到，会向 shape 中 <code>prepend</code> 数字 1，这就是原因（如果算法是 append 的话就是加到列上去了）。</p>
<p><strong>思考 2：那么我们如何利用 broadcasting 将向量加到每一列上？</strong></p>
<p>答：先用转置，然后最后再转置回去就行。或者使用 <code>reshape</code> 来手动预处理 shape（向它 append 1）；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line">w = np.array([<span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="built_in">print</span>((x.T + w).T)</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"><span class="built_in">print</span>(x + np.reshape(w, (<span class="number">2</span>, <span class="number">1</span>)))</span><br></pre></td></tr></table></figure>
<h4 id="常量-Element-wise-运算"><a href="#常量-Element-wise-运算" class="headerlink" title="常量 Element-wise 运算"></a>常量 Element-wise 运算</h4><p>这应该是广播最为通俗易懂的形式。</p>
<p>我们直接用常量（相当于扩展前的 shape <code>(1,)</code>）向矩阵乘：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line"><span class="built_in">print</span>(x * <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h4 id="计算向量叉积"><a href="#计算向量叉积" class="headerlink" title="计算向量叉积"></a>计算向量叉积</h4><blockquote>
<p>注：可以使用自带方法 <code>numpy.outer(a, b)</code>，这里只是展示如何用 broadcasting 完成叉积（外积）。</p>
</blockquote>
<p>本质上就是将被乘向量的每个元素乘到每个列上：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">w = np.array([<span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(np.reshape(v, (<span class="number">3</span>, <span class="number">1</span>)) * w)</span><br></pre></td></tr></table></figure>
<p>关于 Numpy 的基础用法掌握这么多就够了。如果希望更多的信息，请参见 Numpy 官方文档。</p>
<h2 id="0-2-SciPy"><a href="#0-2-SciPy" class="headerlink" title="0.2 SciPy"></a>0.2 SciPy</h2><p><code>SciPy</code> 库提供了一些高性能方法来计算和掌控多维数组，对科学计算和工程有很大用处。</p>
<p>最好入门的方法是阅读这个文档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.scipy.org/doc/scipy/reference/index.html">Scipy - Reference</a>。这里我们尽快入门为主，有需要再自行翻阅。</p>
<h3 id="0-2-1-Image-Operations"><a href="#0-2-1-Image-Operations" class="headerlink" title="0.2.1 Image Operations"></a>0.2.1 Image Operations</h3><p>Scipy 库提供了图像处理的基本函数。例如：</p>
<ul>
<li>从磁盘的图片中读入到 Numpy 数组；</li>
<li>将 Numpy 数组写成图片；</li>
</ul>
<p>下面是使用 Scipy resize 图片的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注：这个写法在 scipy 1.2.0 以后被弃用。</span></span><br><span class="line"><span class="comment"># 你应该使用 opencv 来导入图片</span></span><br><span class="line"><span class="comment"># from cv2 import imread, resize, imwrite</span></span><br><span class="line"><span class="keyword">from</span> scipy.misc <span class="keyword">import</span> imread, imsave, imresize</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read an JPEG image into a numpy array</span></span><br><span class="line">img = imread(<span class="string">&#x27;assets/cat.jpg&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(img.dtype, img.shape)  <span class="comment"># Prints &quot;uint8 (400, 248, 3)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 补充计算机图形学知识：从这里能看出，jpg 格式的位深度为 8x3 = 24（bytes）</span></span><br><span class="line"><span class="comment"># 其中每个值是 uint8 存储，共 3 个通道（RGB）</span></span><br><span class="line"><span class="comment"># 如果是 png 格式，可以是 4 个通道（RGBA），可以存透明度，称为 PNG-32</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Broadcasting</span></span><br><span class="line"><span class="comment"># 将图像的 Green Channel 和 Blue Channel 像素值分别广播乘以 0.95 和 0.9</span></span><br><span class="line"><span class="comment"># 图像会微微泛红</span></span><br><span class="line">img_tinted = img * [<span class="number">1</span>, <span class="number">0.95</span>, <span class="number">0.9</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Resize</span></span><br><span class="line">img_tinted = imresize(img_tinted, (<span class="number">300</span>, <span class="number">300</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save</span></span><br><span class="line">imsave(<span class="string">&#x27;assets/cat_tinted.jpg&#x27;</span>, img_tinted)</span><br></pre></td></tr></table></figure>
<h3 id="0-2-2-Matlab-Files"><a href="#0-2-2-Matlab-Files" class="headerlink" title="0.2.2 Matlab Files"></a>0.2.2 Matlab Files</h3><p>我们可以从 Matlab 中加载通用的矩阵文件。例如下面的例子是从 Matlab 的矩阵文件中加载复数矩阵：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> loadmat</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load matlab mat file</span></span><br><span class="line">trainDataRaw = loadmat(<span class="string">&quot;data/PA_data_train.mat&quot;</span>)</span><br><span class="line">testDataRaw = loadmat(<span class="string">&quot;data/PA_data_test.mat&quot;</span>)</span><br><span class="line">train_input = trainDataRaw[<span class="string">&#x27;paInput&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">train_output = trainDataRaw[<span class="string">&#x27;paOutput&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(train_input) == <span class="built_in">len</span>(train_output), <span class="string">&quot;The size of input vector should be equal to the output one.&quot;</span></span><br><span class="line"></span><br><span class="line">test_input = testDataRaw[<span class="string">&#x27;paInput&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">test_output = testDataRaw[<span class="string">&#x27;paOutput&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(test_input) == <span class="built_in">len</span>(test_output), <span class="string">&quot;The size of input vector should be equal to the output one.&quot;</span></span><br><span class="line"></span><br><span class="line">trainData = [(<span class="built_in">complex</span>(train_input[k]), <span class="built_in">complex</span>(train_output[k])) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(train_input))]</span><br><span class="line">testData = [(<span class="built_in">complex</span>(test_input[k]), <span class="built_in">complex</span>(test_output[k])) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(test_input))]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[INFO] Train data loaded: <span class="subst">&#123;<span class="built_in">len</span>(trainData)&#125;</span> groups (input, output)&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[INFO] Test data loaded: <span class="subst">&#123;<span class="built_in">len</span>(testData)&#125;</span> groups (input, output)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Preparing for the module of the data</span></span><br><span class="line">trainModule = [(<span class="built_in">abs</span>(i[<span class="number">0</span>]), <span class="built_in">abs</span>(i[<span class="number">1</span>])) <span class="keyword">for</span> i <span class="keyword">in</span> trainData]</span><br><span class="line">testModule = [(<span class="built_in">abs</span>(i[<span class="number">0</span>]), <span class="built_in">abs</span>(i[<span class="number">1</span>])) <span class="keyword">for</span> i <span class="keyword">in</span> testData]</span><br></pre></td></tr></table></figure>
<h3 id="0-2-3-Distance-between-points"><a href="#0-2-3-Distance-between-points" class="headerlink" title="0.2.3 Distance between points"></a>0.2.3 Distance between points</h3><p>Scipy 求两点间距如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.spatial.distance <span class="keyword">import</span> pdist, cdist, squareform</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义了一组二维点</span></span><br><span class="line">x = np.array([</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">0</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算点集中两两间的欧几里得距离，输出为矩阵</span></span><br><span class="line"><span class="comment"># 第 i 行、第 j 列表示点集中第 i 个点和第 j 个点的欧式距离</span></span><br><span class="line"><span class="comment"># [[ 0.          1.41421356  2.23606798]</span></span><br><span class="line"><span class="comment">#  [ 1.41421356  0.          1.        ]</span></span><br><span class="line"><span class="comment">#  [ 2.23606798  1.          0.        ]]</span></span><br><span class="line">d = squareform(pdist(x, <span class="string">&#x27;euclidean&#x27;</span>))</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">e = cdist(x, x, <span class="string">&#x27;euclidean&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>
<p>还有一个 <code>cdist</code> 求的是两个点集间的距离（指定两个点集，而不像上面是在一个点集内），自动输出为矩阵形式。</p>
<h2 id="0-3-Matplotlib"><a href="#0-3-Matplotlib" class="headerlink" title="0.3 Matplotlib"></a>0.3 Matplotlib</h2><p>介绍一些模板用法。</p>
<h3 id="0-3-1-并列折线图"><a href="#0-3-1-并列折线图" class="headerlink" title="0.3.1 并列折线图"></a>0.3.1 并列折线图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">x = [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;8&#x27;</span>]</span><br><span class="line"></span><br><span class="line">fig, axe = plt.subplots()</span><br><span class="line"></span><br><span class="line">prim = [<span class="number">27138166.8</span>, <span class="number">9152368.0</span>, <span class="number">7887584.4</span>, <span class="number">5203370.6</span>]</span><br><span class="line">opt = [<span class="number">45508900.4</span>, <span class="number">91379932.6</span>, <span class="number">179513808.6</span>, <span class="number">289122555.6</span>]</span><br><span class="line"></span><br><span class="line">axe.scatter(x, prim, c=<span class="string">&#x27;#219ebc&#x27;</span>, marker=<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">axe.scatter(x, opt, c=<span class="string">&#x27;#feb705&#x27;</span>, marker=<span class="string">&#x27;o&#x27;</span>)</span><br><span class="line"><span class="comment"># axe.scatter(x, ratio_3, c=&#x27;#fa8600&#x27;, marker=&#x27;^&#x27;)</span></span><br><span class="line">axe.plot(x, prim, <span class="string">&#x27;-&#x27;</span>, c=<span class="string">&#x27;#219ebc&#x27;</span>, label=<span class="string">&quot;Primitive&quot;</span>)</span><br><span class="line">axe.plot(x, opt, <span class="string">&#x27;-&#x27;</span>, c=<span class="string">&#x27;#feb705&#x27;</span>, label=<span class="string">&quot;Optimized&quot;</span>)</span><br><span class="line"><span class="comment"># axe.plot(x, ratio_3, &#x27;-&#x27;, c=&#x27;#fa8600&#x27;, label=&quot;Workload 3&quot;)</span></span><br><span class="line"></span><br><span class="line">axe.set_xticks(x)</span><br><span class="line">axe.legend()</span><br><span class="line">axe.minorticks_on()</span><br><span class="line">axe.grid()</span><br><span class="line"></span><br><span class="line"><span class="comment"># axe.set_ylim([0.3, 1.2])</span></span><br><span class="line">axe.set_xlabel(<span class="string">&#x27;Thread Number&#x27;</span>)</span><br><span class="line">axe.set_ylabel(<span class="string">&#x27;Average Throughput (ops/s)&#x27;</span>)</span><br><span class="line">axe.set_title(<span class="string">&#x27;Average Throughput - Thread Number Relationship Plot&#x27;</span>)</span><br><span class="line"></span><br><span class="line">axe.ticklabel_format(style=<span class="string">&#x27;sci&#x27;</span>, scilimits=(-<span class="number">1</span>, <span class="number">2</span>), axis=<span class="string">&#x27;y&#x27;</span>, useMathText=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="py_imgs/throughput.png" width="400px" /></p>
<h3 id="0-3-2-并列直方图"><a href="#0-3-2-并列直方图" class="headerlink" title="0.3.2 并列直方图"></a>0.3.2 并列直方图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">labels = [<span class="string">&#x27;Tiny&#x27;</span>, <span class="string">&#x27;Small&#x27;</span>, <span class="string">&#x27;Medium&#x27;</span>, <span class="string">&#x27;Large&#x27;</span>]</span><br><span class="line">x_labels = labels</span><br><span class="line">width = <span class="number">0.2</span></span><br><span class="line">x = np.arange(<span class="built_in">len</span>(labels))</span><br><span class="line"></span><br><span class="line">qs = [<span class="number">5458</span>, <span class="number">36660</span>, <span class="number">155667</span>, <span class="number">1341294</span>]</span><br><span class="line">ls = [<span class="number">27247</span>, <span class="number">287699</span>, <span class="number">1146510</span>, <span class="number">10195125</span>]</span><br><span class="line">qs_r = [<span class="number">6469</span>, <span class="number">45830</span>, <span class="number">192725</span>, <span class="number">2354645</span>]</span><br><span class="line"></span><br><span class="line">fig, axe = plt.subplots()</span><br><span class="line"></span><br><span class="line">axe.minorticks_on()</span><br><span class="line">axe.grid()</span><br><span class="line"></span><br><span class="line">axe.bar(x - width - <span class="number">0.05</span>, qs, width, color=<span class="string">&#x27;#2a9d8c&#x27;</span>, label=<span class="string">&#x27;Quick Select&#x27;</span>, zorder=<span class="number">10</span>,</span><br><span class="line">        edgecolor=<span class="string">&#x27;black&#x27;</span>, linewidth=<span class="number">1</span>)</span><br><span class="line">axe.bar(x, ls, width, label=<span class="string">&#x27;Linear Select ($Q=5$)&#x27;</span>, color=<span class="string">&#x27;#e9c46b&#x27;</span>, zorder=<span class="number">10</span>,</span><br><span class="line">        edgecolor=<span class="string">&#x27;black&#x27;</span>, linewidth=<span class="number">1</span>)</span><br><span class="line">axe.bar(x + width + <span class="number">0.05</span>, qs_r, width, color=<span class="string">&#x27;#e66f51&#x27;</span>, label=<span class="string">&#x27;Quick Select (random pivot)&#x27;</span>, zorder=<span class="number">10</span>,</span><br><span class="line">        edgecolor=<span class="string">&#x27;black&#x27;</span>, linewidth=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">axe.set_xlabel(<span class="string">&#x27;Data Scale&#x27;</span>)</span><br><span class="line">axe.set_ylabel(<span class="string">&#x27;Operation Latency (ns)&#x27;</span>)</span><br><span class="line">axe.set_xticks(x)</span><br><span class="line">axe.set_xticklabels(x_labels)</span><br><span class="line"></span><br><span class="line">axe.set_yscale(<span class="string">&#x27;log&#x27;</span>)</span><br><span class="line">axe.legend()</span><br><span class="line"></span><br><span class="line">axe.set_title(<span class="string">&#x27;Operation Latency for Unordered Data&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="py_imgs/1-2.png" width="400px" /></p>
<h3 id="0-3-3-堆叠条形图"><a href="#0-3-3-堆叠条形图" class="headerlink" title="0.3.3 堆叠条形图"></a>0.3.3 堆叠条形图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">labels = [<span class="string">&#x27;Short (80 B)&#x27;</span>, <span class="string">&#x27;Middle (7.5 KB)&#x27;</span>, <span class="string">&#x27;Large (740 KB)&#x27;</span>]</span><br><span class="line">x_labels = labels</span><br><span class="line">width = <span class="number">0.2</span></span><br><span class="line">x = np.arange(<span class="built_in">len</span>(labels))</span><br><span class="line"></span><br><span class="line">uncompressed = [<span class="number">80</span>, <span class="number">7500</span>, <span class="number">740_000</span>]</span><br><span class="line">uncompressed_ratio = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">single = [<span class="number">50</span>, <span class="number">4000</span>, <span class="number">392_000</span>]</span><br><span class="line">single_dict = [<span class="number">185</span>, <span class="number">477</span>, <span class="number">508</span>]</span><br><span class="line">single_ratio = [single[i] / uncompressed[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(labels))]</span><br><span class="line">single_dict_ratio = [single_dict[i] / uncompressed[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(labels))]</span><br><span class="line"></span><br><span class="line">multi = [<span class="number">48</span>, <span class="number">3900</span>, <span class="number">383_000</span>]</span><br><span class="line">multi_dict = [<span class="number">212</span>, <span class="number">504</span>, <span class="number">528</span>]</span><br><span class="line">multi_ratio = [multi[i] / uncompressed[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(labels))]</span><br><span class="line">multi_dict_ratio = [multi_dict[i] / uncompressed[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(labels))]</span><br><span class="line"></span><br><span class="line">fig, axe = plt.subplots()</span><br><span class="line"></span><br><span class="line">axe.minorticks_on()</span><br><span class="line">axe.grid()</span><br><span class="line"></span><br><span class="line">axe.bar(x - width - <span class="number">0.05</span>, uncompressed_ratio, width, color=<span class="string">&#x27;gray&#x27;</span>,label=<span class="string">&#x27;Uncompressed&#x27;</span>, zorder=<span class="number">10</span>)</span><br><span class="line">axe.bar(x, single_ratio, width, label=<span class="string">&#x27;Single&#x27;</span>, color=<span class="string">&#x27;#56baf8&#x27;</span>, zorder=<span class="number">10</span>)</span><br><span class="line">axe.bar(x + width + <span class="number">0.05</span>, multi_ratio, width, color=<span class="string">&#x27;#f8566a&#x27;</span>, label=<span class="string">&#x27;Multiple&#x27;</span>, zorder=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">axe.bar(x, single_dict_ratio, width, bottom=single_ratio, color=<span class="string">&#x27;#9fd8fb&#x27;</span>, label=<span class="string">&#x27;Single Dict&#x27;</span>, zorder=<span class="number">10</span>)</span><br><span class="line">axe.bar(x + width + <span class="number">0.05</span>, multi_dict_ratio, width, color=<span class="string">&#x27;#fb9fab&#x27;</span>, bottom=multi_ratio, label=<span class="string">&#x27;Multiple Dict&#x27;</span>, zorder=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">axe.set_xlabel(<span class="string">&#x27;File Type&#x27;</span>)</span><br><span class="line">axe.set_ylabel(<span class="string">&#x27;Compress Ratio&#x27;</span>)</span><br><span class="line">axe.set_xticks(x)</span><br><span class="line">axe.set_xticklabels(x_labels)</span><br><span class="line">axe.legend()</span><br><span class="line"></span><br><span class="line">axe.set_title(<span class="string">&#x27;The Compressed Ratio Comparison&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="py_imgs/comp2.png" width="400px" /></p>
<h3 id="0-3-4-折线-直方组合图-amp-对数坐标"><a href="#0-3-4-折线-直方组合图-amp-对数坐标" class="headerlink" title="0.3.4 折线-直方组合图 &amp; 对数坐标"></a>0.3.4 折线-直方组合图 &amp; 对数坐标</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">labels = [<span class="string">&#x27;Short (80 B)&#x27;</span>, <span class="string">&#x27;Middle (7.5 KB)&#x27;</span>, <span class="string">&#x27;Large (740 KB)&#x27;</span>]</span><br><span class="line">x_labels = labels</span><br><span class="line">width = <span class="number">0.2</span></span><br><span class="line">x = np.arange(<span class="built_in">len</span>(labels))</span><br><span class="line"></span><br><span class="line">uncompressed = [<span class="number">80</span>, <span class="number">7500</span>, <span class="number">740_000</span>]</span><br><span class="line"></span><br><span class="line">single = [<span class="number">50</span>, <span class="number">4000</span>, <span class="number">392_000</span>]</span><br><span class="line">single_dict = [<span class="number">185</span>, <span class="number">477</span>, <span class="number">508</span>]</span><br><span class="line"></span><br><span class="line">single_dict_ratio_in_comp = [single_dict[i] / (single_dict[i] + single[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(labels))]</span><br><span class="line"></span><br><span class="line">multi = [<span class="number">48</span>, <span class="number">3900</span>, <span class="number">383_000</span>]</span><br><span class="line">multi_dict = [<span class="number">212</span>, <span class="number">504</span>, <span class="number">528</span>]</span><br><span class="line"></span><br><span class="line">multi_dict_ratio_in_comp = [multi_dict[i] / (multi_dict[i] + multi[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(labels))]</span><br><span class="line"></span><br><span class="line">single_total_ratio = [(single[i] + single_dict[i]) / uncompressed[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(labels))]</span><br><span class="line">multi_total_ratio = [(multi[i] + multi_dict[i]) / uncompressed[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(labels))]</span><br><span class="line"></span><br><span class="line">fig, axe = plt.subplots()</span><br><span class="line">axe2 = axe.twinx()</span><br><span class="line"></span><br><span class="line">axe.bar(x - width / <span class="number">2</span> - <span class="number">0.03</span>, single_dict_ratio_in_comp, width, color=<span class="string">&#x27;#56baf8&#x27;</span>, label=<span class="string">&quot;Single&quot;</span>)</span><br><span class="line">axe.bar(x + width / <span class="number">2</span> + <span class="number">0.03</span>, multi_dict_ratio_in_comp, width, color=<span class="string">&#x27;#f8566a&#x27;</span>, label=<span class="string">&quot;Multiple&quot;</span>)</span><br><span class="line"></span><br><span class="line">axe.set_xticks(x)</span><br><span class="line">axe.set_xticklabels(x_labels)</span><br><span class="line"></span><br><span class="line">axe.set_xlabel(<span class="string">&#x27;File Type&#x27;</span>)</span><br><span class="line">axe.set_ylabel(<span class="string">&#x27;Dictionary Size Ratio&#x27;</span>)</span><br><span class="line"></span><br><span class="line">axe.minorticks_on()</span><br><span class="line">axe.grid()</span><br><span class="line">axe.set_yscale(<span class="string">&#x27;log&#x27;</span>)</span><br><span class="line">axe.legend()</span><br><span class="line"></span><br><span class="line">axe2.scatter(x, single_total_ratio, c=<span class="string">&#x27;k&#x27;</span>, marker=<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">axe2.scatter(x, multi_total_ratio, c=<span class="string">&#x27;k&#x27;</span>, marker=<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">axe2.plot(x, single_total_ratio, <span class="string">&#x27;g--&#x27;</span>, label=<span class="string">&quot;Single in Total&quot;</span>)</span><br><span class="line">axe2.plot(x, multi_total_ratio, <span class="string">&#x27;y-&#x27;</span>, label=<span class="string">&quot;Multiple in Total&quot;</span>)</span><br><span class="line">axe2.legend(loc=(<span class="number">0.66</span>, <span class="number">0.7</span>))</span><br><span class="line"></span><br><span class="line">axe2.set_ylabel(<span class="string">&#x27;Total Compressed Ratio&#x27;</span>)</span><br><span class="line"></span><br><span class="line">axe.set_title(<span class="string">&#x27;Dict Size Ratio &amp; Compressed Ratio Relationship&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="py_imgs/dict2.png" width="400px" /></p>
<h3 id="0-3-3-样条曲线和插值拟合"><a href="#0-3-3-样条曲线和插值拟合" class="headerlink" title="0.3.3 样条曲线和插值拟合"></a>0.3.3 样条曲线和插值拟合</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># File: fit_interp_1d.py</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> interpolate</span><br><span class="line"><span class="keyword">from</span> scipy.optimize <span class="keyword">import</span> curve_fit</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Interpolate1DGen</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x: <span class="type">List</span>[<span class="built_in">float</span>], y: <span class="type">List</span>[<span class="built_in">float</span>], point_cnt: <span class="built_in">int</span></span>):</span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line">        self.point_cnt = point_cnt</span><br><span class="line">        self.sorted_x = <span class="built_in">sorted</span>(self.x)</span><br><span class="line">        self.sorted_y = <span class="built_in">sorted</span>(self.y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">interpolate_polynomial</span>(<span class="params">self, kind: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="built_in">int</span>]</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Polynomial interpolate for 1D data.</span></span><br><span class="line"><span class="string">        :param kind: &#x27;nearest&#x27;, &#x27;zero&#x27;, &#x27;linear&#x27;, &#x27;slinear&#x27;, &#x27;quadratic&#x27;(2), &#x27;cubic&#x27;(3), 4, 5, ...</span></span><br><span class="line"><span class="string">        :return: tuple(interpolated_x, interpolated_y)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        ans_x = np.linspace(</span><br><span class="line">            self.sorted_x[<span class="number">0</span>],</span><br><span class="line">            self.sorted_x[<span class="built_in">len</span>(self.x)-<span class="number">1</span>],</span><br><span class="line">            self.point_cnt</span><br><span class="line">        )</span><br><span class="line">        f_linear = interpolate.interp1d(</span><br><span class="line">            self.x, self.y, kind=kind</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> ans_x, f_linear(ans_x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">interpolate_B_spline</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        B-spline interpolate for 1D data.</span></span><br><span class="line"><span class="string">        **WARNING**: Data sort and non-duplicated will be needed.</span></span><br><span class="line"><span class="string">        :return: tuple(interpolated_x, interpolated_y)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        ans_x = np.linspace(</span><br><span class="line">            self.sorted_x[<span class="number">0</span>],</span><br><span class="line">            self.sorted_x[<span class="built_in">len</span>(self.x)-<span class="number">1</span>],</span><br><span class="line">            self.point_cnt</span><br><span class="line">        )</span><br><span class="line">        tck = interpolate.splrep(self.sorted_x, self.sorted_y)</span><br><span class="line">        y_bSpline = interpolate.splev(ans_x, tck)</span><br><span class="line">        <span class="keyword">return</span> ans_x, y_bSpline</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FitLine1DGen</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x: <span class="type">List</span>[<span class="built_in">float</span>], y: <span class="type">List</span>[<span class="built_in">float</span>], point_cnt: <span class="built_in">int</span></span>):</span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line">        self.point_cnt = point_cnt</span><br><span class="line">        self.sorted_x = <span class="built_in">sorted</span>(self.x)</span><br><span class="line">        self.sorted_y = <span class="built_in">sorted</span>(self.y)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># S-shape curve fit.</span></span><br><span class="line">    <span class="comment"># Or logistic model.</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sigmoid</span>(<span class="params">x, lp, x0, k, b</span>):</span><br><span class="line">        y = lp / (<span class="number">1</span> + np.exp(-k * (x - x0))) + b</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fit_polynomial_curve</span>(<span class="params">self, n: <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Polynomial fitting for 1D data.</span></span><br><span class="line"><span class="string">        :param n: (int) the max power of the polynomial.</span></span><br><span class="line"><span class="string">        :return: tuple(fitting_curve_x, fitting_curve_y)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        params = np.polyfit(self.x, self.y, n)</span><br><span class="line">        ans_x = np.linspace(</span><br><span class="line">            self.sorted_x[<span class="number">0</span>],</span><br><span class="line">            self.sorted_x[<span class="built_in">len</span>(self.x)-<span class="number">1</span>],</span><br><span class="line">            self.point_cnt</span><br><span class="line">        )</span><br><span class="line">        ans_y = np.polyval(params, ans_x)</span><br><span class="line">        <span class="keyword">return</span> ans_x, ans_y</span><br><span class="line"></span><br><span class="line">    <span class="comment"># logistic fit</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fit_S_curve</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        S Curve fitting for 1D data.</span></span><br><span class="line"><span class="string">        :return: tuple(fitting_curve_x, fitting_curve_y)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># standardize data:</span></span><br><span class="line">        x_min = self.sorted_x[<span class="number">0</span>]</span><br><span class="line">        y_min = self.sorted_y[<span class="number">0</span>]</span><br><span class="line">        x_max = self.sorted_x[<span class="built_in">len</span>(self.x)-<span class="number">1</span>]</span><br><span class="line">        y_max = self.sorted_y[<span class="built_in">len</span>(self.y)-<span class="number">1</span>]</span><br><span class="line">        x_zoomed = (np.array(self.x) - x_min) / (x_max - x_min)</span><br><span class="line">        y_zoomed = (np.array(self.y) - y_min) / (y_max - y_min)</span><br><span class="line">        <span class="comment"># A mandatory initial guess</span></span><br><span class="line">        <span class="comment"># [max(yData), median(xData), 1, min(yData)]</span></span><br><span class="line">        p_guess = [</span><br><span class="line">            <span class="built_in">max</span>(y_zoomed), np.median(x_zoomed),</span><br><span class="line">            <span class="number">1</span>, <span class="built_in">min</span>(y_zoomed)</span><br><span class="line">        ]</span><br><span class="line">        popt, pcov = curve_fit(</span><br><span class="line">            self.sigmoid, x_zoomed, y_zoomed,</span><br><span class="line">            p_guess</span><br><span class="line">        )</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[INFO] curve_fit: popt = &quot;</span>, popt)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[INFO] curve_fit: pcov = &quot;</span>, pcov)</span><br><span class="line"></span><br><span class="line">        fit_x = np.linspace(<span class="number">0</span>, <span class="number">1</span>, self.point_cnt)</span><br><span class="line">        fit_y = self.sigmoid(fit_x, popt[<span class="number">0</span>], popt[<span class="number">1</span>], popt[<span class="number">2</span>], popt[<span class="number">3</span>])</span><br><span class="line">        ans_x = fit_x * (x_max - x_min) + x_min</span><br><span class="line">        ans_y = fit_y * (y_max - y_min) + y_min</span><br><span class="line">        <span class="keyword">return</span> ans_x, ans_y</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fit_interp_1d <span class="keyword">import</span> Interpolate1DGen</span><br><span class="line"></span><br><span class="line">element_test_list = [<span class="number">50</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">500</span>, <span class="number">1000</span>]</span><br><span class="line">p_test_list = [<span class="number">1</span> / <span class="number">2</span>, <span class="number">1</span> / math.e, <span class="number">1</span> / <span class="number">4</span>, <span class="number">1</span> / <span class="number">8</span>, <span class="number">1</span> / <span class="number">16</span>]</span><br><span class="line">ans = [[<span class="number">8.75</span>, <span class="number">7.45</span>, <span class="number">5.48</span>, <span class="number">5.3</span>, <span class="number">4.92</span>],</span><br><span class="line">       [<span class="number">8.98</span>, <span class="number">7.67</span>, <span class="number">6.19</span>, <span class="number">5.58</span>, <span class="number">6.89</span>],</span><br><span class="line">       [<span class="number">9.72</span>, <span class="number">8.25</span>, <span class="number">6.35</span>, <span class="number">5.53</span>, <span class="number">10.33</span>],</span><br><span class="line">       [<span class="number">11.67</span>, <span class="number">9.22</span>, <span class="number">8.39</span>, <span class="number">8.81</span>, <span class="number">9.52</span>],</span><br><span class="line">       [<span class="number">12.83</span>, <span class="number">10.17</span>, <span class="number">8.56</span>, <span class="number">9.26</span>, <span class="number">10.71</span>]]</span><br><span class="line"></span><br><span class="line">style_list = [<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;-.&#x27;</span>, <span class="string">&#x27;--&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;:&#x27;</span>]</span><br><span class="line">color_list = [<span class="string">&#x27;#04acf4&#x27;</span>, <span class="string">&#x27;#ff5722&#x27;</span>, <span class="string">&#x27;#ffeb3b&#x27;</span>, <span class="string">&#x27;#4caf50&#x27;</span>, <span class="string">&#x27;#9c27b0&#x27;</span>]</span><br><span class="line">inter_sample_cnt = <span class="number">1000</span></span><br><span class="line"><span class="keyword">for</span> idx, elem <span class="keyword">in</span> <span class="built_in">enumerate</span>(element_test_list):</span><br><span class="line">    aqd = ans[idx]</span><br><span class="line">    ans_p, ans_aqd = Interpolate1DGen(</span><br><span class="line">        p_test_list, aqd, inter_sample_cnt</span><br><span class="line">    ).interpolate_polynomial(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># plt.scatter(ans_p, ans_aqd, color=&#x27;k&#x27;, marker=&#x27;x&#x27;)</span></span><br><span class="line">    plt.plot(ans_p, ans_aqd, color=color_list[idx], linestyle=style_list[idx])</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Probability $p$&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Average Query Distance (AQD)&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;The curves for AQD-probability&#x27;</span>)</span><br><span class="line">plt.minorticks_on()</span><br><span class="line">plt.grid()</span><br><span class="line">plt.legend(</span><br><span class="line">    labels=(</span><br><span class="line">        <span class="string">&#x27;element: 50&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;element: 100&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;element: 200&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;element: 500&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;element: 1000&#x27;</span></span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="py_imgs/AQD_curves.png" width="400px" /></p>
<h3 id="0-3-4-3D-曲面"><a href="#0-3-4-3D-曲面" class="headerlink" title="0.3.4 3D 曲面"></a>0.3.4 3D 曲面</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mu0 = <span class="number">4</span> * math.pi * <span class="number">10</span> ** (-<span class="number">3</span>)</span><br><span class="line">N = <span class="number">310</span></span><br><span class="line">R = <span class="number">0.14</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># i unit: A</span></span><br><span class="line"><span class="comment"># B unit: 1 Gauss = 10 ** -4 Tesla</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">I2B</span>(<span class="params">i: <span class="built_in">float</span>, x: <span class="built_in">float</span></span>):</span><br><span class="line">    p1 = mu0 * N * math.<span class="built_in">pow</span>(R, <span class="number">2</span>) * i /(<span class="number">2</span> * math.<span class="built_in">pow</span>(math.<span class="built_in">pow</span>(R, <span class="number">2</span>) + math.<span class="built_in">pow</span>(R / <span class="number">2</span> + x, <span class="number">2</span>), <span class="number">3</span> / <span class="number">2</span>))</span><br><span class="line">    p2 = mu0 * N * math.<span class="built_in">pow</span>(R, <span class="number">2</span>) * i /(<span class="number">2</span> * math.<span class="built_in">pow</span>(math.<span class="built_in">pow</span>(R, <span class="number">2</span>) + math.<span class="built_in">pow</span>(R / <span class="number">2</span> - x, <span class="number">2</span>), <span class="number">3</span> / <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> p1 + p2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">theoB</span>(<span class="params">th_B0: <span class="built_in">float</span>, x: <span class="built_in">float</span></span>):</span><br><span class="line">    <span class="keyword">return</span> th_B0 * math.<span class="built_in">pow</span>(<span class="number">5</span>, <span class="number">3</span> / <span class="number">2</span>) / <span class="number">16</span> * (<span class="number">1</span> / math.<span class="built_in">pow</span>(<span class="number">1</span> + math.<span class="built_in">pow</span>(<span class="number">0.5</span> + x / R, <span class="number">2</span>), <span class="number">3</span> / <span class="number">2</span>) + <span class="number">1</span> / math.<span class="built_in">pow</span>(<span class="number">1</span> + math.<span class="built_in">pow</span>(<span class="number">0.5</span> - x / R, <span class="number">2</span>), <span class="number">3</span> / <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p_cnt = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">    fig = plt.figure()</span><br><span class="line">    axe = plt.axes(projection=<span class="string">&#x27;3d&#x27;</span>)</span><br><span class="line">    plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span>  <span class="comment"># 用来正常显示负号</span></span><br><span class="line">    xx = np.array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line">    yy = np.array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line"></span><br><span class="line">    mesh_val = [</span><br><span class="line">        [<span class="number">1.025</span>, <span class="number">1.024</span>, <span class="number">1.024</span>, <span class="number">1.024</span>, <span class="number">1.023</span>, <span class="number">1.020</span>, <span class="number">1.016</span>],  <span class="comment"># y = 0</span></span><br><span class="line">        [<span class="number">1.025</span>, <span class="number">1.024</span>, <span class="number">1.024</span>, <span class="number">1.024</span>, <span class="number">1.023</span>, <span class="number">1.020</span>, <span class="number">1.016</span>],  <span class="comment"># y = 0.05R</span></span><br><span class="line">        [<span class="number">1.024</span>, <span class="number">1.027</span>, <span class="number">1.024</span>, <span class="number">1.024</span>, <span class="number">1.023</span>, <span class="number">1.022</span>, <span class="number">1.018</span>],  <span class="comment"># y = 0.10R</span></span><br><span class="line">        [<span class="number">1.024</span>, <span class="number">1.024</span>, <span class="number">1.024</span>, <span class="number">1.024</span>, <span class="number">1.025</span>, <span class="number">1.024</span>, <span class="number">1.021</span>],  <span class="comment"># y = 0.15R</span></span><br><span class="line">        [<span class="number">1.023</span>, <span class="number">1.023</span>, <span class="number">1.024</span>, <span class="number">1.025</span>, <span class="number">1.027</span>, <span class="number">1.026</span>, <span class="number">1.024</span>],  <span class="comment"># y = 0.20R</span></span><br><span class="line">        [<span class="number">1.021</span>, <span class="number">1.021</span>, <span class="number">1.023</span>, <span class="number">1.026</span>, <span class="number">1.028</span>, <span class="number">1.030</span>, <span class="number">1.030</span>],  <span class="comment"># y = 0.25R</span></span><br><span class="line">        [<span class="number">1.018</span>, <span class="number">1.019</span>, <span class="number">1.021</span>, <span class="number">1.027</span>, <span class="number">1.031</span>, <span class="number">1.033</span>, <span class="number">1.037</span>]   <span class="comment"># y = 0.30R</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">U2B</span>(<span class="params">u: <span class="built_in">float</span></span>):</span><br><span class="line">        <span class="keyword">return</span> (u - <span class="number">4.61538</span> * math.<span class="built_in">pow</span>(<span class="number">10</span>, -<span class="number">4</span>)) / <span class="number">0.25396</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Z_func</span>(<span class="params">x: <span class="built_in">int</span>, y: <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="keyword">return</span> mesh_val[x][y]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mesh_val)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mesh_val[<span class="number">0</span>])):</span><br><span class="line">            mesh_val[i][j] = U2B(mesh_val[i][j])</span><br><span class="line"></span><br><span class="line">    rawX, rawY = np.meshgrid(xx, yy)</span><br><span class="line"></span><br><span class="line">    ap_all = np.vectorize(Z_func)</span><br><span class="line">    Z = ap_all(rawX, rawY)</span><br><span class="line">    <span class="built_in">print</span>(Z)</span><br><span class="line"></span><br><span class="line">    toReal = np.vectorize(<span class="keyword">lambda</span> x: x * <span class="number">0.05</span> * R)</span><br><span class="line">    rxx = toReal(xx)</span><br><span class="line">    ryy = toReal(yy)</span><br><span class="line">    X, Y = np.meshgrid(rxx, ryy)</span><br><span class="line"></span><br><span class="line">    axe.plot_surface(X, Y, Z, cmap=<span class="string">&#x27;jet&#x27;</span>)</span><br><span class="line">    axe.plot_wireframe(X, Y, Z, color=<span class="string">&#x27;k&#x27;</span>, linewidth=<span class="number">0.3</span>)</span><br><span class="line">    <span class="comment"># axe.minorticks_on()</span></span><br><span class="line">    axe.set_xlabel(<span class="string">&#x27;X position ($m$)&#x27;</span>)</span><br><span class="line">    axe.set_ylabel(<span class="string">&#x27;Y position ($m$)&#x27;</span>)</span><br><span class="line">    axe.set_zlabel(<span class="string">&#x27;Magnetic field density B ($G$)&#x27;</span>)</span><br><span class="line">    axe.set_title(<span class="string">&#x27;Space magnetic field distribution&#x27;</span>)</span><br><span class="line">    axe.grid(which=<span class="string">&quot;major&quot;</span>, alpha=<span class="number">0.6</span>)</span><br><span class="line">    axe.grid(which=<span class="string">&quot;minor&quot;</span>, alpha=<span class="number">0.3</span>)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="py_imgs/AQD.png" width="400px" /></p>
<h3 id="0-3-5-输出图片"><a href="#0-3-5-输出图片" class="headerlink" title="0.3.5 输出图片"></a>0.3.5 输出图片</h3><p>除了使用 OpenCV 库的 <code>imshow</code>，Matplotlib 也支持输出图片：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> cv2 <span class="keyword">import</span> imread</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">img = imread(<span class="string">&#x27;assets/cat.jpg&#x27;</span>)</span><br><span class="line">img_tinted = img * [<span class="number">1</span>, <span class="number">0.95</span>, <span class="number">0.9</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show the original image</span></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">plt.imshow(img)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show the tinted image</span></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># A slight gotcha with imshow is that it might give strange results</span></span><br><span class="line"><span class="comment"># if presented with data that is not uint8. To work around this, we</span></span><br><span class="line"><span class="comment"># explicitly cast the image to uint8 before displaying it.</span></span><br><span class="line">plt.imshow(np.uint8(img_tinted))</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.sjtuxhw.top">SJTU-XHW</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.sjtuxhw.top/technical/python-sci-starter/">https://blog.sjtuxhw.top/technical/python-sci-starter/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.sjtuxhw.top" target="_blank">SJTU-XHW's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Programming/">Programming</a><a class="post-meta__tags" href="/tags/Math/">Math</a><a class="post-meta__tags" href="/tags/Python/">Python</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.sjtuxhw.top/cover_imgs/python_sci.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat_pay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat_pay.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/technical/redis-starter/" title="Redis 入门：从实践到理论"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/redis.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Redis 入门：从实践到理论</div></div><div class="info-2"><div class="info-item-1">Chapter 1. 基本概念和 CLI 使用1.1 NoSQL用于存储非结构化数据，不保证 ACID 事务特性（仅有最终一致性 Weak Consistency Model）。 Redis（Remote Dictionary Server）就是一类基于内存的键值型 NoSQL，不保证数据一致性，但可以保证性能。  一种 KVStore System，可以方便的存放非结构化数据，这对于缓存各异性数据非常有帮助；  Handle 网络请求多线程。处理指令单线程，单个指令具有原子性；  低延迟，利用 I/O Multiplexing 在单线程中处理多个请求； 支持数据持久化； 支持主从集群（从备份，读写分离）和分片集群（数据拆分，存储上限提高）；  1.2 Redis Data StructureRedis Key 一般使用 String，Value 支持：  基本类型：String、Hash、List、Set、SortedSet； 特殊类型：GEO（地理位置信息格式）、BitMap（位图）、HyperLog；  1.3 Basic Redis CLI Commands1.3.1...</div></div></div></a><a class="pagination-related" href="/technical/hilog-paper/" title="OpenHarmony Hilog 架构趣读"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/hilog-paper.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">OpenHarmony Hilog 架构趣读</div></div><div class="info-2"><div class="info-item-1">最近看到一篇讨论 OpenHarmony Hilog 日志子系统的设计的论文，遂进行了一番阅读。该论文发表在软件学报上。 摘要 分析当今主流日志系统的技术架构和优缺点； 基于 OpenHarmony 操作系统的异构设备互联特性，设计 HiLog 日志系统模型规范； 设计并实现第 1 个面向 OpenHarmony 的日志系统 HiLog, 并贡献到 OpenHarmony 主线； 对 HiLog 日志系统的关键指标进行测试和对比试验；  实现的 HiLog 具有以下特征：  基础性能：日志写入阶段吞吐量分别为 1 500 KB/s 和 700 KB/s，吞吐量相对 Android Log 提升 114%； 日志持久化：压缩率 3.5%，丢包率...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/technical/matlab-review/" title="Matlab 复习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/matlab.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-18</div><div class="info-item-2">Matlab 复习</div></div><div class="info-2"><div class="info-item-1">Written by SJTU_XHW Version: Matlab R2020b References: MATLAB Documentation (mathworks.com)   Chapter0 Matlab is a 1-index languageChapter1 Basic Operations1.1 operators: numerical { +-*/^() } ；logical { ~ || &amp;&amp; &gt; &lt; ==（按位运算须函数） }；1.2 variables: do not need to be declaed before assignment (类似Python)1.3 numeric variable type：logical、char、numeric、cell、struct、scalar1.4 constants：ans，i/j，Inf，eps（2.2204e-016），NaN，pi1.5 keywords：iskeyword1.6 calling priority local variable $\gt$...</div></div></div></a><a class="pagination-related" href="/review/csapp-basic/" title="CSAPP Notes Basic"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/csapp_123.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-17</div><div class="info-item-2">CSAPP Notes Basic</div></div><div class="info-2"><div class="info-item-1">written by SJTU-XHW Reference:  CMU - 213, Computer Systems A Programmer’s Perspective 3rd Edition by Randal Bryant, David O’Hallaron 本人知识浅薄，文章难免有问题或缺漏，欢迎批评指正！ 内容很长，写起来很慢 😳   Chapter 0. Intro0.1 Ints are not Integers, Floats are not Reals $x^2\ge 0$：int（32-bit）may overflow； $a+(b+c)=(a+b)+c$：floats may discard some “unsignificant” digits；  0.2 Learn Assembly but never write it0.3 Memory Matters: Unbounded1234567891011121314typedef struct &#123;    int a[2];    double d;&#125;...</div></div></div></a><a class="pagination-related" href="/review/csapp-ecf-io/" title="CSAPP Notes: ECF &amp; I&#x2F;O"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/csapp-ecf.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-16</div><div class="info-item-2">CSAPP Notes: ECF &amp; I&#x2F;O</div></div><div class="info-2"><div class="info-item-1">Chapter 13. Exceptional Control Flow 对应书中第 8 章。  异常控制流是现代计算机系统的一个相当重要的部分。 13.1 Control Flow 控制流：从机器打开到关闭的过程中，处理器只做一件事：读指令、执行指令，一个周期做一个指令。多核的机器则每个核心依次交替执行指令。这些指令序列被称为控制流。硬件正在执行的实际指令序列就被称为物理控制流。  改变内存中控制流的方法：分支 &amp; 跳转，过程调用 &amp; 返回（Branches &amp; Jumps &amp; Procedure call and return）；  都是对于程序状态变化的处理。    但以上的简单的改变控制流的方法对于处理复杂的系统级别的状态变化时，就显得非常拙劣。（例如 OS 协同软硬件的通信，如果还是以 if-else 的方法，那将会非常差劲）； 什么是 “系统级别的状态变化”？  数据从磁盘 / 网卡到达内存中； I/O 设备输入...</div></div></div></a><a class="pagination-related" href="/review/csapp-mm-cache/" title="CSAPP Notes: Memory Hierarchy &amp; Cache &amp; Opt"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/csapp-mh.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-10</div><div class="info-item-2">CSAPP Notes: Memory Hierarchy &amp; Cache &amp; Opt</div></div><div class="info-2"><div class="info-item-1">Chapter 10. The Memory Hierarchy 本章将介绍系统的内存分层架构。  之前几章，我们对于内存的理解就是一个很大的字节数组，可以用地址作为下标进行访问。但事实上，真正的计算机的存储系统背后的设备层次结构设计远比这层抽象要复杂。 正是计算机的存储系统的层次结构对有限、离散资源的管理和抽象，才能让程序的内存看起来呈现出这种线性的数组结构。本章就来讨论计算机存储系统背后的层次结构。 10.1 Storage Technologies &amp; Trends在正式学习存储系统的层次结构前，有必要稍微弄清楚底层硬件的情况。 10.1.1 Random-Access Memory (RAM)当前大多数人所熟知的 “内存” 的一部分就是随机访问存储器（RAM），它具有以下的特征：  RAM 是个存储元件，I/O 吞吐速率快于绝大多数硬盘固件/磁盘（称为 “外存”）；  RAM 常常被打包放在 CPU 芯片中；  RAM 中每一个基本的存储单元被称为 单元胞（Cell），一个单元胞中存放 1 bit 数据；  很多个 RAM 芯片共同工作，组成了计算机的...</div></div></div></a><a class="pagination-related" href="/review/csapp-sched-arch/" title="CSAPP Notes: Scheduler &amp; Arch"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/csapp_p2.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-11</div><div class="info-item-2">CSAPP Notes: Scheduler &amp; Arch</div></div><div class="info-2"><div class="info-item-1">Chapter 8. Scheduler in OS为操作系统的调度环境作出假设：  Each job runs for the same amount of time All jobs arrive at the same time Once started, each job runs to completion All jobs only use the CPU  i.e., they perform no I/O   The run-time of each job is known  引入调度优劣衡量指标：周转时间，$T_{turnaround}=T_{completion}-T_{arrival}$； Strategy 1: FIFO（FCFS，First Come First Served） Implementation: queue； 消除假设 1：若短时任务排在长时任务之后，则平均周转时间效果很差；  Strategy 2 : SJF（Shortest Job First） 内容：对于同时到达的任务，优先选择总时长小的任务。 作用：（应对假设 1...</div></div></div></a><a class="pagination-related" href="/technical/gnu-tutor/" title="GNU-Tutor"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/GNU-Tutor.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-28</div><div class="info-item-2">GNU-Tutor</div></div><div class="info-2"><div class="info-item-1">基础：C/C++的源文件编译过程 想要代码在操作系统上运行，需要进行以下编译步骤，从高级语言转机器语言，以下任务gcc/g++均能完成：  预编译（.c/cpp &amp; .h —&gt; .i ）：*对应gcc/g++命令：gcc -E [xxx] -o [output.i] 展开所有宏定义#define（字符替换）； 处理所有条件预编译命令（#ifdef、#ifndef、#endif等）； 处理#include，具体操作是将指向的文件直接插入到文件的这一行（严格遵循上一步的条件）； 删除所有注释； 添加行号、文件标识，以便调试/编译出错时及时指出； 保留#pragma指令，以供编译器使用；   编译（.i —&gt; .s ，即高级语言转汇编语言）：对应gcc/g++命令：gcc -S [xxx] -o...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.ico" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">SJTU-XHW</div><div class="author-info-description">A blog to document learning and life</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">50</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">63</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/SSRVodka"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/SSRVodka" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:sjtuxhw12345@sjtu.edu.cn" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://blog.sjtuxhw.top/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss" style="color: #a200ff;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Thanks for visiting! |•'-'•) ✧</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0-1-NumPy"><span class="toc-text">0.1 NumPy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-1-1-Array-Creation"><span class="toc-text">0.1.1 Array Creation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-1-2-Array-Indexing"><span class="toc-text">0.1.2 Array Indexing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-1-3-Data-Types"><span class="toc-text">0.1.3 Data Types</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-1-4-Array-Math"><span class="toc-text">0.1.4 Array Math</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-1-5-Broadcasting"><span class="toc-text">0.1.5 Broadcasting</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86-rank-1-array-%E5%8A%A0%E5%88%B0-matrix-%E7%9A%84%E6%AF%8F%E4%B8%80%E8%A1%8C%E4%B8%8A"><span class="toc-text">将 rank-1 array 加到 matrix 的每一行上</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F-Element-wise-%E8%BF%90%E7%AE%97"><span class="toc-text">常量 Element-wise 运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%90%91%E9%87%8F%E5%8F%89%E7%A7%AF"><span class="toc-text">计算向量叉积</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0-2-SciPy"><span class="toc-text">0.2 SciPy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-2-1-Image-Operations"><span class="toc-text">0.2.1 Image Operations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-2-2-Matlab-Files"><span class="toc-text">0.2.2 Matlab Files</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-2-3-Distance-between-points"><span class="toc-text">0.2.3 Distance between points</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0-3-Matplotlib"><span class="toc-text">0.3 Matplotlib</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-3-1-%E5%B9%B6%E5%88%97%E6%8A%98%E7%BA%BF%E5%9B%BE"><span class="toc-text">0.3.1 并列折线图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-3-2-%E5%B9%B6%E5%88%97%E7%9B%B4%E6%96%B9%E5%9B%BE"><span class="toc-text">0.3.2 并列直方图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-3-3-%E5%A0%86%E5%8F%A0%E6%9D%A1%E5%BD%A2%E5%9B%BE"><span class="toc-text">0.3.3 堆叠条形图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-3-4-%E6%8A%98%E7%BA%BF-%E7%9B%B4%E6%96%B9%E7%BB%84%E5%90%88%E5%9B%BE-amp-%E5%AF%B9%E6%95%B0%E5%9D%90%E6%A0%87"><span class="toc-text">0.3.4 折线-直方组合图 &amp; 对数坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-3-3-%E6%A0%B7%E6%9D%A1%E6%9B%B2%E7%BA%BF%E5%92%8C%E6%8F%92%E5%80%BC%E6%8B%9F%E5%90%88"><span class="toc-text">0.3.3 样条曲线和插值拟合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-3-4-3D-%E6%9B%B2%E9%9D%A2"><span class="toc-text">0.3.4 3D 曲面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-3-5-%E8%BE%93%E5%87%BA%E5%9B%BE%E7%89%87"><span class="toc-text">0.3.5 输出图片</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/technical/redis-starter/" title="Redis 入门：从实践到理论"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/redis.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis 入门：从实践到理论"/></a><div class="content"><a class="title" href="/technical/redis-starter/" title="Redis 入门：从实践到理论">Redis 入门：从实践到理论</a><time datetime="2024-11-12T13:05:37.000Z" title="发表于 2024-11-12 21:05:37">2024-11-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/technical/python-sci-starter/" title="Python 科学计算入门"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/python_sci.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python 科学计算入门"/></a><div class="content"><a class="title" href="/technical/python-sci-starter/" title="Python 科学计算入门">Python 科学计算入门</a><time datetime="2024-11-03T11:08:13.000Z" title="发表于 2024-11-03 19:08:13">2024-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/technical/hilog-paper/" title="OpenHarmony Hilog 架构趣读"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/hilog-paper.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenHarmony Hilog 架构趣读"/></a><div class="content"><a class="title" href="/technical/hilog-paper/" title="OpenHarmony Hilog 架构趣读">OpenHarmony Hilog 架构趣读</a><time datetime="2024-10-29T05:14:04.000Z" title="发表于 2024-10-29 13:14:04">2024-10-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/review/makefile-again/" title="Makefile 快速上手 (again)"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/makefile-again.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Makefile 快速上手 (again)"/></a><div class="content"><a class="title" href="/review/makefile-again/" title="Makefile 快速上手 (again)">Makefile 快速上手 (again)</a><time datetime="2024-10-11T02:05:34.000Z" title="发表于 2024-10-11 10:05:34">2024-10-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/technical/xss/" title="XSS 是什么？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.sjtuxhw.top/cover_imgs/xss.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="XSS 是什么？"/></a><div class="content"><a class="title" href="/technical/xss/" title="XSS 是什么？">XSS 是什么？</a><time datetime="2024-10-04T04:15:33.000Z" title="发表于 2024-10-04 12:15:33">2024-10-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By SJTU-XHW  |  tech SJTU saves the world</div><div class="framework-info"><span>Built With love &amp; </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Powered By </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><div style="display:flex;flex-flow:row;justify-content:center;align-items:center;"> <a href="https://beian.miit.gov.cn" rel="external nofollow noreferrer" id="beian" target="_blank">ICP备案：沪ICP备2023012264-1号</a> <span class="footer-separator">|</span> <a style="display:flex;flex-flow:row;align-items:center;" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" rel="external nofollow noreferrer" target="_blank"> 本网站由 <img style="margin:0 3px;" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/upCloud_logo_blue.png" title="upcloud" alt="upcloud" height="30px"> 提供CDN加速/云存储服务 </a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();" rel="external nofollow noreferrer"><i class="fa-solid fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();" rel="external nofollow noreferrer"><i class="fa-solid fa-arrow-rotate-right"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();" rel="external nofollow noreferrer"><i class="fa-solid fa-arrow-right"></i></a><a class="rightMenu-item" id="menu-radompage" href="javascript:window.location.href = window.location.origin;" rel="external nofollow noreferrer"><i class="fa-solid fa-house"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();" rel="external nofollow noreferrer"><i class="fa-solid fa-copy"></i><span>复制</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:rmf.switchDarkMode();" rel="external nofollow noreferrer"><i class="fa-solid fa-circle-half-stroke"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="javascript:rmf.switchReadMode();" rel="external nofollow noreferrer"><i class="fa-solid fa-book"></i><span>阅读模式</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.sjtuxhw.top',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.sjtuxhw.top',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))

    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(init)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="/js/rightmenu.js"></script><script src="/js/mourn.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>