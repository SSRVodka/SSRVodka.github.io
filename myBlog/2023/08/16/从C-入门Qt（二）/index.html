<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ä»C++å…¥é—¨Qtï¼ˆäºŒï¼‰ | SJTU-XHW's blog</title><meta name="author" content="SJTU-XHW,sjtuxhw12345@sjtu.edu.cn"><meta name="copyright" content="SJTU-XHW"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="written by SJTU-XHW Reference: C++ GUI Programming with Qt 4 (2nd Edition)  æ³¨æ„ï¼šæœ¬æ–‡ç« å°†è®²è§£ Qt 5 å…¥é—¨çŸ¥è¯†ï¼Œéœ€è¦ä¸€å®šçš„ C++ åŸºç¡€ æœ¬äººçŸ¥è¯†æµ…è–„ï¼Œæ–‡ç« éš¾å…æœ‰é—®é¢˜æˆ–ç¼ºæ¼ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ï¼ è§‚å‰æç¤ºï¼šæœ¬ç³»åˆ—çš„æ‰€æœ‰å®Œæ•´ä»£ç åœ¨æ•´ç†å¥½åï¼Œéƒ½ä¼šå­˜æ”¾åœ¨ä»“åº“ä¸­ï¼Œæœ‰éœ€è¦å¯ä»¥è‡ªå– ~">
<meta property="og:type" content="article">
<meta property="og:title" content="ä»C++å…¥é—¨Qtï¼ˆäºŒï¼‰">
<meta property="og:url" content="https://sjtuxhw.top/2023/08/16/%E4%BB%8EC-%E5%85%A5%E9%97%A8Qt%EF%BC%88%E4%BA%8C%EF%BC%89/index.html">
<meta property="og:site_name" content="SJTU-XHW&#39;s blog">
<meta property="og:description" content="written by SJTU-XHW Reference: C++ GUI Programming with Qt 4 (2nd Edition)  æ³¨æ„ï¼šæœ¬æ–‡ç« å°†è®²è§£ Qt 5 å…¥é—¨çŸ¥è¯†ï¼Œéœ€è¦ä¸€å®šçš„ C++ åŸºç¡€ æœ¬äººçŸ¥è¯†æµ…è–„ï¼Œæ–‡ç« éš¾å…æœ‰é—®é¢˜æˆ–ç¼ºæ¼ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ï¼ è§‚å‰æç¤ºï¼šæœ¬ç³»åˆ—çš„æ‰€æœ‰å®Œæ•´ä»£ç åœ¨æ•´ç†å¥½åï¼Œéƒ½ä¼šå­˜æ”¾åœ¨ä»“åº“ä¸­ï¼Œæœ‰éœ€è¦å¯ä»¥è‡ªå– ~">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.sjtuxhw.top/cover_imgs/qt2.jpg">
<meta property="article:published_time" content="2023-08-16T15:15:11.000Z">
<meta property="article:modified_time" content="2023-09-19T05:18:46.000Z">
<meta property="article:author" content="SJTU-XHW">
<meta property="article:tag" content="Programming">
<meta property="article:tag" content="Qt">
<meta property="article:tag" content="C++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.sjtuxhw.top/cover_imgs/qt2.jpg"><link rel="shortcut icon" href="/myBlog/img/favicon.ico"><link rel="canonical" href="https://sjtuxhw.top/2023/08/16/%E4%BB%8EC-%E5%85%A5%E9%97%A8Qt%EF%BC%88%E4%BA%8C%EF%BC%89/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/myBlog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?64dd3b0c09c8af7b916f8249d32097e2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/myBlog/',
  algolia: undefined,
  localSearch: {"path":"/myBlog/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ä»C++å…¥é—¨Qtï¼ˆäºŒï¼‰',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-19 13:18:46'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/myBlog/css/mouseConfig.css"><link rel="stylesheet" href="/myBlog/css/valineBg.css"><link rel="stylesheet" href="/myBlog/css/rightmenu.css"><link rel="stylesheet" href="/myBlog/css/custom_music.css"><link rel="stylesheet" href="/myBlog/css/addFonts.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/myBlog/atom.xml" title="SJTU-XHW's blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/myBlog/img/favicon.ico" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/myBlog/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">33</div></a><a href="/myBlog/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">50</div></a><a href="/myBlog/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/myBlog/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/dailyQ/"><i class="fa-fw fa-solid fa-pen-to-square"></i><span> DailyQuestion</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa-solid fa-gamepad"></i><span> ACG-Lab</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/myBlog/ACGLab/MikuTap/"><i class="fa-fw fas fa-music"></i><span> MikuTap</span></a></li><li><a class="site-page child" href="/myBlog/ACGLab/Live2D/"><i class="fa-fw fa-solid fa-face-kiss-wink-heart"></i><span> Live2D</span></a></li><li><a class="site-page child" href="/myBlog/ACGLab/Folio-2019/"><i class="fa-fw fa-solid fa-car-side"></i><span> Folio-2019</span></a></li><li><a class="site-page child" href="/myBlog/ACGLab/Cube/"><i class="fa-fw fa-solid fa-cube"></i><span> Cube</span></a></li><li><a class="site-page child" href="/myBlog/ACGLab/TowerBlocks/"><i class="fa-fw fa-solid fa-gopuram"></i><span> TBlocks</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/myBlog/friend-links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/gallery/"><i class="fa-fw fa fa-camera"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/update-log/v0.3.0-Beta.html"><i class="fa-fw fa fa-arrow-circle-up"></i><span> Update</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.sjtuxhw.top/cover_imgs/qt2.jpg')"><nav id="nav"><span id="blog-info"><a href="/myBlog/" title="SJTU-XHW's blog"><img class="site-icon" src="/myBlog/img/head_icon.png"/><span class="site-name">SJTU-XHW's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/myBlog/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/dailyQ/"><i class="fa-fw fa-solid fa-pen-to-square"></i><span> DailyQuestion</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa-solid fa-gamepad"></i><span> ACG-Lab</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/myBlog/ACGLab/MikuTap/"><i class="fa-fw fas fa-music"></i><span> MikuTap</span></a></li><li><a class="site-page child" href="/myBlog/ACGLab/Live2D/"><i class="fa-fw fa-solid fa-face-kiss-wink-heart"></i><span> Live2D</span></a></li><li><a class="site-page child" href="/myBlog/ACGLab/Folio-2019/"><i class="fa-fw fa-solid fa-car-side"></i><span> Folio-2019</span></a></li><li><a class="site-page child" href="/myBlog/ACGLab/Cube/"><i class="fa-fw fa-solid fa-cube"></i><span> Cube</span></a></li><li><a class="site-page child" href="/myBlog/ACGLab/TowerBlocks/"><i class="fa-fw fa-solid fa-gopuram"></i><span> TBlocks</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/myBlog/friend-links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/gallery/"><i class="fa-fw fa fa-camera"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/update-log/v0.3.0-Beta.html"><i class="fa-fw fa fa-arrow-circle-up"></i><span> Update</span></a></div><div class="menus_item"><a class="site-page" href="/myBlog/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ä»C++å…¥é—¨Qtï¼ˆäºŒï¼‰</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-08-16T15:15:11.000Z" title="å‘è¡¨äº 2023-08-16 23:15:11">2023-08-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-09-19T05:18:46.000Z" title="æ›´æ–°äº 2023-09-19 13:18:46">2023-09-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/myBlog/categories/technical/">technical</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">13.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>54åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/myBlog/2023/08/16/%E4%BB%8EC-%E5%85%A5%E9%97%A8Qt%EF%BC%88%E4%BA%8C%EF%BC%89/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><i>written by SJTU-XHW</i></p>
<p><i>Reference: C++ GUI Programming with Qt 4 (2nd Edition) </i></p>
<p><i>æ³¨æ„ï¼šæœ¬æ–‡ç« å°†è®²è§£ <strong>Qt 5</strong> å…¥é—¨çŸ¥è¯†ï¼Œéœ€è¦ä¸€å®šçš„ C++ åŸºç¡€</i></p>
<p><i>æœ¬äººçŸ¥è¯†æµ…è–„ï¼Œæ–‡ç« éš¾å…æœ‰é—®é¢˜æˆ–ç¼ºæ¼ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ï¼</i></p>
<p><strong>è§‚å‰æç¤ºï¼šæœ¬ç³»åˆ—çš„æ‰€æœ‰å®Œæ•´ä»£ç åœ¨æ•´ç†å¥½åï¼Œéƒ½ä¼šå­˜æ”¾åœ¨ä»“åº“ä¸­ï¼Œæœ‰éœ€è¦å¯ä»¥è‡ªå– ~</strong></p>
<hr>
<span id="more"></span>
<h1 id="Chapter-4-ç¬¬ä¸€ä¸ªå®Œæ•´çš„-Qt-å…¥é—¨é¡¹ç›®"><a href="#Chapter-4-ç¬¬ä¸€ä¸ªå®Œæ•´çš„-Qt-å…¥é—¨é¡¹ç›®" class="headerlink" title="Chapter 4 ç¬¬ä¸€ä¸ªå®Œæ•´çš„ Qt å…¥é—¨é¡¹ç›®"></a>Chapter 4 ç¬¬ä¸€ä¸ªå®Œæ•´çš„ Qt å…¥é—¨é¡¹ç›®</h1><blockquote>
<p>åœ¨å®Œæˆä»¥ä¸Šçš„å­¦ä¹ è¿‡ç¨‹åï¼Œåœ¨åº§è¯¸ä½éƒ½å…·æœ‰ç‹¬ç«‹å†™å‡ºä¸€ä¸ª<strong>æç®€çš„ã€</strong>è¾ƒä¸ºå®Œæ•´ Qt é¡¹ç›®çš„èƒ½åŠ›ï¼›</p>
<p>ä»¥ä¸‹ï¼Œæœ¬äººå°†ç”¨ <strong>çº¯ä»£ç æ–¹å¼</strong> æ–¹å¼å®Œæˆè¿™ä¸ªé¡¹ç›®ï¼›</p>
<p><strong>æœ¬ç« æœ«ï¼Œä¼šæ€»ç»“åˆ°ç›®å‰ä¸ºæ­¢å­¦åˆ°çš„æ‰€æœ‰ Qt ç±»çš„ç»§æ‰¿/æ€ç»´å›¾</strong>ã€‚</p>
</blockquote>
<p><strong>è§‚å‰æç¤ºï¼šæœ¬é¡¹ç›®çš„è®¾è®¡æ€è·¯å¾ˆé•¿ï¼Œå®Œæ•´æºä»£ç æ”¾åœ¨ ä»“åº“ é‡Œï¼Œæœ‰éœ€è¦å¯ä»¥å–å‡ºæŸ¥çœ‹ ~ æœ¬ç« çš„ç›®çš„æ˜¯ä¸ºäº†å­¦ä¹  Qt ä¸€äº›ç»„ä»¶çš„ç”¨æ³•è€Œå·² ~</strong></p>
<p><strong>é¡¹ç›®ç›®æ ‡ï¼šæ¨¡ä»¿ <code>Microsoft Excel</code> è®¾è®¡ä¸€ä¸ªè¡¨æ ¼åº”ç”¨ç¨‹åº</strong>ã€‚</p>
<h2 id="4-1-åˆ›å»ºä¸»çª—å£-UI"><a href="#4-1-åˆ›å»ºä¸»çª—å£-UI" class="headerlink" title="4.1 åˆ›å»ºä¸»çª—å£ UI"></a>4.1 åˆ›å»ºä¸»çª—å£ UI</h2><h3 id="4-1-1-å­ç±»åŒ–-QMainWindow"><a href="#4-1-1-å­ç±»åŒ–-QMainWindow" class="headerlink" title="4.1.1 å­ç±»åŒ– QMainWindow"></a>4.1.1 å­ç±»åŒ– QMainWindow</h3><p>åˆ›å»ºä¸€ä¸ªä¸»çª—å£æœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯åˆ©ç”¨ Qt åº“ä¸­å·²æœ‰çš„è®¾è®¡ç±»ï¼š<code>QMainWindow</code>ã€‚</p>
<p><code>QMainWindow</code> å’Œ <code>QDialog</code> éƒ½æ˜¯ <code>QWidget</code> çš„å­ç±»ï¼Œæ‰€ä»¥ä¹‹å‰çš„å¾ˆå¤šæ–¹æ³•åœ¨åˆ›å»ºä¸»çª—å£æ—¶åŒæ ·æœ‰æ•ˆã€‚</p>
<p>ç¼–å†™å‰å…ˆè®¤è¯† <code>QMainWindow</code> ç±»çš„å¯¹åº”ç»“æ„ï¼š</p>
<p><img src="QMainWindow.png"></p>
<p>å…¶ä¸­ä¸­å¤®çª—å£éƒ¨ä»¶å¯ä»¥æ”¾ç½® Widgetï¼Œä½¿ç”¨ <code>QMainWindow::setCentralWidget(QWidget*)</code> åœ¨æ­¤åŒºåŸŸæ·»åŠ  Widgetï¼›</p>
<p>é¦–å…ˆæ ¹æ®ç›®æ ‡ï¼Œå£°æ˜ä¸€ä¸ªä¸»çª—å£ç±»ï¼ˆè‡ªå·±èµ·ä¸ªåå­—ï¼Œè¿™é‡Œç”¨  <code>MainWindow</code>ï¼‰ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: MainWindow.h</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;QtWidgets/QMainWindow&gt;</span></span><br><br><span class="hljs-comment">// åé¢æ‰æ·»åŠ ä¸Šçš„å¤´æ–‡ä»¶</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;QAction&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;QtWidgets/QLabel&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;FindDialog.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;HolySheet.h&quot;</span></span><br><br><span class="hljs-comment">// å®šä¹‰çš„å¸¸é‡</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MaxRecentFiles 5</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainWindow</span> : <span class="hljs-keyword">public</span> QMainWindow &#123;<br>    <span class="hljs-comment">// Q_OBJECT</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">MainWindow</span>();    <span class="hljs-comment">// ä¸»çª—å£æ„é€ å‡½æ•°</span><br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-comment">// closeEvent æ—¶ QWidget ç±»çš„è™šå‡½æ•°ï¼Œåœ¨ widget å…³é—­æ—¶å¯ä»¥è‡ªåŠ¨è°ƒç”¨ã€‚æ‰€ä»¥è¿™é‡Œæ‰“ç®—è¦†å†™æ­¤å‡½æ•°ï¼Œè¾¾åˆ°â€œé€€å‡ºæ—¶å¼¹å‡ºè¯¢é—®çª—å£â€çš„åŠŸèƒ½ï¼Œå¹¶ä¿å­˜ä¸€äº›è®¾ç½®åˆ°ç£ç›˜é‡Œ</span><br>    <span class="hljs-comment">// æµç¨‹ï¼šç”¨æˆ·ç‚¹å‡»ç»‘å®šäº†åŸç”Ÿæ§½ QWidget::close() çš„æ§ä»¶å‘å‡ºçš„ä¿¡å·(å†…éƒ¨emit)ï¼Œ</span><br>    <span class="hljs-comment">// ç„¶åé€šè¿‡å†…ç½®ä¿¡å·-æ§½è‡ªåŠ¨è°ƒç”¨åŸç”Ÿæ§½ void closeEvent(QCloseEvent* event).</span><br>    <span class="hljs-comment">// æ³¨æ„ï¼ŒQCloseEvent* event åªæœ‰è°ƒç”¨äº† event-&gt;accept() æ‰ä¼šçœŸæ­£é€€å‡ºçª—å£ï¼Œ</span><br>    <span class="hljs-comment">// å¦‚æœè°ƒç”¨äº† event-&gt;ignore()ï¼Œå°†å¿½ç•¥å…³é—­åŠ¨ä½œã€‚è¯¦ç»†è§ä¸‹æ–‡æœ¬å‡½æ•°å®ç°çš„ä»£ç ã€‚</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">closeEvent</span><span class="hljs-params">(QCloseEvent* event)</span> <span class="hljs-keyword">override</span></span>;<br><span class="hljs-keyword">private</span> slots:    <span class="hljs-comment">// ä¹‹æ‰€ä»¥å£°æ˜ä¸ºç§æœ‰æ§½ï¼Œæ˜¯å› ä¸ºå®ƒä»¬æ˜¯éœ€è¦ç”¨æˆ·ç‚¹å‡»åä½œå‡ºç›¸åº”çš„å‡½æ•°ï¼Œè€Œä¸”ä¸éœ€è¦ä»ç±»å¤–è¢«è°ƒç”¨</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">newFile</span><span class="hljs-params">()</span></span>;        <span class="hljs-comment">// ç§æœ‰æ§½å®ç°æ–°å»ºæ–‡ä»¶</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">open</span><span class="hljs-params">()</span></span>;        <span class="hljs-comment">// æ‰“å¼€æ–‡ä»¶</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">save</span><span class="hljs-params">()</span></span>;        <span class="hljs-comment">// ä¿å­˜æ–‡ä»¶</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">saveAs</span><span class="hljs-params">()</span></span>;        <span class="hljs-comment">// å¦å­˜ä¸ºæ–‡ä»¶</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">find</span><span class="hljs-params">()</span></span>;        <span class="hljs-comment">// è¡¨æ ¼æŸ¥æ‰¾åŠŸèƒ½ï¼Œå¯ä»¥å¤ç”¨ä¹‹å‰çš„ findDialog çª—å£</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">goToCell</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">// è¡¨æ ¼å®šä½åŠŸèƒ½ï¼Œå¯ä»¥å¤ç”¨ä¹‹å‰çš„ GoToCellDialog çª—å£</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sort</span><span class="hljs-params">()</span></span>;        <span class="hljs-comment">// è¡¨æ ¼æ’åºåŠŸèƒ½</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">about</span><span class="hljs-params">()</span></span>;        <span class="hljs-comment">// å…³äºè½¯ä»¶</span><br>    <br>    <span class="hljs-comment">// ä»¥ä¸Šéƒ¨åˆ†æ˜¯ä¸€å¼€å§‹è®¾è®¡å‡ºæ¥çš„ -----------------------------</span><br>    <span class="hljs-comment">// ä»¥ä¸‹åŠŸèƒ½æ˜¯åæ¥åŠ ä¸Šçš„ï¼Œæ‰€ä»¥å®ç°åˆ°å†è§£é‡Š -------------------</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">openRecentFile</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">updateStatusBar</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">holySheetModified</span><span class="hljs-params">()</span></span>;<br><span class="hljs-keyword">private</span>:    <span class="hljs-comment">// å·¥å…·å‡½æ•°ï¼Œå¤§å¤šæ˜¯ä»£ç åˆ›å»º UI ç»„ä»¶ã€è¢«ä¸Šé¢å‡½æ•°è°ƒç”¨çš„åº•å±‚åŠŸèƒ½ç­‰</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createActions</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createMenus</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createContextMenu</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createToolBars</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createStatusBar</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">readSettings</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">writeSettings</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">okToContinue</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">loadFile</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; filename)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">saveFile</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; filename)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setCurrentFile</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; filename)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">updateRecentFileAction</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">QString <span class="hljs-title">strippedName</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; fullFileName)</span></span>;<br>    <br>    <span class="hljs-comment">// ä¸€äº›ç§æœ‰æ•°æ®æˆå‘˜ï¼Œä¸ç”¨ç®¡å®ƒï¼ŒçœŸæ­£ç¼–ç¨‹æ—¶ï¼Œå…ˆç©ºç€ç”¨åˆ°å†æ·»åŠ </span><br>    HolySheet* holySheet;    <span class="hljs-comment">// æ³¨ï¼šHolySheet ç±»æ˜¯è¡¨æ ¼çš„æ•°æ®ç®¡ç†ç±»ï¼Œä»¥åå®ç°</span><br>    FindDialog* findDialog;<br>    QLabel* locationLabel;<br>    QLabel* formulaLabel;<br>    QStringList recentFiles;    <span class="hljs-comment">// æ–°ç±» QStringListï¼ŒQString ç±»å‹çš„åˆ—è¡¨</span><br>    QString curFile;<br>    <br>    QAction* recentFileActions[MaxRecentFiles];<br>    QAction* separatorAction;<br>    <br>    QMenu* fileMenu;<br>    QMenu* editMenu;<br>    QToolBar* fileToolBar;<br>    QToolBar* newAction;<br>    QAction* newAction;<br>    QAction* openAction;<br>    QAction*aboutAction;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>ç°åœ¨å®ç°ä»¥ä¸Šçš„å†…å®¹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: MainWindow.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;QtGui&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;MainWindow.h&quot;</span></span><br><br>MainWindow::<span class="hljs-built_in">MainWindow</span>() &#123;<br>    <span class="hljs-comment">// åˆå§‹åŒ–ä¸­å¤®çª—å£éƒ¨ä»¶</span><br>    holySheet = <span class="hljs-keyword">new</span> HolySheet;<br>    <span class="hljs-comment">// QMainWindow çš„æ–¹æ³•ï¼Œç”¨äºå°† widget è®¾ç½®åœ¨ä¸­å¤®çª—å£åŒº</span><br>    <span class="hljs-built_in">setCentralWidget</span>(holySheet);<br>    <br>    <span class="hljs-comment">// åˆ›å»ºé¡¶éƒ¨æ ã€ä¾§è¾¹æ ç­‰å…¶ä»–éƒ¨ä»¶</span><br>    <span class="hljs-built_in">createActions</span>();<br>    <span class="hljs-built_in">createMenus</span>();<br>    <span class="hljs-built_in">createContextMenu</span>();<br>    <span class="hljs-built_in">createToolBars</span>();<br>    <span class="hljs-built_in">createStatusBar</span>();<br>    <br>    <span class="hljs-comment">// è¯»å–ç£ç›˜ä¸­çš„è½¯ä»¶åå¥½è®¾ç½®</span><br>    <span class="hljs-built_in">readSettings</span>();<br>    <br>    <span class="hljs-comment">// ç­‰è°ƒç”¨ MainWindow::find() åå†åˆ›å»º</span><br>    findDialog = <span class="hljs-literal">nullptr</span>;<br>    <br>    <span class="hljs-comment">// è®¾ç½®çª—å£å›¾æ ‡ï¼Œè‡³äºä¸ºä½•å‰é¢æ˜¯â€œï¼šâ€ï¼Œè¯·çœ‹è§£æ</span><br>    <span class="hljs-built_in">setWindowIcon</span>(<span class="hljs-built_in">QIcon</span>(<span class="hljs-string">&quot;:/images/icon.png&quot;</span>));<br>    <span class="hljs-built_in">setCurrentFile</span>(<span class="hljs-string">&quot;&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ <code>QMainWindow::setWindowIcon(QIcon)</code> å’Œ <code>QIcon</code> ç±»ï¼›</p>
<p>åœ¨åº”ç”¨ç¨‹åºéœ€è¦è¯»å–ä¸€äº›èµ„æºçš„æ—¶å€™ï¼Œé€šå¸¸å¼€å‘è€…ä¼šæŠŠèµ„æºæ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œéœ€è¦çš„æ—¶å€™é€šè¿‡<strong>å’Œç³»ç»Ÿç›¸å…³çš„è·¯å¾„</strong>è½½å…¥ï¼Œè¿™ç§æ–¹æ³•å¯ç§»æ¤æ€§è¾ƒä½ï¼Œå¹¶ä¸”å®¹æ˜“å› ä¸ºç§»åŠ¨è€Œä¸¢å¤±èµ„æºï¼Œ<strong>æœ€è®¨åŒçš„æ˜¯èµ„æºè·¯å¾„æ¯”è¾ƒéº»çƒ¦</strong>ï¼›</p>
<p>å› æ­¤ï¼Œæ¯”è¾ƒæ¨èçš„æ˜¯ <strong>Qt çš„èµ„æºæœºåˆ¶ï¼ˆresource mechanismï¼‰</strong>ï¼Œä¼˜ç‚¹æ˜¯æ¯”è¿è¡Œæ—¶è½½å…¥æ›´æ–¹ä¾¿ã€é€‚ç”¨äºä»»æ„æ–‡ä»¶æ ¼å¼ï¼›æ¨èçš„ä½¿ç”¨æ–¹æ³•æ˜¯ï¼š</p>
<ol>
<li><p>å°†èµ„æºåˆ†ç±»æ”¾åœ¨å„ç›®å½•ä¸‹ï¼Œæ¯”å¦‚å›¾ç‰‡æ”¾åœ¨é¡¹ç›®åˆ›å»ºçš„ <code>images</code> å­ç›®å½•ä¸‹ï¼›</p>
</li>
<li><p>æ–°å»º <strong>Qt èµ„æºç³»ç»Ÿæ–‡ä»¶</strong> <code>*.qrc</code> ï¼Œåå­—è‡ªå·±èµ·ï¼Œæ ¼å¼æ˜¯ <code>XML</code> ï¼Œä¸¾ä¸ªä¾‹å­ï¼ˆç”¨ç›¸å¯¹è·¯å¾„ï¼‰ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">RCC</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">qresource</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>images/icon.png<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>images/gotocell.png<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">qresource</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">RCC</span>&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>è®°å¾—åœ¨é¡¹ç›® <code>*.pro</code> æ–‡ä»¶ä¸­æ·»åŠ ï¼š<code>RESOURCE = yourFileName.qrc</code>ï¼ˆå¦‚æœæ‚¨ç”¨ Qt Creator  IDE è‡ªåŠ¨æ·»åŠ ï¼Œå°±å½“æˆ‘æ²¡è¯´ï¼‰</p>
</li>
</ol>
<p><strong>è¿™æ ·åœ¨ Qt ç¨‹åºçš„ç»å¤§å¤šæ•°åœ°æ–¹è·¯å¾„å­—ç¬¦ä¸² <code>:/</code> ä»£è¡¨ <code>*.qrc</code> å­˜åœ¨çš„è·¯å¾„ï¼Œä¸ä¼šå‡ºé”™</strong>ï¼›ä¾‹å¦‚è°ƒç”¨ä¸Šé¢çš„ <code>icon.png</code> æ—¶å¯ä»¥è¿™ä¹ˆç”¨ï¼š<code>QIcon(&quot;:/images/icon.png&quot;)</code>ï¼›</p>
<h3 id="4-1-2-å®ç°èœå•æ ã€ä¸Šä¸‹æ–‡èœå•å’Œå·¥å…·æ "><a href="#4-1-2-å®ç°èœå•æ ã€ä¸Šä¸‹æ–‡èœå•å’Œå·¥å…·æ " class="headerlink" title="4.1.2 å®ç°èœå•æ ã€ä¸Šä¸‹æ–‡èœå•å’Œå·¥å…·æ "></a>4.1.2 å®ç°èœå•æ ã€ä¸Šä¸‹æ–‡èœå•å’Œå·¥å…·æ </h3><p>ç°åœ¨ä»‹ç»å‰é¢æ²¡æåˆ°çš„ <code>QAction</code> ç±»ï¼Œ<strong>Qt é€šè¿‡ â€œåŠ¨ä½œâ€ çš„æ¦‚å¿µç®€åŒ–äº†æœ‰å…³äºèœå•å’Œå·¥å…·æ çš„ç¼–ç¨‹</strong>ï¼Œä¸€ä¸ªåŠ¨ä½œå°±æ˜¯ä¸€ä¸ªå¯ä»¥æ·»åŠ åˆ°ä»»æ„æ•°é‡çš„èœå•å’Œå·¥å…·æ ä¸Šçš„é¡¹ï¼›</p>
<p>æ‰€ä»¥åœ¨ Qt ä¸­åˆ›å»ºèœå•å’Œå·¥å…·æ åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»ºå¹¶è®¾ç½®åŠ¨ä½œå±æ€§ï¼Œä¾‹å¦‚æ–‡æœ¬ã€æç¤ºã€ä¿¡å·-æ§½ã€å›¾æ ‡ã€å¿«æ·é”®ç­‰ï¼›</li>
<li>åˆ›å»ºèœå•å¹¶å°†åŠ¨ä½œæ·»åŠ åˆ°èœå•ä¸Šï¼›</li>
<li>åˆ›å»ºå·¥å…·æ å¹¶å°†åŠ¨ä½œæ·»åŠ åˆ°å·¥å…·æ ä¸Šï¼›</li>
</ol>
<p>ä»¥æœ¬ç« çš„é¡¹ç›®æ¥ä¸¾ä¸ªæ —å­ğŸŒ°ï¼š</p>
<p><strong>Firstly</strong>ï¼Œè¦åˆ›å»ºèœå•æ çš„é¡¹å¹¶è®¾ç½®å±æ€§ï¼šå®ç°ä¸Šé¢çš„ <code>MainWindow::createActions()</code> å‡½æ•°ï¼›</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::createActions</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// åˆ›å»ºæ–‡æœ¬ä¸ºâ€œNewâ€ã€çˆ¶æ§ä»¶ä¸º MainWindow çš„åŠ¨ä½œï¼ˆè¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨é‡Šæ”¾äº†ï¼‰</span><br>    newAction = <span class="hljs-keyword">new</span> <span class="hljs-built_in">QAction</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;New&quot;</span>), <span class="hljs-keyword">this</span>);<br>    newAction-&gt;<span class="hljs-built_in">setIcon</span>(<span class="hljs-built_in">QIcon</span>(<span class="hljs-string">&quot;:/image/new.png&quot;</span>));    <span class="hljs-comment">// è®¾ç½®åŠ¨ä½œçš„å›¾æ ‡</span><br>    newAction-&gt;<span class="hljs-built_in">setShortcut</span>(QKeySequence::New);        <span class="hljs-comment">// è®¾ç½®åŠ¨ä½œçš„å¿«æ·é”®</span><br>    <span class="hljs-comment">// è®¾ç½®æç¤ºæ€§æ–‡æœ¬</span><br>    newAction-&gt;<span class="hljs-built_in">setStatusTip</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Create a new holySheet file&quot;</span>));<br>    <span class="hljs-comment">// å°†åŠ¨ä½œé¡¹ä¸åº•å±‚å‡½æ•°è¿æ¥</span><br>    <span class="hljs-built_in">connect</span>(newAction, <span class="hljs-built_in">SINGAL</span>(<span class="hljs-built_in">triggered</span>()), <span class="hljs-keyword">this</span>, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">newFile</span>()));<br>    <br>    <span class="hljs-comment">// ä»¥ä¸‹çœç•¥ Openã€Saveã€Save As çš„åŠ¨ä½œç¼–å†™ï¼Œå› ä¸ºå‡ ä¹ä¸€æ¨¡ä¸€æ ·</span><br>    <span class="hljs-comment">// ... ...</span><br>    <br>    <span class="hljs-comment">// Recent Open Files åŠ¨ä½œ</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; MaxRecentFiles; ++i) &#123;<br>        recentFileActions[i] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">QAction</span>(<span class="hljs-keyword">this</span>);<br>        <span class="hljs-comment">// è¿™é‡Œè®¾ç½®éšè—ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡æ‰“å¼€æ²¡æœ‰æœ€è¿‘æ–‡ä»¶</span><br>        recentFileActions[i]-&gt;<span class="hljs-built_in">setVisible</span>(<span class="hljs-literal">false</span>);<br>        <span class="hljs-comment">// å°†åŠ¨ä½œå’Œåº•å±‚çš„ openRecentFile() è¿æ¥</span><br>        <span class="hljs-built_in">connect</span>(recentFileActions[i], <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">triggered</span>()),<br>               <span class="hljs-keyword">this</span>, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">openRecentFile</span>()));<br>    &#125;<br>    <br>    <span class="hljs-comment">// Exit åŠ¨ä½œ</span><br>    exitAction = <span class="hljs-keyword">new</span> <span class="hljs-built_in">QAction</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;Exit&quot;</span>), <span class="hljs-keyword">this</span>);<br>    exitAction-&gt;<span class="hljs-built_in">setShortcut</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Ctrl+Q&quot;</span>));<br>    exitAction-&gt;<span class="hljs-built_in">setStatusTip</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Exit the Application&quot;</span>));<br>    <span class="hljs-comment">// è¿™é‡Œçš„ close() æ˜¯ QWidget::close() è‡ªå¸¦æ§½</span><br>    <span class="hljs-built_in">connect</span>(exitAction, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">triggered</span>()), <span class="hljs-keyword">this</span>, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">close</span>()));<br>    <br>    <span class="hljs-comment">// Select All åŠ¨ä½œ</span><br>    selectAllAction = <span class="hljs-keyword">new</span> <span class="hljs-built_in">QAction</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;All&quot;</span>), <span class="hljs-keyword">this</span>);<br>    selectAllAction-&gt;<span class="hljs-built_in">setShortcut</span>(QKeySequence::SelectAll);<br>    selectAllAction-&gt;<span class="hljs-built_in">setStatusTip</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Select all the cells in the sheet&quot;</span>));<br>    <span class="hljs-comment">// æ³¨æ„ï¼Œè¿™é‡Œ holySheet æ˜¯è®¾è®¡æˆ QTableWidget çš„å­ç±»ï¼Œå› ä¸ºéœ€è¦çœ‹è¡¨ï¼›</span><br>    <span class="hljs-comment">// è€Œ QTableWidget å…·æœ‰å†…ç½®æ§½ selectAll()ï¼Œå› æ­¤æ— éœ€è‡ªè¡Œå®ç°</span><br>    <span class="hljs-built_in">connect</span>(selectAllAction, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">triggered</span>()),<br>           holySheet, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">selectAlll</span>()));<br>    <br>    <span class="hljs-comment">// è®¾ç½®ä¸­çš„ Show Grid åŠ¨ä½œï¼Œæ˜¯å¦å±•ç¤ºè¡¨æ ¼è¾¹æ¡†</span><br>    showGridAction = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Action</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;Show Grid&quot;</span>), <span class="hljs-keyword">this</span>);<br>    <span class="hljs-comment">// å¯å‹¾é€‰æ¨¡å¼</span><br>    showGridAction-&gt;<span class="hljs-built_in">setCheckable</span>(<span class="hljs-literal">true</span>);<br>    <span class="hljs-comment">// ä»Šåéœ€è¦åœ¨ holySheet ä¸­å®ç°çš„æ–¹æ³•ï¼ŒåŒæ­¥å‹¾é€‰çŠ¶æ€ å’Œ æ˜¾ç¤ºçŠ¶æ€</span><br>    showGridAction-&gt;<span class="hljs-built_in">setChecked</span>(holySheet-&gt;<span class="hljs-built_in">showGrid</span>());<br>    showGridAction-&gt;<span class="hljs-built_in">setStatusTip</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Show or hide the holySheet&#x27;s grid&quot;</span>));<br>    <span class="hljs-comment">// åˆä¸€ä¸ªä»Šåéœ€è¦åœ¨ holySheet ä¸­å®ç°çš„æ§½ï¼ŒåŒæ­¥å‹¾é€‰åŠ¨ä½œ å’Œ è®¾ç½®æ˜¾ç¤ºæ§½</span><br>    <span class="hljs-built_in">connect</span>(showGridAction, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">toggled</span>(<span class="hljs-type">bool</span>)),<br>           holySheet, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">setShowGrid</span>(<span class="hljs-type">bool</span>)));<br>    <br>    <span class="hljs-comment">// æ­¤å¤„çœç•¥ Auto Recalculate åŠ¨ä½œ</span><br>    <span class="hljs-comment">// ... ...</span><br>    <br>    <span class="hljs-comment">// About åŠ¨ä½œ</span><br>    aboutAction = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Action</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;About&quot;</span>), <span class="hljs-keyword">this</span>);<br>    aboutAction-&gt;<span class="hljs-built_in">setStatusTip</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Show the information about the app&quot;</span>));<br>    <span class="hljs-built_in">connect</span>(aboutAction, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">triggered</span>()), <span class="hljs-keyword">this</span>, <span class="hljs-built_in">about</span>());<br>    <span class="hljs-comment">// About Qt åŠ¨ä½œ</span><br>    aboutQtAction = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Action</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;About &amp;Qt&quot;</span>), <span class="hljs-keyword">this</span>);<br>    aboutQtAction-&gt;<span class="hljs-built_in">setStatusTip</span>(<span class="hljs-string">&quot;Show the Qt library&#x27;s About Box&quot;</span>);<br>    <span class="hljs-comment">// è¿™é‡Œçš„ qApp å°†è®¾ç½®ä¸ºå…¨å±€å˜é‡ï¼ŒQApplication ç±»ï¼ŒåŒ…å« aboutQt() æ–¹æ³•</span><br>    <span class="hljs-built_in">connect</span>(aboutQtAction, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">triggered</span>()), qApp, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">aboutQt</span>()));<br>&#125;<br></code></pre></td></tr></table></figure>
<ol>
<li><p>å…¶ä¸­ <code>QKeySequence</code> ç±»æä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„é”®ç›˜å¿«æ·é”®çš„å¯¹åº” enum å€¼ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹æ–‡æ¡£ä¸­ <code>enum QKeySequence::StandardKey</code> çš„æšä¸¾å€¼æ¥æ‰¾åˆ°è¿è¡Œå¹³å°ä¸Šæ­£ç¡®çš„å¿«æ·é”®è¡¨ç¤ºï¼›</p>
<blockquote>
<p>æ ‡å‡†é”®å¦‚ï¼šå…¨é€‰<code>QKeySequence::SelectAll =&gt; &quot;Ctrl+A&quot;</code>ï¼Œå¤åˆ¶ <code>Ctrl+C</code> ç­‰ï¼›</p>
<p>å¯æƒœçš„æ˜¯ï¼Œä¸Šé¢çš„ <strong>é€€å‡º</strong> å°±æ²¡æœ‰æ ‡å‡†åŒ–å¿«æ·é”®ï¼Œåªèƒ½è‡ªå®šä¹‰ï¼š<code>&quot;Ctrl+Q&quot;</code>ï¼›</p>
</blockquote>
</li>
<li><p>è¿˜å¯ä»¥é€šè¿‡ <code>QActionGroup</code> ç±»æ¥å®ç°<strong>ç›¸äº’æ’æ–¥</strong>çš„å‹¾é€‰ <code>Action</code>ï¼Œè¿™é‡Œä¸éœ€è¦å°±ä¸æ¼”ç¤ºäº†ï¼›</p>
</li>
</ol>
<p><strong>Secondly</strong>ï¼Œéœ€è¦åˆ›å»ºèœå•ï¼Œå¹¶ä¸”æŠŠåˆ›å»ºå¥½çš„èœå•é¡¹æ”¾è¿›èœå•ä¸­ï¼šå®ç° <code>MainWindow::createMenus()</code>ï¼›</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::createMenus</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// æ³¨æ„ï¼šQMainWindow å’Œ QMenu ç±»è¿›è¡Œäº†ç»„åˆï¼Œæœ¬èº«æœ‰ QMainWindow::menuBar()ï¼Œ</span><br>    <span class="hljs-comment">// è°ƒç”¨å³è¿”å›å†…åµŒäº QMainWindow ä¸­çš„èœå•æ ï¼Œä½ç½®è§ä¸Šé¢ QMainWindow ç»“æ„å±•ç¤º</span><br>    fileMenu = <span class="hljs-built_in">menuBar</span>()-&gt;<span class="hljs-built_in">addMenu</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;File&quot;</span>));<br>    fileMenu-&gt;<span class="hljs-built_in">addAction</span>(newAction);<br>    fileMenu-&gt;<span class="hljs-built_in">addAction</span>(openAction);<br>    fileMenu-&gt;<span class="hljs-built_in">addAction</span>(saveAction);<br>    fileMenu-&gt;<span class="hljs-built_in">addAction</span>(saveAsAction);<br>    separatorAction = fileMenu-&gt;<span class="hljs-built_in">addSeparator</span>();<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; MaxRecentFile; ++i)<br>        fileMenu-&gt;<span class="hljs-built_in">addAction</span>(recentFileActions[i]);<br>    fileMenu-&gt;<span class="hljs-built_in">addSeparator</span>();<br>    fileMenu-&gt;<span class="hljs-built_in">addSeparator</span>(exitAction);<br>    <br>    editMenu = <span class="hljs-built_in">menuBar</span>()-&gt;<span class="hljs-built_in">addMenu</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;Edit&quot;</span>));<br>    editMenu-&gt;<span class="hljs-built_in">addAction</span>(cutAction);<br>    editMenu-&gt;<span class="hljs-built_in">addAction</span>(copyAction);<br>    editMenu-&gt;<span class="hljs-built_in">addAction</span>(pasteAction);<br>    editMenu-&gt;<span class="hljs-built_in">addAction</span>(deleteAction);<br>    <br>    selectSubMenu = editMenu-&gt;<span class="hljs-built_in">addMenu</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;Select&quot;</span>));<br>    selectSubMenu-&gt;<span class="hljs-built_in">addAction</span>(selectRowAction);<br>    selectSubMenu-&gt;<span class="hljs-built_in">addAction</span>(selectColAction);<br>    selectSubMenu-&gt;<span class="hljs-built_in">addAction</span>(selectAllAction);<br>    <br>    editMenu-&gt;<span class="hljs-built_in">addSeparator</span>();<br>    editMenu-&gt;<span class="hljs-built_in">addAction</span>(findAction);<br>    editMenu-&gt;<span class="hljs-built_in">addAction</span>(goToCellAction);<br>    <br>    toolsMenu = <span class="hljs-built_in">menuBar</span>()-&gt;<span class="hljs-built_in">addMenu</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;Tools&quot;</span>));<br>    toolsMenu-&gt;<span class="hljs-built_in">addAction</span>(recalculationAction);<br>    toolsMenu-&gt;<span class="hljs-built_in">addAction</span>(sortAction);<br>    <br>    optionsMenu = <span class="hljs-built_in">menuBar</span>()-&gt;<span class="hljs-built_in">addMenu</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;Options&quot;</span>));<br>    optionsMenu-&gt;<span class="hljs-built_in">addAction</span>(showGridAction);<br>    optionsMenu-&gt;<span class="hljs-built_in">addAction</span>(autoRecalculation);<br>    <br>    <span class="hljs-comment">// è¿™æ˜¯èœå•é—´é—´éš”çš„å†™æ³•ï¼ŒmenuBar() æ²¡æœ‰ addMenuï¼Œæœ‰äº›ç³»ç»Ÿå‘ˆç°çš„æ˜¯</span><br>    <span class="hljs-comment">// å°†ä¹‹åçš„èœå•æ”¾åœ¨æœ€å³ä¾§ï¼Œæœ‰äº›ç³»ç»Ÿä¼šç›´æ¥å¿½ç•¥ï¼Œæœ‰äº›ç³»ç»Ÿä»…ä»…æ˜¾ç¤ºä¸€ä¸ªåˆ†å‰²çº¿</span><br>    <span class="hljs-built_in">menuBar</span>()-&gt;<span class="hljs-built_in">addSeparator</span>();<br>    <br>    helpMenu = <span class="hljs-built_in">menuBar</span>()-&gt;<span class="hljs-built_in">addMenu</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;Help&quot;</span>));<br>    helpMenu-&gt;<span class="hljs-built_in">addAction</span>(aboutAction);<br>    helpMenu-&gt;<span class="hljs-built_in">addAction</span>(aboutQtAction);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>Thirdly</strong>ï¼Œå®ç°å®Œèœå•æ ï¼Œå†å…³æ³¨ <strong>ä¸Šä¸‹æ–‡èœå•æ ï¼ˆcontext menu ç›´è¯‘ï¼Œæˆ–è¯‘ä½œ â€œå³é”®èœå•â€ï¼‰</strong>ï¼šå®ç° <code>MainWindow::createContextMenu()</code>ï¼›</p>
<p><strong>å®ç°ä¸Šä¸‹æ–‡èœå•çš„é‡è¦æœºåˆ¶æ˜¯ï¼šQt çš„ä¸Šä¸‹æ–‡èœå•ç­–ç•¥ï¼ˆcontext menu policyï¼‰</strong></p>
<p>ä»»ä½• QWidget éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³è”çš„ <code>QAction</code> åˆ—è¡¨ï¼Œä¹Ÿæœ‰ä¸Šä¸‹æ–‡èœå•ç­–ç•¥æšä¸¾å˜é‡ï¼š<code>enum Qt::ContextMenuPolicy</code>ï¼›å½“è®¾ç½®ä¸Šä¸‹æ–‡èœå•ç­–ç•¥ä¸ºæšä¸¾é‡ <code>Qt::ActionsContextMenu(=2)</code> æ—¶ï¼Œä¼šä»¥è¯¥ QAction åˆ—è¡¨ä¸º widget çš„ä¸Šä¸‹æ–‡èœå•ï¼Œå½“å³å‡»è¿™ä¸ª widget æ—¶ï¼Œä¼šå±•å¼€ä¸Šä¸‹æ–‡èœå•ï¼›</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::createContextMenu</span><span class="hljs-params">()</span> </span>&#123;<br>    holySheet-&gt;<span class="hljs-built_in">addAction</span>(cutAction);<br>    holySheet-&gt;<span class="hljs-built_in">addAction</span>(copyAction);<br>    holySheet-&gt;<span class="hljs-built_in">addAction</span>(pasteAction);<br>    holySheet-&gt;<span class="hljs-built_in">setContextMenuPolicy</span>(Qt::ActionsContextMenu);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ç§è®¾è®¡çš„æ–¹æ³•æ¯”è¾ƒç¹çï¼Œä¸é‡ç”¨ä¹‹å‰çš„ <code>QAction</code>ï¼Œå³ä¸Šä¸‹æ–‡èœå•ç­–ç•¥æ˜¯<code>Qt::DefaultContextMenu(=1)</code> æ—¶ï¼Œé‡æ–°å®ç°ï¼š<code>QWidget::contextMenuEvent()</code> å‡½æ•°ï¼Œåœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ª <code>QMenu</code>ï¼Œæ·»åŠ ï¼Œå†å¯¹è¯¥éƒ¨ä»¶è°ƒç”¨ <code>exec()</code>ï¼Œæ„Ÿå…´è¶£å¯ä»¥å°è¯•ï¼Œè¿™é‡Œä¸åšæ¼”ç¤ºï¼›</p>
<p><strong>Last but not the least</strong>ï¼Œå…³æ³¨<strong>å·¥å…·æ </strong>ï¼šå®ç° <code>MainWindow::createToolBars()</code>ï¼›æ³¨æ„ï¼Œå¦‚æœä½ ä¹‹å‰è®¾ç½®çš„ Action æœ‰è®¾ç½®å›¾æ ‡çš„è¯ï¼Œå¯ä»¥ç›´æ¥å¤ç”¨ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::createToolBars</span><span class="hljs-params">()</span> </span>&#123;<br>    fileToolBar = <span class="hljs-built_in">addToolBar</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;File&quot;</span>));<br>    fileToolBar-&gt;<span class="hljs-built_in">addAction</span>(newAction);<br>    fileToolBar-&gt;<span class="hljs-built_in">addAction</span>(openAction);<br>    fileToolBar-&gt;<span class="hljs-built_in">addAction</span>(saveAction);<br>    <br>    editToolBar = <span class="hljs-built_in">addToolBar</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;Edit&quot;</span>));<br>    editToolBar-&gt;<span class="hljs-built_in">addAction</span>(cutAction);<br>    editToolBar-&gt;<span class="hljs-built_in">addAction</span>(copyAction);<br>    editToolBar-&gt;<span class="hljs-built_in">addAction</span>(pasteAction);<br>    editToolBar-&gt;<span class="hljs-built_in">addSeparator</span>();<br>    editToolBar-&gt;<span class="hljs-built_in">addAction</span>(findAction);<br>    editToolBar-&gt;<span class="hljs-built_in">addAction</span>(goToCellAction);<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="4-1-3-è®¾ç½®çŠ¶æ€æ "><a href="#4-1-3-è®¾ç½®çŠ¶æ€æ " class="headerlink" title="4.1.3 è®¾ç½®çŠ¶æ€æ "></a>4.1.3 è®¾ç½®çŠ¶æ€æ </h3><blockquote>
<p>ä»€ä¹ˆæ˜¯çŠ¶æ€æ ï¼Ÿå¤§å®¶çœ‹ Microsoft Word ä¸­å·¦ä¸‹è§’æ¯å½“è¿›è¡Œä¸€äº›æ“ä½œæ—¶ï¼Œä¼šæ˜¾ç¤ºä¸åŒæ–‡å­—ï¼Œå¦‚ä¸‹ï¼Œè¿™å°±æ˜¯çŠ¶æ€æ ï¼š</p>
<p><img src="statusBar-example.png"></p>
</blockquote>
<p>ä¸‹é¢å®ç° <code>MainWindow::createStatusBar()</code>ï¼›</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::createStatusBar</span><span class="hljs-params">()</span> </span>&#123;<br>    locationLabel = <span class="hljs-keyword">new</span> <span class="hljs-built_in">QLabel</span>(<span class="hljs-string">&quot; w999 &quot;</span>);<br>    locationLabel-&gt;<span class="hljs-built_in">setAlignment</span>(Qt::AlignHCenter);<br>    locationLabel-&gt;<span class="hljs-built_in">setMinimumSize</span>(locationLabel-&gt;<span class="hljs-built_in">sizeHint</span>());<br>    <br>    formulaLabel = <span class="hljs-keyword">new</span> QLabel;<br>    formulaLabel-&gt;<span class="hljs-built_in">setIndent</span>(<span class="hljs-number">3</span>);<br>    <br>    <span class="hljs-built_in">statusBar</span>()-&gt;<span class="hljs-built_in">addWidget</span>(locationLabel);<br>    <span class="hljs-built_in">statusBar</span>()-&gt;<span class="hljs-built_in">addWidget</span>(formulaLabel, <span class="hljs-number">1</span>);<br>    <br>    <span class="hljs-built_in">connect</span>(holySheet, <span class="hljs-built_in">SIGANL</span>(<span class="hljs-built_in">currentCellChanged</span>(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, <span class="hljs-type">int</span>, <span class="hljs-type">int</span>)),<br>           <span class="hljs-keyword">this</span>, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">updateStatusBar</span>()));<br>    <span class="hljs-built_in">connect</span>(holySheet, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">modified</span>()),<br>           <span class="hljs-keyword">this</span>, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">holySheetModified</span>()));<br>    <span class="hljs-built_in">updateStatusBar</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™éƒ¨åˆ†çŠ¶æ€æ çš„å®ç°å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li><p>åˆ›å»ºæ§ä»¶ï¼ˆå¤§å¤šæ˜¯ QLabelï¼‰ï¼Œè®¾ç½®æ§ä»¶çš„å¸ƒå±€ï¼›</p>
<ul>
<li>åˆå§‹çš„ <code>locationLabel</code> è®¾ç½®å†…å®¹ â€œ w999 â€ è¡¨ç¤ºæœ€å¤§å•å…ƒæ ¼ä½ç½®ï¼Œé…åˆ <code>locationLabel-&gt;setMinmumSize(locationLabel-&gt;sizeHint())</code> å¯ä»¥ç¡®å®šä½ç½®çŠ¶æ€æ ‡ç­¾å¤§å°æ»¡è¶³è¦æ±‚ï¼›</li>
<li><code>locationLabel-&gt;setAlignment(Qt::AlignHCenter)</code> ç¡®ä¿æ–‡æœ¬å±…ä¸­å¯¹é½ï¼›</li>
<li><code>formulaLabel-&gt;setIndent(3)</code> è¡¨ç¤ºæ ‡ç­¾å†…æ·»åŠ æ–‡æœ¬ç¼©è¿›ï¼Œè¿™æ˜¯å®ç°ä¹‹åè¿›è¡Œçš„å¾®è°ƒï¼Œç¡®ä¿ç¾è§‚ï¼›</li>
<li><code>statusBar()-&gt;addWidget(QWidget*, int)</code> ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯<strong>ä¼¸å±•å› å­</strong>ï¼Œå‚æ•°ä¸º 0 è¡¨ç¤º<strong>ç´§è´´æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</strong>ï¼Œå‚æ•°ä¸º 1 è¡¨ç¤º<strong>æœ€å¤§å ç”¨æ¨¡å¼ï¼ˆè¿˜å‰©å¤šå°‘å°±å å¤šå°‘ï¼Œç±»ä¼¼ CSS ä¸­çš„ auto å‚æ•°ï¼‰</strong>ï¼›</li>
</ul>
</li>
<li><p>ä¸ºçŠ¶æ€æ çš„å˜åŒ–å»ºç«‹è¿æ¥ï¼›</p>
<ul>
<li><p>å…ˆåˆ©ç”¨å°†è¦å®ç°çš„ <code>holySheet</code> ä¿¡å· <code>currentCellChanged(int, int, int, int)</code>ï¼Œå’Œæ›´æ–°çŠ¶æ€æ çš„æ§½ <code>updateStatusBar()</code> ç»‘å®šï¼›<code>MainWindow::updateStatusBar()</code> å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::updateStatusBar</span><span class="hljs-params">()</span> </span>&#123;<br>    locationLabel-&gt;<span class="hljs-built_in">setText</span>(holySheet-&gt;<span class="hljs-built_in">currentLocation</span>());<br>    formulaLabel-&gt;<span class="hljs-built_in">setText</span>(holySheet-&gt;<span class="hljs-built_in">currentFormula</span>());<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>æ­¤å¤–ï¼Œä¸ºäº†å®ç° <strong>â€œå·²ä¿®æ”¹åä¼šæ”¹å˜çª—å£æ ‡é¢˜â€</strong>ï¼ˆå¾ˆå¤šè½¯ä»¶åœ¨æ–‡ä»¶ä¿®æ”¹åï¼Œä¼šåœ¨çª—å£æ ‡é¢˜åŠ ä¸€ä¸ªè®°å·ï¼Œå¦‚ <code>*</code>ï¼‰ ï¼Œè¿˜è¦å®ç° <code>MainWindow::holySheetModified()</code>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::holySheetModified</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// QMainWindow çš„å›ºæœ‰æ§½</span><br>    <span class="hljs-built_in">setWindowModified</span>(<span class="hljs-literal">true</span>);<br>    <span class="hljs-built_in">updateStatusBar</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œ<strong>æ¯ä¸ª <code>QWidget</code> éƒ½æœ‰ä¸€ä¸ª <code>windowModified</code> å±æ€§</strong> ~</p>
</li>
</ul>
</li>
</ol>
<h2 id="4-2-ä¸»çª—å£çš„åº•å±‚å‡½æ•°å®ç°"><a href="#4-2-ä¸»çª—å£çš„åº•å±‚å‡½æ•°å®ç°" class="headerlink" title="4.2 ä¸»çª—å£çš„åº•å±‚å‡½æ•°å®ç°"></a>4.2 ä¸»çª—å£çš„åº•å±‚å‡½æ•°å®ç°</h2><blockquote>
<p>å‡½æ•°æ¯”è¾ƒå¤šï¼Œè¿˜æ˜¯ä»çª—å£çš„èœå•åŠŸèƒ½ä¸‹æ‰‹ï¼›</p>
</blockquote>
<h3 id="4-2-1-File-èœå•"><a href="#4-2-1-File-èœå•" class="headerlink" title="4.2.1 File èœå•"></a>4.2.1 File èœå•</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// æ–°æ–‡ä»¶åˆ›å»º</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::newFile</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// å¦‚æœå½“å‰çª—å£æœ‰æ²¡ä¿å­˜çš„æ”¹åŠ¨ï¼Œæé†’æ˜¯å¦ä¿å­˜</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">okToContinue</span>()) &#123;<br>        holySheet-&gt;<span class="hljs-built_in">clear</span>();    <span class="hljs-comment">// holySheet ç­‰å¾…å®ç°çš„å‡½æ•°ï¼Œæ¸…å±</span><br>        <span class="hljs-built_in">setCurrentFile</span>(<span class="hljs-string">&quot;&quot;</span>);    <span class="hljs-comment">// å½“å‰æ–‡ä»¶å</span><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">MainWindow::okToContinue</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// å…ˆåˆ¤æ–­å½“å‰çª—å£æ˜¯å¦æœ‰æ²¡æœ‰ä¿å­˜çš„ä¿®æ”¹ï¼Œä¹Ÿæ˜¯ QMainWindow çš„æ–¹æ³•</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isWindowModified</span>()) &#123;<br>        <span class="hljs-type">int</span> res = QMessageBox::<span class="hljs-built_in">warning</span>(<br>            <span class="hljs-keyword">this</span>, <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;HolySheet&quot;</span>),<br>            <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;The document has been modified.\n&quot;</span><br>               <span class="hljs-string">&quot;Do you want to save your changes?&quot;</span>),<br>            QMessageBox::Yes | QMessageBox::No | QMessageBox::Cancel<br>        );<br>        <br>        <span class="hljs-keyword">if</span> (res == QMessageBox::Yes) <span class="hljs-keyword">return</span> <span class="hljs-built_in">save</span>();    <span class="hljs-comment">// ä¿å­˜æ›´æ”¹</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (res == QMessageBox::Cancel) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    <span class="hljs-comment">// ç¡®è®¤ç«‹å³ç»§ç»­</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>QMessageBox</code> æä¾›äº†å¾ˆå¤šæ ‡å‡†çš„ä¿¡æ¯å¯¹è¯æ¡†æ¨¡æ¿ï¼Œä¾‹å¦‚ï¼šæç¤ºä¿¡æ¯ã€æé—®ã€è­¦å‘Šã€ä¸¥é‡é”™è¯¯ï¼Œè¯­æ³•ï¼š<code>QMessageBox::warning(QWidget* parent, QString title, QString message, (enum)QMessageBox::StandardButtons buttons)</code>ï¼›</p>
<p>å…¶ä¸­æšä¸¾ç±»å‹ <code>QMessageBox::StandardButtons</code> å«æœ‰æšä¸¾å€¼ <code>QMessageBox::Yes</code>ã€<code>QMessageBox::No</code>ã€<code>QMessageBox::Cancel</code>ã€<code>QMessageBox::Apply</code>ç­‰ç­‰ï¼Œæœ‰ç‰¹æ®Šéœ€è¦å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œ<strong>è¿™é‡Œè®¾è®¡éå¸¸å·§å¦™ï¼Œæšä¸¾å€¼è®¾ç½®ä¸º 16 è¿›åˆ¶æ•°ç ï¼Œä½¿ç”¨å¤šä¸ª buttons æ—¶ï¼Œåˆ©ç”¨æŒ‰ä½æˆ– <code>|</code> ï¼ˆå‚è€ƒä¸Šé¢ä»£ç ï¼‰ï¼Œè¾¾åˆ°ç±»ä¼¼ Linux æƒé™æ©ç çš„å¤šé€‰æ•ˆæœ</strong>ï¼›</p>
<p>é™¤äº† <code>warning</code> è­¦å‘Šå¯¹è¯æ¡†ï¼Œè¿˜æœ‰ <code>information</code> æç¤ºå¯¹è¯æ¡†ã€<code>question</code> æé—®å¯¹è¯æ¡†ã€<code>critical</code> ä¸¥é‡é”™è¯¯å¯¹è¯æ¡†ï¼›<strong>è¯­æ³•æ˜¯ç›¸åŒçš„</strong>ï¼›</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// æ‰“å¼€å·²æœ‰æ–‡ä»¶</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::open</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">okToContinue</span>()) &#123;<br>        QString fileName = QFileDialog::<span class="hljs-built_in">getOpenFileName</span>(<br>                                <span class="hljs-keyword">this</span>, <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Open sheet&quot;</span>), <span class="hljs-string">&quot;.&quot;</span>,<br>                                <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;HolySheet file (*.hs)&quot;</span>)<br>                            );<br>        <span class="hljs-keyword">if</span> (!fileName.<span class="hljs-built_in">isEmpty</span>())<br>            <span class="hljs-built_in">loadFile</span>(fileName);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// åº•å±‚å®ç°ï¼šè½½å…¥æŒ‡å®šæ–‡ä»¶ï¼Œä¹‹æ‰€ä»¥ä¸å’Œ MainWindow::open() åˆåœ¨ä¸€èµ·ï¼Œå°±æ˜¯ä¸ºäº†åœ¨â€œæ‰“å¼€æœ€è¿‘æ–‡ä»¶â€çš„åŠŸèƒ½ä¸­é‡ç”¨</span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">MainWindow::loadFile</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; fileName)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!holySheet-&gt;<span class="hljs-built_in">readFile</span>(fileName)) &#123;    <span class="hljs-comment">// holySheet ç­‰å¾…å®ç°çš„å‡½æ•°</span><br>        <span class="hljs-built_in">statusBar</span>()-&gt;<span class="hljs-built_in">showMessage</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Loading canceled&quot;</span>), <span class="hljs-number">2000</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-built_in">setCurrentFile</span>(fileName);<br>    <span class="hljs-built_in">statusBar</span>()-&gt;<span class="hljs-built_in">showMessage</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;File loaded&quot;</span>), <span class="hljs-number">2000</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li><p>å€ŸåŠ©ä¸Šé¢çš„ä»£ç ï¼Œå†è¡¥å……ä¸€äº›é‡è¦çš„ç‚¹ï¼Œ<code>QFileDialog</code> ç±»æä¾›å„ç§<strong>æ‰“å¼€æ–‡ä»¶åï¼ˆâ€œæµè§ˆâ€ï¼‰</strong>çš„å¯¹è¯çª—å£ï¼Œå’Œå‰é¢ä»‹ç»çš„ <code>QMessageBox</code> éƒ½ç»§æ‰¿äº <code>QDialog</code>ï¼›æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ <code>QFileDialog::getOpenFileName(QWdiget* parent, QString title, QString startPath, QString filter)</code>ï¼›</p>
<p>è¿˜æœ‰ <code>QFileDialog::getSaveFileName(...)</code>ï¼Œè¯­æ³•ç›¸åŒï¼Œä¹‹å’Œä»£ç ä¼šä»‹ç»ï¼›</p>
<blockquote>
<p>æ³¨æ„ï¼šâ‘  è¿™é‡Œçš„QFileDialog ä¸€èˆ¬çª—å£ä¼˜å…ˆçº§éƒ½æ¯”çˆ¶çª—å£çš„é«˜ï¼Œæ˜¾ç¤ºåœ¨å…¶ä¸Šå±‚ï¼›â‘¡ æ–‡ä»¶è¿‡æ»¤å™¨å‚æ•° <code>filter</code> å‚æ•°çš„æ ¼å¼æ˜¯ â€œ<code>&lt;description&gt; (*.suffix)</code>â€ï¼Œå¦‚æœå…è®¸å¤šä¸ªæ–‡ä»¶ç±»å‹ï¼Œåˆ™ç”¨æ¢è¡Œç¬¦åˆ†å‰²ï¼šâ€œ<code>&lt;desc1&gt; (*.suffix1)\n&lt;desc2&gt; (*.suffix2)</code>â€ï¼›</p>
</blockquote>
</li>
<li><p><code>QStatusBar::showMessage(QString text, int milisec)</code> çš„è°ƒç”¨ä¸ä¼šå½±å“åˆ° <code>QStatusBar</code> ä¸­æ·»åŠ çš„ widgetï¼Œä¼šå•ç‹¬å†æ˜¾ç¤ºæ¶ˆæ¯ï¼›ç¬¬äºŒä¸ªå‚æ•° <code>milisec</code> è¡¨ç¤ºæ¶ˆæ¯åœç•™çš„<strong>æ¯«ç§’æ•°</strong>ï¼›</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">MainWindow::save</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (curFile.<span class="hljs-built_in">isEmpty</span>()) <span class="hljs-keyword">return</span> <span class="hljs-built_in">saveAs</span>();    <span class="hljs-comment">// å½“å‰ä¸å­˜åœ¨æ–‡ä»¶</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">saveFile</span>(curFile);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">MainWindow::saveFile</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; fileName)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!holySheet-&gt;<span class="hljs-built_in">writeFile</span>(fileName)) &#123;    <span class="hljs-comment">// holySheet ç­‰å¾…å®ç°çš„å‡½æ•°</span><br>        <span class="hljs-built_in">statusBar</span>()-&gt;<span class="hljs-built_in">showMessage</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Saving canceled&quot;</span>, <span class="hljs-number">2000</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-built_in">setCurrentFile</span>(fileName);    <span class="hljs-comment">// ä¿å­˜æˆåŠŸï¼Œåˆ™è®¾ç½®å½“å‰æ–‡ä»¶ä¸ºæŒ‡å®šæ–‡ä»¶</span><br>    <span class="hljs-built_in">statusBar</span>()-&gt;<span class="hljs-built_in">showMessage</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;File saved&quot;</span>), <span class="hljs-number">2000</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">MainWindow::saveAs</span><span class="hljs-params">()</span> </span>&#123;<br>    QString fileName = QFileDialog::<span class="hljs-built_in">getSaveFileName</span>(<br>                            <span class="hljs-keyword">this</span>, <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Save sheet&quot;</span>), <span class="hljs-string">&quot;.&quot;</span>,<br>                            <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;HolySheet file (*.hs)&quot;</span>)<br>                        );<br>    <span class="hljs-keyword">if</span> (fileName.<span class="hljs-built_in">isEmpty</span>()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">saveFile</span>(fileName);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ <code>QFileDialog::getSaveFileName</code> å’Œ <code>QFileDialog::getOpenFileName</code> ä¸åŒçš„æ˜¯ï¼Œ<strong>å¦‚æœç»™å®šçš„æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨å¼¹å‡ºå¯¹è¯æ¡†æé†’æ˜¯å¦éœ€è¦è¦†ç›–</strong>ï¼›ä¹Ÿå¯ä»¥ä¼ é€’é™„åŠ å‚æ•°ï¼š <code>QFileDialog::DontConfirmOverwrite</code>æ¥æ”¹å˜è¿™ä¸ªè¡Œä¸ºï¼›</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::closeEvent</span><span class="hljs-params">(QCloseEvent* event)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">okToContinue</span>()) &#123;<br>        <span class="hljs-built_in">writeSettings</span>();    <span class="hljs-comment">// å†™å…¥é…ç½®</span><br>        event-&gt;<span class="hljs-built_in">accept</span>();<br>    &#125;<br>    <span class="hljs-keyword">else</span> event-&gt;<span class="hljs-built_in">ignore</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿˜è®°å¾—ä¹‹å‰<strong>åœ¨å£°æ˜è¿™ä¸ªå‡½æ•°çš„æ—¶å€™çš„æ³¨é‡Šå†…å®¹</strong>å—ï¼Ÿ</p>
<p>æ­¤å¤–ï¼Œ<code>QApplication</code> é»˜è®¤ <code>quitOnLastWindowClosed = true</code>ï¼Œå¦‚æœæƒ³è¦**å…³é—­æœ€åä¸€ä¸ªçª—å£åï¼Œ<code>QApplication</code> ä»ç„¶è¿è¡Œï¼ˆä¾‹å¦‚æ‰˜ç›˜è¿è¡Œï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥å°†å®ƒè®¾ç½®ä¸º <code>false</code>ï¼›</p>
<p>é¡ºä¾¿å®ç°å†…éƒ¨å‡½æ•° <code>setCurrentFile</code> å’Œ <code>strippedName</code>ã€‚å‰è€…ç”¨äº<strong>æŒ‡å®šå½“å‰æ–‡ä»¶ï¼ˆ<code>curFile</code> ç§æœ‰å˜é‡ï¼‰ã€ä¿®æ”¹çª—å£æ ‡é¢˜ã€ä¿®æ”¹ â€œæœ€è¿‘æ–‡ä»¶â€ åˆ—è¡¨ã€ä¿®æ”¹çª—å£æ˜¯å¦æ”¹åŠ¨çš„çŠ¶æ€</strong>ï¼Œåè€…ç”¨äºå¾—åˆ°æ–‡ä»¶é™¤å»åç¼€çš„åå­—ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::setCurrentFile</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; fileName)</span> </span>&#123;<br>    curFile = fileName;<br>    <span class="hljs-built_in">setWindowModified</span>(<span class="hljs-literal">false</span>);<br>    <br>    QString shownName = <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Untitled&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!curFile.<span class="hljs-built_in">isEmpty</span>()) &#123;<br>        shownName = <span class="hljs-built_in">strippedName</span>(curFile);<br>        recentFiles.<span class="hljs-built_in">removeAll</span>(curFile);<br>        recentFiles.<span class="hljs-built_in">prepend</span>(curFile);<br>        <span class="hljs-built_in">updateRecentFileActions</span>();<br>    &#125;<br>    <span class="hljs-comment">// Qt çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼</span><br>    <span class="hljs-built_in">setWindowTitle</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;%1 [*] - %2&quot;</span>).<span class="hljs-built_in">arg</span>(shownName).<span class="hljs-built_in">arg</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;HolySheet&quot;</span>)));<br>&#125;<br><br><span class="hljs-function">QString <span class="hljs-title">MainWindow::strippedName</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; fullFileName)</span> </span>&#123;<br>    <span class="hljs-comment">// </span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">QFileInfo</span>(fullFileName).<span class="hljs-built_in">fileName</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸Šé¢æåˆ°äº†æ›´æ–° â€œæœ€è¿‘æ–‡ä»¶â€ åˆ—è¡¨ï¼Œè¿˜æœ‰ä¹‹å‰è¯´åˆ°çš„ â€œæœ€è¿‘æ–‡ä»¶â€ åˆ—è¡¨çš„åŠ¨ä½œç»‘å®šï¼Œç°åœ¨æ¥å®ç° <code>updateRecentFileActions</code>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::updateRecentFileActions</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-function">QMutableStringListIterator <span class="hljs-title">iter</span><span class="hljs-params">(recentFiles)</span></span>;<br>    <span class="hljs-keyword">while</span> (iter.<span class="hljs-built_in">hasNext</span>()) &#123;<br>        <span class="hljs-keyword">if</span> (!QFile::<span class="hljs-built_in">exists</span>(iter.<span class="hljs-built_in">next</span>()))<br>            iter.<span class="hljs-built_in">remove</span>();    <span class="hljs-comment">// ç§»é™¤è¿˜åœ¨åˆ—è¡¨ä¸­ï¼Œä½†å·²ä¸å­˜åœ¨çš„æ–‡ä»¶å</span><br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; MaxRecentFiles; ++i) &#123;<br>        <span class="hljs-keyword">if</span> (i &lt; recentFiles.<span class="hljs-built_in">count</span>()) &#123;<br>            QString text = <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;%1 %2&quot;</span><br>                              .<span class="hljs-built_in">arg</span>(i + <span class="hljs-number">1</span>)<br>                              .<span class="hljs-built_in">arg</span>(<span class="hljs-built_in">strippedName</span>(recentFiles[i]))<br>                             );<br>            recentFileActions[i]-&gt;<span class="hljs-built_in">setText</span>(text);<br>            recentFileActions[i]-&gt;<span class="hljs-built_in">setData</span>(recentFiles[i]);<br>            recentFileActions[i]-&gt;<span class="hljs-built_in">setVisible</span>(<span class="hljs-literal">true</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> recentFileActions[i]-&gt;<span class="hljs-built_in">setVisible</span>(<span class="hljs-literal">false</span>);<br>    &#125;<br>    seperatorAction-&gt;<span class="hljs-built_in">setVisible</span>(!recentFiles.<span class="hljs-built_in">isEmpty</span>());<br>&#125;<br></code></pre></td></tr></table></figure>
<p>é¦–å…ˆ <code>QMutableStringIterator</code> å¯ä»¥çœ‹ä½œæ˜¯ <code>QStringList</code>ï¼ˆ<code>recentFiles</code> çš„ç±»å‹ï¼‰çš„å¯å˜çš„è¿­ä»£å™¨ï¼›</p>
<p>å…¶æ¬¡ï¼Œå¯¹äº <code>recentFileActions[i]-&gt;setData(recentFiles[i])</code> è¿™ä¸€æ­¥ï¼Œå…¶å® <code>QAction</code> ç±»çš„å‡½æ•° <code>setData(QVariant qvar)</code> å¯¹åº”è®¾ç½®äº† <code>QVariant QAction::data</code>  æ•°æ®æˆå‘˜ï¼Œå®ƒå¯ä»¥ä¿å­˜å¾ˆå¤šç§ C++ / Qt çš„æ•°æ®ç±»å‹ï¼Œ<strong>åŒ…æ‹¬ <code>QString</code>ã€ä¸€åˆ‡ <code>numerical</code>ã€<code>bool</code>ã€<code>QStringList</code> ç­‰</strong>ï¼ˆä»¥åä¼šè¿›ä¸€æ­¥è®¨è®ºï¼‰ï¼›</p>
<p>ä¸‹é¢å®ç° <code>openRecentFile</code>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::openRecentFile</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">okToContinue</span>()) &#123;<br>        QAction* action = <span class="hljs-built_in">qobject_cast</span>&lt;QAction*&gt;(<span class="hljs-built_in">sender</span>());<br>        <span class="hljs-keyword">if</span> (action) <span class="hljs-built_in">loadFile</span>(<span class="hljs-built_in">action</span>()-&gt;<span class="hljs-built_in">data</span>().<span class="hljs-built_in">toString</span>());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>QObject::sender()</code> è¿”å› <code>QObject*</code>ï¼Œç”¨äº<strong>æŸ¥å‡ºæ˜¯å“ªä¸ªä¿¡å· / åŠ¨ä½œè°ƒç”¨äº†å½“å‰çš„æ§½ï¼ˆæ‰€ä»¥åœ¨æ§½å‡½æ•°å†…ä½¿ç”¨ï¼‰</strong>ï¼›è¿™é‡ŒçŸ¥é“è°ƒç”¨ <code>openRecentFile()</code> å‡½æ•°çš„ä¸€å®šæ˜¯ <code>QAction</code> çš„åŠ¨ä½œï¼Œæ‰€ä»¥å¼ºåˆ¶è½¬æ¢åˆ°å®ƒçš„æŒ‡é’ˆç±»å‹ï¼Œå¹¶ä¸”è¯»å‡º <code>data</code> æ•°æ®ï¼Œè¿›è€Œæ‰¾åˆ°ç‚¹å‡»çš„ â€œæœ€è¿‘æ–‡ä»¶â€ å¹¶è°ƒç”¨ <code>loadFile()</code>ï¼›</p>
<h3 id="4-2-2-ä¸»çª—å£è°ƒç”¨-Dialogï¼šæ¨¡æ€å’Œéæ¨¡æ€"><a href="#4-2-2-ä¸»çª—å£è°ƒç”¨-Dialogï¼šæ¨¡æ€å’Œéæ¨¡æ€" class="headerlink" title="4.2.2 ä¸»çª—å£è°ƒç”¨ Dialogï¼šæ¨¡æ€å’Œéæ¨¡æ€"></a>4.2.2 ä¸»çª—å£è°ƒç”¨ Dialogï¼šæ¨¡æ€å’Œéæ¨¡æ€</h3><p>è¿™é‡Œä¼šç”¨åˆ°ä¹‹å‰æ‰€å†™çš„ <code>findDialog</code>ã€<code>goToCellDialog</code>ã€<code>sortDialog</code> ç­‰å¯¹è¯æ¡†ï¼Œè¿›è¡ŒåŠŸèƒ½çš„<strong>æ‹¼æ¥</strong>ï¼ŒåŒæ—¶ä¼šåˆ¶ä½œç®€å•çš„ <code>about</code> å¯¹è¯æ¡†ã€‚</p>
<p>é¦–å…ˆæ˜¯ä¹‹å‰çš„ <code>findDialog</code> å¯¹è¯æ¡†ã€‚ç”±äºå¸Œæœ›ç”¨æˆ·å¯ä»¥åœ¨ä¸»çª—å£ã€å­çª—å£é—´<strong>è‡ªç”±åˆ‡æ¢</strong>ï¼ˆæ¯•ç«Ÿåªæ˜¯æŸ¥æ‰¾åŠŸèƒ½ï¼‰ï¼Œæ‰€ä»¥ <code>findDialog</code> å¿…é¡»æ˜¯ <strong>éæ¨¡æ€çš„ï¼ˆmodelessï¼‰</strong>â€”â€”åœ¨è¿è¡Œçš„ç¨‹åºä¸­ï¼Œè¿™ç§çª—å£ç‹¬ç«‹äºå…¶ä»–çª—å£ï¼Œä¸ä¼šè¦†ç›–æˆ–é˜»æŒ¡ï¼Œå®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::find</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!findDialog) &#123;    <span class="hljs-comment">// ä»æœªåˆ›å»ºè¿‡ findDialogï¼Œæ‡’åŠ è½½æ¨¡å¼</span><br>        findDialog = <span class="hljs-keyword">new</span> <span class="hljs-built_in">FindDialog</span>(<span class="hljs-keyword">this</span>);    <span class="hljs-comment">// è®¾ç½®çˆ¶å¯¹è±¡å¯ä»¥ä¸ç”¨å¦å¤–ææ„</span><br>        <span class="hljs-comment">// å°† findDialog çš„ä¸¤ä¸ªä¿¡å·ç»‘å®šåˆ° holySheet çš„ä¸¤ä¸ªæ§½ä¸Šè¿›è¡ŒæŸ¥æ‰¾å¤„ç†</span><br>        <span class="hljs-built_in">connect</span>(findDialog, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">findNext</span>(<span class="hljs-type">const</span> QString&amp;, Qt::CaseSensitivity)), holySheet, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">findNext</span>(<span class="hljs-type">const</span> QString&amp;, Qt::CaseSensitivity)));<br>        <span class="hljs-built_in">connect</span>(findDialog, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">findPrev</span>(<span class="hljs-type">const</span> QString&amp;, Qt::CaseSensitivity)), holySheet, <span class="hljs-built_in">SLOT</span>(<span class="hljs-type">const</span> QString&amp;, Qt::CaseSensitivity));<br>    &#125;<br>    <br>    findDialog-&gt;<span class="hljs-built_in">show</span>();<br>    findDialog-&gt;<span class="hljs-built_in">raise</span>();<br>    findDialog-&gt;<span class="hljs-built_in">activateWindow</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>é€šè¿‡ç‚¹å‡» <code>Edit-&gt;Find</code> èœå•æ¥è°ƒå‡º <code>find()</code> å‡½æ•°æœ‰ 3 ç§æƒ…å†µï¼š</p>
<ol>
<li>ç”¨æˆ·ç¬¬ä¸€æ¬¡è°ƒç”¨è¿™ä¸ªå¯¹è¯æ¡†ï¼šç”±äºæ‡’åŠ è½½ï¼Œä¼šå…ˆåˆ›å»ºå®ƒï¼Œå†æ‰“å¼€ï¼›</li>
<li>ç”¨æˆ·æ›¾ç»æ‰“å¼€è¿‡ï¼Œç°åœ¨æ˜¯å…³é—­ï¼ˆ<code>visible=false</code>ï¼‰çŠ¶æ€ï¼šç›´æ¥ <code>show()</code> å°±è¶³ä»¥å®Œæˆ<strong>æ˜¾ç¤ºã€ç½®é¡¶ã€æ¿€æ´»</strong>è¿™ 3 ä¸ªçŠ¶æ€ï¼›</li>
<li>ç”¨æˆ·æ›¾ç»æ‰“å¼€ï¼Œä»æ²¡æœ‰å…³é—­ï¼šè¿™æ—¶ <code>show()</code> ä¸èƒ½å®Œæˆç½®é¡¶ã€æ¿€æ´»è¿™ä¸¤ä¸ªçŠ¶æ€ï¼Œåˆ†åˆ«éœ€è¦ <code>raise()</code> å’Œ <code>activateWindow()</code> æ¥å®Œæˆï¼›</li>
</ol>
<p>æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œåé¢ 3 è¡Œè¿˜å¯ä»¥å†™æˆï¼šï¼ˆ<strong>ä¸è¿‡æ²¡å¿…è¦</strong>ï¼‰</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span> (findDialog-&gt;<span class="hljs-built_in">isHidden</span>()) findDialog-&gt;<span class="hljs-built_in">show</span>();<br><span class="hljs-keyword">else</span> &#123;<br>    findDialog-&gt;<span class="hljs-built_in">raise</span>();<br>    findDialog-&gt;<span class="hljs-built_in">activateWindow</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å†æ¥çœ‹ <code>goToCellDialog</code>ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·å¼¹å‡ºã€ä½¿ç”¨ã€å…³é—­å®ƒï¼Œä¸å¸Œæœ›åœ¨ä½¿ç”¨å®ƒçš„æœŸé—´å»ç¢°ä¸»çª—å£ï¼Œè¿™ç§å­çª—å£å°±æ˜¯ <strong>æ¨¡æ€çš„ï¼ˆmodalï¼‰</strong>â€”â€”å¯å¼¹å‡ºå¹¶é˜»å¡åº”ç”¨ç¨‹åºçš„å¯¹è¯æ¡†ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::goToCell</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// è¿™é‡Œä¸ºä»€ä¹ˆä¸ newï¼Œè€Œåªæ˜¯åœ¨æ ˆä¸­å»ºç«‹ä¸€ä¸ª dialogï¼Œæ˜¯ç”±å¯¹è¯æ¡†ç›®çš„å†³å®šï¼›</span><br>    <span class="hljs-comment">// è¿™é‡Œç”¨å®Œå°±å¯ä»¥é”€æ¯ï¼Œæ²¡å¿…è¦ new + delete.</span><br>    <span class="hljs-function">GoToCellDialog <span class="hljs-title">dialog</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>;<br>    <span class="hljs-keyword">if</span> (dialog.<span class="hljs-built_in">exec</span>()) &#123;<br>        QString str = dialog.lineEdit-&gt;<span class="hljs-built_in">text</span>().<span class="hljs-built_in">toUpper</span>();<br>        holySheet-&gt;<span class="hljs-built_in">setCurrentCell</span>(str.<span class="hljs-built_in">mid</span>(<span class="hljs-number">1</span>).<span class="hljs-built_in">toInt</span>() - <span class="hljs-number">1</span>, str[<span class="hljs-number">0</span>].<span class="hljs-built_in">unicode</span>() - <span class="hljs-string">&#x27;A&#x27;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼šæ¨¡æ€å¯¹è¯æ¡†ä¸èƒ½ä½¿ç”¨ <code>show()</code>ï¼Œå¦åˆ™å˜æˆéæ¨¡æ€å¯¹è¯æ¡†ï¼åº”è¯¥ä½¿ç”¨ <code>QDialog::exec()</code> é˜»å¡è·å–å¯¹è¯æ¡†è¿”å›ç»“æœ</strong>ï¼ˆç”± <code>accept()</code> å’Œ <code>reject()</code> å†³å®šï¼Œ<code>QDialog::Accepted=true</code>ã€<code>QDialog::Rejected=false</code>ï¼‰ï¼›</p>
<p>å¦å¤–ï¼Œ<code>HolySheet::setCurrentCell(int x, int y)</code> ç­‰å¾…å®ç°ï¼›</p>
<p><code>QString::mid(int)</code> æŒ‡æå–ä»ç¬¬ int ä¸ªå­—ç¬¦ä¸²ä»¥åçš„å­ä¸²ã€<code>toInt()</code> ä¸è§£é‡Šï¼Œå…¶æ­£ç¡®æ€§ç”±ä¹‹å‰ <code>GoToCellDialog::lineEdit</code> ä¸­è®¾ç½®çš„ <code>QRegExpValidator</code> æ¥ä¿è¯ï¼›</p>
<p>å†æ¥çœ‹ <code>sortDialog</code>ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡æ€å¯¹è¯æ¡†ï¼Œå…è®¸ç”¨æˆ·<strong>åœ¨å½“å‰é€‰å®šåŒºåŸŸ</strong>ä½¿ç”¨<strong>ç»™å®šçš„åˆ—</strong>è¿›è¡Œæ’åºï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::sort</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-function">SortDialog <span class="hljs-title">dialog</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>;<br>    <span class="hljs-comment">// æ³¨æ„ï¼šè¿™ä¸ªå‡½æ•°æ²¡å†™é”™ï¼Œå°±æ˜¯ä¹‹åéœ€è¦åœ¨ HolySheet ç±»ä¸­å®ç°çš„ä¸€ä¸ªå‡½æ•°</span><br>    <span class="hljs-comment">// å®ƒä¸æ˜¯ QTableWidget çš„åŸç”Ÿå‡½æ•° selectRanges()</span><br>    QTableWidgetSelectionRange range = holySheet-&gt;<span class="hljs-built_in">selectedRange</span>();<br>    dialog.<span class="hljs-built_in">setColumnRange</span>(<span class="hljs-string">&#x27;A&#x27;</span> + range.<span class="hljs-built_in">leftColumn</span>(),<br>                          <span class="hljs-string">&#x27;A&#x27;</span> + range.<span class="hljs-built_in">rightColumn</span>());<br>    <span class="hljs-keyword">if</span> (dialog.<span class="hljs-built_in">exec</span>()) &#123;<br>        <br>        HolySheetCompare compare;<br>        compare.keys[<span class="hljs-number">0</span>] = dialog.primaryColumnCombo-&gt;<span class="hljs-built_in">currentIndex</span>();<br>        compare.keys[<span class="hljs-number">1</span>] = dialog.secondaryColumnCombo-&gt;<span class="hljs-built_in">currentIndex</span>() - <span class="hljs-number">1</span>;<br>        compare.keys[<span class="hljs-number">2</span>] = dialog.tertiaryColumnCombo-&gt;<span class="hljs-built_in">currentIndex</span>() - <span class="hljs-number">1</span>;<br>        compare.ascending[<span class="hljs-number">0</span>] = <br>            (dialog.primaryColumnCombo-&gt;<span class="hljs-built_in">currentIndex</span>() == <span class="hljs-number">0</span>);<br>        compare.ascending[<span class="hljs-number">1</span>] = <br>            (dialog.secondaryColumnCombo-&gt;<span class="hljs-built_in">currentIndex</span>() == <span class="hljs-number">0</span>);<br>        compare.ascending[<span class="hljs-number">2</span>] = <br>            (dialog.tertiaryColumnCombo-&gt;<span class="hljs-built_in">currentIndex</span>() == <span class="hljs-number">0</span>);<br>        <br>        holySheet-&gt;<span class="hljs-built_in">sort</span>(compare);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°äº† 2 ä¸ªæ–°ç±»ã€‚ä¸€ä¸ªæ˜¯ Qt åŸç”Ÿçš„ <code>QTableWidgetSelectionRange</code>ï¼Œç”¨æ¥è®°å½• <code>QTableWidget</code> é€‰ä¸­çš„åŒºåŸŸä¿¡æ¯ï¼Œå¯ä»¥ç”± <code>QTableWidget::selectRange()</code> å¾—åˆ°å½“å‰é€‰ä¸­çš„èŒƒå›´ã€‚å«æœ‰ <code>leftColumn()</code>ã€<code>rightColumn()</code> æ–¹æ³•æŸ¥åˆ°åŒºåŸŸçš„åˆ—ï¼›</p>
<blockquote>
<p>æ³¨æ„ï¼š<code>SortDialog::setColumnRange</code> æ˜¯ä¹‹å‰æˆ‘ä»¬è‡ªå·±å®šä¹‰ä¸ºäº† <code>column ComboBox</code> çš„å–å€¼èŒƒå›´è€Œè®¾ç½®çš„å‡½æ•°ã€‚</p>
</blockquote>
<p>å¦ä¸€ä¸ªç±»æ˜¯ <code>HolySheetCompare</code>ï¼Œå’Œ <code>HolySheet</code> ä¸€æ ·ï¼Œæ˜¯ä¹‹åæˆ‘ä»¬è‡ªå·±ä¼šå®ç°çš„ç±»ã€‚è¿™ä¸ªç±»å­˜å‚¨<strong>ä¸»é”®ã€ç¬¬äºŒé”®ã€ç¬¬ä¸‰é”®ä»¥åŠå®ƒä»¬çš„æ’åºé¡ºåºï¼ˆ<code>keys</code> æ•°ç»„å­˜å‚¨é”®çš„åˆ—å·ï¼Œ<code>ascending</code> æ•°ç»„æŒ‰ <code>bool</code> æ ¼å¼å­˜å‚¨æ¯ä¸ªé”®ç›¸å…³é¡ºåºï¼‰</strong>ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥è¢« <code>HolySheet::sort()</code> ä½¿ç”¨ï¼Œç”¨äºä¸¤è¡Œé—´çš„æ¯”è¾ƒï¼›</p>
<blockquote>
<p>æ³¨æ„ï¼š<code>QComboBox::currentIndex()</code> è¿”å›å½“å‰é€‰å®šé¡¹çš„ç´¢å¼•å€¼ï¼Œç¬¬ä¸€ä¸ªä¸º 0ï¼›</p>
<p>ä¸Šé¢çš„ â€œ-1â€ æŒ‡å»é™¤å‰é¢çš„ â€œNoneâ€ è®¾ç½®å€¼ã€‚</p>
</blockquote>
<p>æœ¬èŠ‚æœ€åï¼Œæˆ‘ä»¬åˆ¶ä½œä¸€ä¸ªç®€å•çš„ <code>About</code> å¯¹è¯æ¡†ï¼Œåªéœ€è¦é™æ€å‡½æ•° <code>QMessageBox::about</code> å°±è¡Œï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::about</span><span class="hljs-params">()</span> </span>&#123;<br>    QMessageBox::<span class="hljs-built_in">about</span>(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;About HolySheet&quot;</span>),<br>                      <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&lt;h2&gt;HolySheet 0.1&lt;/h2&gt;&quot;</span><br>                         <span class="hljs-string">&quot;&lt;p&gt;Copyright &amp;copy; 2023 SJTU-XHW Inc.&lt;/p&gt;&quot;</span><br>                         <span class="hljs-string">&quot;&lt;p&gt;HolySheet is a small application that &quot;</span><br>                         <span class="hljs-string">&quot;demonstrate QAction, QMainWindow, QMenuBar, &quot;</span><br>                         <span class="hljs-string">&quot;QStatusBar, QTableWidget, QToolBar and many &quot;</span><br>                         <span class="hljs-string">&quot;other Qt classes.&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>QMessageBox::about(QWidget* parent, const QString&amp; title, const QString&amp; contents)</code> å’Œ <code>warning/information/critical</code> ä¸åŒçš„æ˜¯ï¼Œ<strong>å®ƒçš„å›¾æ ‡å–å†³äºçˆ¶æ§ä»¶çš„å›¾æ ‡</strong>ã€‚</p>
<h3 id="4-2-3-è®¾ç½®çš„æŒä¹…åŒ–"><a href="#4-2-3-è®¾ç½®çš„æŒä¹…åŒ–" class="headerlink" title="4.2.3 è®¾ç½®çš„æŒä¹…åŒ–"></a>4.2.3 è®¾ç½®çš„æŒä¹…åŒ–</h3><p>ç°åœ¨å…³æ³¨ <code>readSettings()</code>ã€<code>writeSettings()</code> å‡½æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::writeSettings</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-function">QSettings <span class="hljs-title">settings</span><span class="hljs-params">(<span class="hljs-string">&quot;SJTU-XHW Inc.&quot;</span>, <span class="hljs-string">&quot;HolySheet&quot;</span>)</span></span>;<br>    <span class="hljs-comment">// è¿™é‡Œçš„ saveGeometry() æ˜¯ QWidget ç±»çš„åŸç”Ÿæ–¹æ³•ï¼Œ</span><br>    <span class="hljs-comment">// è¿”å› QByteArrayï¼Œå¯ä»¥è¢« QVariant å­˜å‚¨</span><br>    settings.<span class="hljs-built_in">setValue</span>(<span class="hljs-string">&quot;geometry&quot;</span>, <span class="hljs-built_in">saveGeometry</span>());<br>    settings.<span class="hljs-built_in">setValue</span>(<span class="hljs-string">&quot;recentFiles&quot;</span>, recentFiles);<br>    settings.<span class="hljs-built_in">setValue</span>(<span class="hljs-string">&quot;showGrid&quot;</span>, showGridAction-&gt;<span class="hljs-built_in">isChecked</span>());<br>    settings.<span class="hljs-built_in">setValue</span>(<span class="hljs-string">&quot;autoRecalc&quot;</span>, autoRecalcAction-&gt;<span class="hljs-built_in">isChecked</span>());<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ <code>QSettings</code> ç±»çš„å€¼è®¾ç½®éå¸¸ç±»ä¼¼ <code>Python</code> çš„å­—å…¸é”®å€¼å¯¹ï¼Œå€¼ä¹Ÿæ˜¯ç”¨ <code>QVariant</code> å­˜å‚¨çš„ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>QSettings</code> åœ¨ç³»ç»Ÿä¸Šå­˜å‚¨æ–¹æ³•å’Œç³»ç»Ÿç§ç±»æœ‰å…³ï¼ˆ<code>Windows</code> ä¸Šå°±å­˜åœ¨æ³¨å†Œè¡¨ï¼Œ<code>UNIX</code> å­˜åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œ<code>MacOS</code> å­˜åœ¨ <code>Core Foundation Preferences</code> ç¼–ç¨‹æ¥å£ä¸­ï¼‰ï¼Œè¯¦ç»†å†…å®¹å¦‚ä¸‹è¡¨ï¼š</p>
<table>
    <tr style="text-align: center;">
        <th>Platform</th>
        <th>Format</th>
        <th>Scope</th>
        <th>Path</th>
    </tr>
    <tr>
        <td rowspan=4>Windows</td>
        <td rowspan=2>Native</td>
        <td>User</td>
        <td>HKEY_CURRENT_USER\Software\*</td>
    </tr>
    <tr>
        <td>System</td>
        <td>HKEY_LOCAL_MACHINE\Software\*</td>
    </tr>
    <tr>
        <td rowspan=2>INI</td>
        <td>User</td>
        <td>%APPDATA%\*.ini</td>
    </tr>
    <tr>
        <td>System</td>
        <td>%COMMON_APPDATA%\*.ini</td>
    </tr>
    <tr>
        <td rowspan=4>Unix</td>
        <td rowspan=2>Native</td>
        <td>User</td>
        <td>$HOME/.config/*.conf</td>
    </tr>
    <tr>
        <td>System</td>
        <td>/etc/xdg/*.conf</td>
    </tr>
    <tr>
        <td rowspan=2>INI</td>
        <td>User</td>
        <td>$HOME/.config/*.ini</td>
    </tr>
    <tr>
        <td>System</td>
        <td> /etc/xdg/*.ini</td>
    </tr>
    <tr>
        <td rowspan=4>Mac OS X</td>
        <td rowspan=2>Native</td>
        <td>User</td>
        <td>$HOME/Library/Preferences/com.*.plist</td>
    </tr>
    <tr>
        <td>System</td>
        <td> /Library/Preferences/com.*.plist</td>
    </tr>
    <tr>
        <td rowspan=2>INI</td>
        <td>User</td>
        <td> $HOME/.config/*.ini</td>
    </tr>
    <tr>
        <td>System</td>
        <td> /etc/xdg/*.ini</td>
    </tr>
</table>


<p><code>QSettings</code> ç±»çš„æ„é€ å‡½æ•°çš„å‚æ•°åˆ†åˆ«æ˜¯ç»„ç»‡åã€ç¨‹åºåï¼Œä¸ºçš„æ˜¯æ–¹ä¾¿è®¾ç½®çš„<strong>è¯»å–ã€æŸ¥æ‰¾</strong>ã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>QSettings</code> çš„è®¾ç½®è¿˜èƒ½ä»¥è·¯å¾„å½¢å¼æŒ‡å®šå­é”®çš„å€¼ï¼ˆå¦‚ <code>findDialog/matchCase</code>ï¼‰æˆ–è€…ç”¨ <code>beginGroup(QString)</code> å’Œ <code>endGroup()</code> çš„å½¢å¼ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++">settings.<span class="hljs-built_in">beginGroup</span>(<span class="hljs-string">&quot;findDialog&quot;</span>);<br>settings.<span class="hljs-built_in">setValue</span>(<span class="hljs-string">&quot;matchCase&quot;</span>, caseCheckBox-&gt;<span class="hljs-built_in">isChecked</span>());<br>settings.<span class="hljs-built_in">setValue</span>(<span class="hljs-string">&quot;searchBackward&quot;</span>, backwardCheckBox-&gt;<span class="hljs-built_in">isChecked</span>());<br>settings.<span class="hljs-built_in">endGroup</span>();<br></code></pre></td></tr></table></figure>
<p>è¿˜æœ‰ <code>readSettings</code>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::readSettings</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// æŒ‰ç»„ç»‡å + ç¨‹åºåè¯»å–è®¾ç½®</span><br>    <span class="hljs-function">QSettings <span class="hljs-title">settings</span><span class="hljs-params">(<span class="hljs-string">&quot;SJTU-XHW Inc.&quot;</span>, <span class="hljs-string">&quot;HolySheet&quot;</span>)</span></span>;<br>    <span class="hljs-built_in">restoreGeometry</span>(settings.<span class="hljs-built_in">value</span>(<span class="hljs-string">&quot;geometry&quot;</span>).<span class="hljs-built_in">toByteArray</span>());<br>    recentFiles = settings.<span class="hljs-built_in">value</span>(<span class="hljs-string">&quot;recentFiles&quot;</span>).<span class="hljs-built_in">toStringList</span>();<br>    <span class="hljs-built_in">updateRecentActions</span>();    <span class="hljs-comment">// æ›´æ–° â€œæœ€è¿‘æ–‡ä»¶â€ èœå•æ </span><br>    <br>    <span class="hljs-comment">// ç¬¬äºŒå‚æ•°æ˜¯é»˜è®¤å€¼ï¼Œç±»ä¼¼ Python dict ç±»çš„ setdefault()</span><br>    <span class="hljs-type">bool</span> showGrid = settings.<span class="hljs-built_in">value</span>(<span class="hljs-string">&quot;showGrid&quot;</span>, <span class="hljs-literal">true</span>).<span class="hljs-built_in">toBool</span>();<br>    showGridAction-&gt;<span class="hljs-built_in">setChecked</span>(showGrid);<br>    <br>    <span class="hljs-type">bool</span> autoRecalc = settings.<span class="hljs-built_in">value</span>(<span class="hljs-string">&quot;autoRecalc&quot;</span>, <span class="hljs-literal">true</span>).<span class="hljs-built_in">toBool</span>();<br>    autoRecalcAction-&gt;<span class="hljs-built_in">setChecked</span>(autoRecalc);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æ‚¨è¿˜å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„å…¶ä»–ä»»ä½•åœ°æ–¹ä½¿ç”¨ <code>QSettings</code> æ–¹ä¾¿åœ°æŸ¥è¯¢ã€ä¿®æ”¹è®¾ç½®ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ<code>MainWindow</code> åŠå…¶ UI ç•Œé¢å·²ç»å‡ ä¹å®Œå…¨å®ç°ï¼Œä¸»è¦çš„ä»»åŠ¡å°±æ˜¯å®ç° <code>HolySheet</code> ç±»å’Œ <code>HolySheetCompare</code> ç±»äº†ã€‚</p>
<h3 id="4-2-4-é”¦ä¸Šæ·»èŠ±ï¼šå¤šæ–‡æ¡£æ¨¡å¼"><a href="#4-2-4-é”¦ä¸Šæ·»èŠ±ï¼šå¤šæ–‡æ¡£æ¨¡å¼" class="headerlink" title="4.2.4 é”¦ä¸Šæ·»èŠ±ï¼šå¤šæ–‡æ¡£æ¨¡å¼"></a>4.2.4 é”¦ä¸Šæ·»èŠ±ï¼šå¤šæ–‡æ¡£æ¨¡å¼</h3><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å‡†å¤‡ç¼–å†™ç¨‹åºçš„ <code>main</code> å‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: main.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QApplication&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mainWindow.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> </span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">app</span><span class="hljs-params">(argc, argv)</span></span>;<br>    MainWindow win;        <span class="hljs-comment">// è¿™é‡Œä¸ç”¨ new åˆ›å»º</span><br>    win.<span class="hljs-built_in">show</span>();<br>    <span class="hljs-keyword">return</span> app.<span class="hljs-built_in">exec</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬æƒ³è¦<strong>åŒä¸€æ—¶é—´æ‰“å¼€ã€å¤„ç†å¤šä¸ªè¡¨æ ¼</strong>ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<p>è‚¯å®šä¸èƒ½è®©ç”¨æˆ·é‡å¤æ‰“å¼€ç¨‹åºâ€”â€”è¿™æ˜¯ä¸æ–¹ä¾¿çš„ã€‚åº”è¯¥åƒæµè§ˆå™¨æ‰“å¼€é¡µé¢ä¸€æ ·ï¼Œæä¾›å¤šä¸ªçª—å£ã€‚è¿™å°±æ˜¯ç¨‹åºçš„<strong>å¤šçª—å£ï¼ˆæ–‡æ¡£ï¼‰æ¨¡å¼</strong>ã€‚</p>
<p>è¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹ <code>File</code> èœå•è¿›è¡Œä¸€äº›æ”¹åŠ¨ï¼Œ<strong>ä½¿å¾—ä¸€ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹ï¼Œèƒ½å¤Ÿå¤„ç†å¤šä¸ªæ–‡æ¡£</strong>ï¼š</p>
<ul>
<li><p><code>File-&gt;New</code> æ“ä½œä¸å†æ˜¯ä½¿ç”¨åŸå…ˆå­˜åœ¨çš„çª—å£ï¼Œè€Œæ˜¯<strong>åˆ›å»ºä¸€ä¸ªç©ºæ–‡æ¡£çª—å£</strong>ï¼Œå·²å­˜åœ¨çš„çª—å£éœ€è¦æ‰‹åŠ¨å…³é—­ï¼›</p>
</li>
<li><p><code>File-&gt;Close</code> å…³é—­å½“å‰çš„ä¸»çª—å£ï¼Œè€Œä¸æ˜¯æ¸…é™¤å†…å®¹ï¼›</p>
<blockquote>
<p><strong>æ³¨ï¼šåŸæ¥çš„ <code>MainWindow</code> æ²¡æœ‰è¿™ä¸ª <code>Close</code> é€‰é¡¹ï¼Œå› ä¸ºæ˜¯å•çª—å£ï¼Œå®ƒçš„ä½œç”¨å’Œ <code>Exit</code> ç›¸åŒ</strong>ï¼›</p>
</blockquote>
</li>
<li><p><code>File-&gt;Exit</code> å…³é—­æ‰€æœ‰çª—å£ï¼Œè€Œä¸æ˜¯å…³é—­å½“å‰ä»…æœ‰çš„çª—å£ã€‚</p>
</li>
</ul>
<p>æƒ³è¦å…·æœ‰å¤šçª—å£åŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨ <code>new</code> æ¥ç»Ÿä¸€åˆ›å»ºã€é”€æ¯çª—å£ã€‚æ‰€ä»¥ <code>main.cpp</code> æ”¹ä¸ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: main.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QApplication&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mainWindow.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> </span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">app</span><span class="hljs-params">(argc, argv)</span></span>;<br>    MainWindow* win = <span class="hljs-keyword">new</span> MainWindow;<br>    win-&gt;<span class="hljs-built_in">show</span>();<br>    <span class="hljs-keyword">return</span> app.<span class="hljs-built_in">exec</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ç´§æ¥ç€ä¿®æ”¹ <code>newFile()</code> æ§½å’Œ <code>Actions</code> çš„ç»„æˆå’Œæç¤ºä¿¡æ¯ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: mainWindow.cpp</span><br><span class="hljs-comment">// ...</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWondow::newFile</span><span class="hljs-params">()</span> </span>&#123;<br>    MainWindow* otherWin = <span class="hljs-keyword">new</span> MainWindow;<br>    otherWin-&gt;<span class="hljs-built_in">show</span>();<br>&#125;<br><br><span class="hljs-comment">// ...</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MainWindow::createActions</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <br>    closeAction = <span class="hljs-keyword">new</span> <span class="hljs-built_in">QAction</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;&amp;Close&quot;</span>), <span class="hljs-keyword">this</span>);<br>    closeAction-&gt;<span class="hljs-built_in">setShortCut</span>(QKeySequence::Close);<br>    closeAction-&gt;<span class="hljs-built_in">setStatusTip</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Close this window&quot;</span>));<br>    <span class="hljs-built_in">connect</span>(closeAction, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">triggered</span>()), <span class="hljs-keyword">this</span>, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">close</span>()));<br>    <br>    exitAction = <span class="hljs-keyword">new</span> <span class="hljs-built_in">QAction</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;E&amp;xit&quot;</span>), <span class="hljs-keyword">this</span>);<br>    exitAction-&gt;<span class="hljs-built_in">setShortcut</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Ctrl+Q&quot;</span>));<br>    exitAction-&gt;<span class="hljs-built_in">setStatusTip</span>(<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Exit the application&quot;</span>));<br>    <span class="hljs-built_in">connect</span>(exitAction, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">triggered</span>()), qApp, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">closeAllWindows</span>()));<br>    <br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>QApplication</code> çš„æ§½ <code>closeAllWindows()</code> ä¼šå…³é—­æ‰€æœ‰åœ¨ <code>app</code> å¾ªç¯ä¸­åˆ›å»ºçš„çª—å£ï¼Œå¹¶ä¸”ä¸ç”¨æ‹…å¿ƒé‡Šæ”¾é—®é¢˜ï¼Œæ¯ä¸ªçª—å£éƒ½ä¼šè°ƒç”¨ <code>closeEvent()</code> å¤„ç†ã€‚</p>
<p>åŒæ—¶éœ€è¦æ³¨æ„å¦ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯åˆ›å»ºçª—å£è¿‡å¤šçš„é—®é¢˜ã€‚<strong>è¿™æ—¶å°±éœ€è¦è€ƒè™‘ <code>MainWindow</code> çš„ææ„é—®é¢˜äº†</strong>ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++">MainWindow::<span class="hljs-built_in">MainWindow</span>() &#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-built_in">setAttribute</span>(Qt::WA_DeleteOnClose);<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™ä¸ªè®¾ç½®ä¼šä½¿å¾—æ‰€æœ‰ <code>close()</code> çš„æ§ä»¶ç«‹å³è¢«ææ„ã€‚å¯æ˜¯æœ‰ä¸ªæ›´éœ€è¦è§£å†³çš„é—®é¢˜ï¼š<strong>â€œæœ€è¿‘æ–‡ä»¶â€ åˆ—è¡¨çš„é—®é¢˜</strong>â€”â€”å¤šä¸ªçª—å£éœ€è¦å…±äº«ä¸€ä¸ª â€œæœ€è¿‘æ–‡ä»¶â€ çš„åˆ—è¡¨ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡å°† <code>recentFiles</code> æ”¹æˆé™æ€å˜é‡çš„æ–¹æ³•è§£å†³ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œæ€è€ƒã€‚</p>
<p>å®ç°æœ¬èŠ‚ â€œå¤šæ–‡æ¡£â€ çš„ç›®æ ‡ä¸æ­¢è¿™ä¸€ç§ï¼Œè¿˜å¯ä»¥é‡‡ç”¨ <code>Qt</code> çš„ <code>MDI</code>ï¼ˆmultiple document interfaceï¼‰ç®¡ç†æ–¹æ³•ï¼Œä»¥åä»‹ç»ã€‚</p>
<h3 id="4-2-5-é”¦ä¸Šæ·»èŠ±ï¼šç¨‹åºå¯åŠ¨ç”»é¢"><a href="#4-2-5-é”¦ä¸Šæ·»èŠ±ï¼šç¨‹åºå¯åŠ¨ç”»é¢" class="headerlink" title="4.2.5 é”¦ä¸Šæ·»èŠ±ï¼šç¨‹åºå¯åŠ¨ç”»é¢"></a>4.2.5 é”¦ä¸Šæ·»èŠ±ï¼šç¨‹åºå¯åŠ¨ç”»é¢</h3><p>è¿™ä¸ªéœ€æ±‚å¯èƒ½æ˜¯å› ä¸ºç”²æ–¹çš„è¦æ±‚ï¼Œåˆæˆ–æ˜¯è¦æ©é¥°ç¨‹åºå¯åŠ¨æ…¢çš„äº‹å®ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ï¼›å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨ <code>main</code> å‡½æ•°ä¸­ä½¿ç”¨ <code>QSplashScreen</code> ç±»å°±èƒ½è§£å†³ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> </span>&#123;<br>    <span class="hljs-function">QApplication <span class="hljs-title">app</span><span class="hljs-params">(argc, argv)</span></span>;<br>    <br>    QSplashScreen* splash = <span class="hljs-keyword">new</span> QSplashScreen;<br>    splash-&gt;<span class="hljs-built_in">setPixmap</span>(<span class="hljs-built_in">QPixmap</span>(<span class="hljs-string">&quot;:/images/splash.png&quot;</span>));    <span class="hljs-comment">// è®¾ç½®å¯åŠ¨ç•Œé¢èƒŒæ™¯å›¾</span><br>    splash-&gt;<span class="hljs-built_in">show</span>();        <span class="hljs-comment">// ä¸ç®¡ä¸»ç¨‹åºæœ‰æ²¡æœ‰å¯åŠ¨ï¼Œå…ˆå¯åŠ¨â€œå¯åŠ¨ç”»é¢â€å†è¯´</span><br>    <br>    Qt::Alignment topRight = Qt::AlignRight | Qt::AlignTop;<br>    <br>    splash-&gt;<span class="hljs-built_in">showMessage</span>(QObject::<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Setting up the main window...&quot;</span>),<br>                        topRight, Qt::black);<br>    MainWindow win;<br><br>    splash-&gt;<span class="hljs-built_in">showMessage</span>(QObject::<span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Testing windows (5s)...&quot;</span>),<br>                        topRight, Qt::black);<br>    QTime timer;<br>    timer.<span class="hljs-built_in">start</span>();<br>    <span class="hljs-keyword">while</span> (timer.<span class="hljs-built_in">elapsed</span>() &lt; <span class="hljs-number">5000</span>)<br>        app.<span class="hljs-built_in">processEvents</span>();<br>    <br>    win.<span class="hljs-built_in">show</span>();<br>    splash-&gt;<span class="hljs-built_in">finish</span>(&amp;win);    <span class="hljs-comment">// å®Œæˆï¼ŒæŠŠä½ç½®è®©ç»™ MainWindow</span><br>    <span class="hljs-keyword">delete</span> splash;<br>    <br>    <span class="hljs-keyword">return</span> app.<span class="hljs-built_in">exec</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="4-3-ç¨‹åºä¸­å¤®çª—å£å®ç°ï¼šQTableWidget"><a href="#4-3-ç¨‹åºä¸­å¤®çª—å£å®ç°ï¼šQTableWidget" class="headerlink" title="4.3 ç¨‹åºä¸­å¤®çª—å£å®ç°ï¼šQTableWidget"></a>4.3 ç¨‹åºä¸­å¤®çª—å£å®ç°ï¼š<code>QTableWidget</code></h2><p>ä¸­å¤®çª—å£éƒ¨ä»¶å¸¸è§çš„è®¾è®¡æ–¹æ³•æœ‰ä¸‹é¢å‡ ç§ï¼š</p>
<ol>
<li>ä½¿ç”¨ä¸€ä¸ª<strong>æ ‡å‡†çš„ Qt çª—å£éƒ¨ä»¶</strong>ï¼ˆæˆ–ç»§æ‰¿äºå…¶çš„æ§ä»¶ï¼‰ä½œä¸º <code>centralWidget</code>ï¼Œä¾‹å¦‚ <code>QTableWidget</code>ã€<code>QTextEdit</code> ç­‰ï¼Œæœ¬å·¥ç¨‹å°±æ˜¯ç”¨è¿™ç§æ–¹æ³•ï¼›</li>
<li>ä½¿ç”¨ä¸€ä¸ª<strong>è‡ªå®šä¹‰çª—å£éƒ¨ä»¶</strong> ä½œä¸º <code>centralWidget</code>ï¼Œä»¥åä¼šä»‹ç»æ€ä¹ˆè‡ªå®šä¹‰çª—å£éƒ¨ä»¶ï¼ˆç»§æ‰¿å¾—åˆ°çš„ä¸å«è‡ªå®šä¹‰éƒ¨ä»¶ï¼‰ï¼›</li>
<li>ä½¿ç”¨ä¸€ä¸ª<strong>å¸¦å¸ƒå±€ç®¡ç†å™¨çš„æ™®é€š <code>QWidget</code></strong> ä½œä¸º <code>centralWidget</code>ï¼Œè¿™ä¹Ÿæ˜¯åˆå­¦è€…æœ€å–œæ¬¢ç”¨çš„æ–¹æ³•ï¼›</li>
<li>ä½¿ç”¨<strong>åˆ‡åˆ†çª—å£ï¼ˆ<code>QSplitter</code>ï¼‰</strong>ï¼Œåˆ©ç”¨åˆ‡åˆ†æ¡ï¼ˆ<code>splitter handle</code>ï¼‰æ§åˆ¶å®ƒä»¬çš„å°ºå¯¸ï¼›</li>
<li>ä½¿ç”¨<strong><code>MDI</code></strong>ã€‚ä¸Šä¸€èŠ‚è¯´äº†ï¼Œä»¥åå†è®¨è®ºã€‚</li>
</ol>
<p>æœ¬é¡¹ç›®ä½¿ç”¨çš„æ˜¯æ ‡å‡† Qt çª—å£éƒ¨ä»¶ <code>QTableWidget</code>ï¼Œå¹¶é‡‡ç”¨ç»§æ‰¿çš„æ–¹æ³•æ¥ç»™ <code>HolySheet</code> ç±»æ·»åŠ ä¸€äº›å¿…è¦çš„åŠŸèƒ½ã€‚å…ˆææ¸… <code>QTableWidget</code> çš„ç»§æ‰¿å…³ç³»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">QObject -&gt; QWidget -&gt; QTableView -&gt; QTableWidget -&gt; HolySheet(è‡ªå®šä¹‰)<br><br>// è¿™æ˜¯ä¸ªçº¯ç²¹çš„æ•°æ®ç±»ï¼Œå°±æ˜¯å­˜æ”¾æ•°æ®ã€ä¸º QTableWidget ç±»æœåŠ¡<br>QTableWidgetItem -&gt; Cell(è‡ªå®šä¹‰)<br></code></pre></td></tr></table></figure>
<p>å†äº†è§£ä¸€ä¸‹ <code>QTableWidget</code> ç±»å¯¹è±¡çš„ç»„æˆï¼š</p>
<p><img src="QTableWidget.png"></p>
<h3 id="4-3-1-è¡¨æ ¼çš„å®šä¹‰"><a href="#4-3-1-è¡¨æ ¼çš„å®šä¹‰" class="headerlink" title="4.3.1 è¡¨æ ¼çš„å®šä¹‰"></a>4.3.1 è¡¨æ ¼çš„å®šä¹‰</h3><p>æœ€åå¼€å§‹è®¾è®¡ <code>HolySheet</code>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: HolySheet.h</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QtWidgets/QTableWidget&gt;</span></span><br><br><span class="hljs-comment">// ä¹‹åä¼šè¯´ Cell ç±»çš„å®šä¹‰å’Œå®ç°</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Cell.h&quot;</span></span><br><br><span class="hljs-comment">// å®šä¹‰ä¸€äº›å¸¸é‡</span><br><span class="hljs-keyword">namespace</span> holysheet &#123;<br>    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> MagicNumber = <span class="hljs-number">0x7F51C883</span>;<br>    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> RowCount = <span class="hljs-number">999</span>;<br>    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> ColumnCount = <span class="hljs-number">26</span>;<br>&#125;;<br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> holysheet;<br><br><span class="hljs-comment">// è¿™ä¸ªç±»æ˜¯è‡ªå·±å†™çš„ï¼Œå…ˆå£°æ˜ä»¥ä¾› HolySheet ç±»ä½¿ç”¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HolySheetCompare</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HolySheet</span> : <span class="hljs-keyword">public</span> QTableWidget &#123;<br>    Q_OBJECT<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">HolySheet</span>(QWidget* parent = <span class="hljs-literal">nullptr</span>);<br>    <span class="hljs-comment">// è¿™äº›å‡½æ•°å‡ ä¹å…¨æ˜¯ä¹‹å‰åœ¨ MainWindow ç±»é‡Œé¢è¦ç”¨çš„ï¼Œå¯ä»¥å›å¿†ä¸€ä¸‹å®ƒä»¬è¢«ç”¨åœ¨å“ªé‡Œ</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">isAutoRecalc</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> autoRecalc; &#125;<br>    <span class="hljs-function">QString <span class="hljs-title">currentLocation</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function">QString <span class="hljs-title">currentFormula</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function">QTableWidgetSelectionRange <span class="hljs-title">selectedRange</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-comment">// ä¹‹æ‰€ä»¥å†™ clear çš„åŸå› æ˜¯ï¼Œä¸æƒ³â€œå…¨éƒ¨æ¸…é™¤â€</span><br>    <span class="hljs-comment">// æƒ³è¦ç•™ä¸‹è¡¨å¤´æç¤ºä¿¡æ¯ç­‰ï¼Œæ‰€ä»¥éœ€è¦è‡ªå®šä¹‰</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">readFile</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; fileName)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">writeFile</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; fileName)</span></span>;<br>    <span class="hljs-comment">// åé¢å®ç°çš„æ—¶å€™å†è¯´ HolySheetCompare çš„å®šä¹‰å’Œå®ç°</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sort</span><span class="hljs-params">(<span class="hljs-type">const</span> HolySheetCompare&amp; compare)</span></span>;<br><span class="hljs-keyword">public</span> slot:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cut</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">copy</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">paste</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">del</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">selectCurrentRow</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">selectCurrentColumn</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">recalculate</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setAutoRecalculate</span><span class="hljs-params">(<span class="hljs-type">bool</span> recalc)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">findNext</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; text, Qt::CaseSensitivity cs)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">findPrev</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; text, Qt::CaseSensitivity cs)</span></span>;<br>signals:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modified</span><span class="hljs-params">()</span></span>;<br><span class="hljs-keyword">private</span> slots:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">somethingChanged</span><span class="hljs-params">()</span></span>;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">bool</span> autoRecalc;<br>    <br>    <span class="hljs-function">Cell* <span class="hljs-title">cell</span><span class="hljs-params">(<span class="hljs-type">int</span> row, <span class="hljs-type">int</span> col)</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function">QString <span class="hljs-title">text</span><span class="hljs-params">(<span class="hljs-type">int</span> row, <span class="hljs-type">int</span> col)</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function">QString <span class="hljs-title">formula</span><span class="hljs-params">(<span class="hljs-type">int</span> row, <span class="hljs-type">int</span> col)</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setFormula</span><span class="hljs-params">(<span class="hljs-type">int</span> row, <span class="hljs-type">int</span> col, <span class="hljs-type">const</span> QString&amp; formula)</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<h3 id="4-3-2-è¡¨æ ¼çš„-â€œæ–‡æœ¬â€-å’Œ-â€œå…¬å¼â€"><a href="#4-3-2-è¡¨æ ¼çš„-â€œæ–‡æœ¬â€-å’Œ-â€œå…¬å¼â€" class="headerlink" title="4.3.2 è¡¨æ ¼çš„ â€œæ–‡æœ¬â€ å’Œ â€œå…¬å¼â€"></a>4.3.2 è¡¨æ ¼çš„ â€œæ–‡æœ¬â€ å’Œ â€œå…¬å¼â€</h3><p>ä¸‹é¢æ­£å¼å¼€å§‹å®ç°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: HolySheet.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;HolySheet.h&quot;</span></span><br><br>HolySheet::<span class="hljs-built_in">HolySheet</span>(QWidget* parent)<br>    : <span class="hljs-built_in">QTableWidget</span>(parent) &#123;<br>    <br>    autoRecalc = <span class="hljs-literal">true</span>;    <span class="hljs-comment">// é»˜è®¤é€‰ä¸­</span><br>    <span class="hljs-comment">// è‡ªå®šä¹‰è¡¨æ ¼æ¯ä¸ªæ ¼å­çš„å†…å®¹æ¨¡å¼ï¼Œå‚æ•°ç±»å‹éœ€è¦ QTableWidgetItem</span><br>    <span class="hljs-comment">// è¿™é‡Œç”¨çš„æ˜¯ç»§æ‰¿çš„ Cell å®ä¾‹</span><br>    <span class="hljs-built_in">setItemPrototype</span>(<span class="hljs-keyword">new</span> Cell);<br>    <span class="hljs-comment">// è®¾ç½® QTableWidget çš„é€‰æ‹©æ–¹æ³•ï¼Œè¿™é‡Œä»…é™è¿ç»­æ ¼å­çš„é€‰æ‹©</span><br>    <span class="hljs-built_in">setSelectionMode</span>(ContiguousSelection);<br>    <br>    <span class="hljs-comment">// åŸç”Ÿä¿¡å· QTableWidget::itemChanged(QTableWidgetItem*)</span><br>    <span class="hljs-comment">// ä¸ºä½•ä¸ç›´æ¥è¿æ¥ modified ä¿¡å·ï¼Œè€Œéè¦ç»è¿‡ somethingChanged æ§½ï¼Ÿ</span><br>    <span class="hljs-comment">// å› ä¸º somethingChanged æ§½ä¸­éœ€è¦æ£€æŸ¥ autoRecalc å¹¶ä¸”è‡ªåŠ¨æ›´æ–°ï¼(å®ç°ä¼šè¯´)</span><br>    <span class="hljs-built_in">connect</span>(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">SIGNAL</span>(<span class="hljs-built_in">itemChanged</span>(QTableWidgetItem*)),<br>            <span class="hljs-keyword">this</span>, <span class="hljs-built_in">SLOT</span>(<span class="hljs-built_in">somethingChanged</span>()));<br>    <span class="hljs-comment">// ç¬¬ä¸€æ¬¡å¯åŠ¨éœ€è¦æ¸…ç©ºæ ¼å­å†…å®¹</span><br>    <span class="hljs-built_in">clear</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::clear</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// æ¸…é™¤è¡Œåˆ—æ•°ï¼ˆä¸ºäº†åˆ é™¤å†…å®¹ï¼‰å¹¶é‡è®¾è¡Œåˆ—æ€»æ•°</span><br>    <span class="hljs-built_in">setRowCount</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">setColumnCount</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">setRowCount</span>(RowCount);<br>    <span class="hljs-built_in">setColumnCount</span>(ColumnCount);<br>    <br>    <span class="hljs-comment">// è¿™é‡Œæ˜¯ç»™æ¯åˆ—ç¬¬ä¸€è¡ŒåŠ ä¸Šè¡¨å¤´</span><br>    <span class="hljs-comment">// æ— éœ€ä¸ºæ¯è¡Œç¬¬ä¸€åˆ—è€ƒè™‘ï¼Œå®ƒä»¬é»˜è®¤æ•°å­—ç¼–å·</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; ColumnCount; ++i) &#123;<br>        QTableWidgetItem* item = <span class="hljs-keyword">new</span> QTableWidgetItem;<br>        item-&gt;<span class="hljs-built_in">setText</span>(<span class="hljs-built_in">QString</span>(<span class="hljs-built_in">QChar</span>(<span class="hljs-string">&#x27;A&#x27;</span> + i)));<br>        <span class="hljs-comment">// åŸç”Ÿå‡½æ•°ï¼Œè®¾ç½®æŒ‡å®šå†…å®¹çš„ QTableWidgetItem å®ä¾‹ä¸ºæ¯ä¸€åˆ—çš„è¡¨å¤´</span><br>        <span class="hljs-built_in">setHorizontalHeaderItem</span>(i, item);<br>    &#125;<br>    <span class="hljs-comment">// å°†é€‰ä¸­çš„ä½ç½®å›å½’åˆ°åŸç‚¹</span><br>    <span class="hljs-built_in">setCurrentCell</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å£°æ˜ä¸­çš„ <code>cell()</code> å‡½æ•°æ˜¯ä¸ºäº†ç»™å®šè¡Œåˆ—ï¼Œè¿”å›ä¸€ä¸ª <code>Cell</code> æŒ‡é’ˆï¼Œç›®çš„å’Œ <code>QTableWidget::item()</code> å– <code>QTableWidgetItem</code> ä¸€æ ·ã€‚åªä¸è¿‡ä¹‹å‰è®¾ç½®äº†æ¯ä¸ªæ ¼å­ç±»å‹ä¸º <code>Cell</code>ï¼Œæ‰€ä»¥è¿™é‡Œè‡ªå®šä¹‰ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">Cell* <span class="hljs-title">HolySheet::cell</span><span class="hljs-params">(<span class="hljs-type">int</span> row, <span class="hljs-type">int</span> col)</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">static_cast</span>&lt;Cell*&gt;(<span class="hljs-built_in">item</span>(row, col));<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æ›´æ–¹ä¾¿çš„æ˜¯ï¼Œå¯ä»¥ç›´æ¥å–å•å…ƒæ ¼çš„æ•°æ®ä¸ºå­—ç¬¦ä¸²ã€å…¬å¼ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QString <span class="hljs-title">HolySheet::text</span><span class="hljs-params">(<span class="hljs-type">int</span> row, <span class="hljs-type">int</span> col)</span> <span class="hljs-type">const</span> </span>&#123;<br>    Cell* c = <span class="hljs-built_in">cell</span>(row, col);<br>    <span class="hljs-keyword">if</span> (c) <span class="hljs-keyword">return</span> c-&gt;<span class="hljs-built_in">text</span>();<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><br><span class="hljs-function">QString <span class="hljs-title">HolySheet::formula</span><span class="hljs-params">(<span class="hljs-type">int</span> row, <span class="hljs-type">int</span> col)</span> <span class="hljs-type">const</span> </span>&#123;<br>    Cell* c = <span class="hljs-built_in">cell</span>(row, col);<br>    <span class="hljs-keyword">if</span> (c) <span class="hljs-keyword">return</span> c-&gt;formula();    <span class="hljs-comment">// Cell ç±»ç­‰å¾…å®ç°ï¼šCell::formula()</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>âš  æ³¨æ„ï¼š<strong>â€œå…¬å¼â€ å’Œ â€œæ–‡æœ¬â€ æ•°æ®åœ¨æ¯ä¸ª <code>Cell</code> ä¸­å­˜å‚¨åœ¨ä¸åŒåœ°æ–¹ï¼ˆæœºç†å’Œ <code>QTableWidgetItem</code> ç±»æœ‰å…³ï¼Œç”± <code>role</code> å‚æ•°æ§åˆ¶ï¼Œç­‰å®ç° <code>Cell</code> ç±»å†è¯´ã€‚ç›®å‰åªéœ€è¦çŸ¥é“çœ‹æ–‡æœ¬ç”¨ <code>text()</code>ã€çœ‹å…¬å¼ <code>formula()</code>ï¼‰</strong>ï¼Œè€Œå…¬å¼æ•°æ®å¯ä»¥æŒ‰ç…§è®¡ç®—ç»“æœæ¥ä¿®æ”¹æœ¬æ ¼çš„æ–‡æœ¬æ•°æ®ã€‚</p>
<p>è¿™é‡Œéœ€è¦ææ¸…æ¥šï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œå…¬å¼å’Œæ–‡æœ¬æ˜¯ç›¸åŒçš„ï¼Œå®ƒçš„<strong>å¤„ç†è§„åˆ™</strong>å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>å…¬å¼æ˜¯æ™®é€šæ–‡æœ¬æ—¶ï¼Œå’Œæ–‡æœ¬æ•°æ®ä¸€æ ·ï¼Œä¸ä¼šè®¡ç®—ã€‚ä¾‹å¦‚å…¬å¼ â€œHelloâ€ ç­‰ä»·äºæ–‡æœ¬ â€œHelloâ€ï¼›</p>
</li>
<li><p>å…¬å¼æ˜¯æ•°å­—çš„æ—¶å€™ï¼Œå…¬å¼çš„æ•°å­—ä¼šè¢«è®¤ä¸ºåŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆdoubleï¼‰ï¼Œè€Œéæ–‡æœ¬ï¼›</p>
</li>
<li>å…¬å¼ä»¥å•å¼•å·å¼€å§‹ï¼ˆExcel ä¸­æŠŠè¿™ä¸ªå«åšè½¬ä¹‰å†…å®¹ï¼‰ï¼Œé‚£ä¹ˆå‰©ä½™éƒ¨åˆ†ä¼šè¢«è®¤ä¸ºæ˜¯æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼šå…¬å¼ â€œ â€˜12345 â€ å°±æ˜¯æ–‡æœ¬ï¼Œç­‰ä»·äºå­—ç¬¦ä¸² â€œ12345â€ï¼›</li>
<li>å…¬å¼ä»¥ç­‰å·å¼€å§‹ï¼Œé‚£ä¹ˆå…¬å¼ä¼šè¢«è®¤ä¸ºæ˜¯ç®—æ•°å…¬å¼ï¼Œä¾‹å¦‚å…¬å¼ â€œ =A1+A2 â€ ä¼šè®¡ç®— A1 å’Œ A2 å•å…ƒæ ¼çš„æ–‡æœ¬ï¼ˆè½¬åŒ–ä¸ºæ•°å­—ï¼‰ä¹‹å’Œçš„å€¼ï¼Œå¹¶å¡«å…¥ <code>Cell</code> çš„æ–‡æœ¬æ•°æ®ä¸­ï¼›</li>
</ul>
<p>è¿™é‡Œ <strong>ç”±å…¬å¼è®¡ç®—å‡ºå€¼</strong> çš„è¿‡ç¨‹ä¼šç”± <code>Cell</code> ç±»å®Œæˆï¼Œ<code>HolySheet</code> ç±»ä¸ä¼šæ¶‰åŠã€‚</p>
<p>ä¸Šé¢å®ç°çš„æ˜¯å–æ•°æ®çš„å‡½æ•°ï¼Œä¸‹é¢å®ç°è®¾å®šæ•°æ®çš„å‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::setFormula</span><span class="hljs-params">(<span class="hljs-type">int</span> row, <span class="hljs-type">int</span> col, <span class="hljs-type">const</span> QString&amp; formula)</span> </span>&#123;<br>    Cell* c = <span class="hljs-built_in">cell</span>(row, col);<br>    <span class="hljs-keyword">if</span> (!c) &#123;                    <span class="hljs-comment">// å½“å‰æ ¼å­è¿˜æ²¡æœ‰åˆ›å»ºå¯¹åº”çš„ Cell å¯¹è±¡</span><br>        <span class="hljs-comment">// ä¸ç”¨æ‹…å¿ƒé‡Šæ”¾é—®é¢˜ï¼Œè¿™é‡Œ QTableWidget ä¼šè‡ªåŠ¨</span><br>        <span class="hljs-comment">// å–å¾—æ–°çš„ QTableWidgetItem çš„æ‰€æœ‰æƒï¼Œå¹¶ä¸”åœ¨åˆé€‚çš„æ—¶æœºè‡ªåŠ¨ææ„</span><br>        c = <span class="hljs-keyword">new</span> Cell;<br>        <span class="hljs-built_in">setItem</span>(row, col, c);<br>    &#125;<br>    c-&gt;<span class="hljs-built_in">setFormula</span>(formula);        <span class="hljs-comment">// Cell ç±»æ¥è®¾å®šã€è®¡ç®—å…¬å¼</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>ç»†å¿ƒçš„è¯»è€…ä¼šå‘ç°ï¼Œè¿™é‡Œåªæœ‰ <code>setFormula</code>ï¼Œæ²¡æœ‰ <code>setText</code>ï¼Œåˆšåˆšä¸æ˜¯è¯´ä¸¤ä¸ªåˆ†å¼€å­˜å‚¨å—ï¼Ÿå¯¹ï¼Œè¿™é‡Œè¿˜æ˜¯å’Œ <code>QTableWidgetItem</code> ç±»æœ‰å…³ã€‚<strong>æˆ‘ä»¬ä¼šåœ¨ â€œ<code>QTableWidgetItem</code> æœºç†ç®€ä»‹â€ ä¸€èŠ‚è¿›è¡Œè§£é‡Š</strong>ã€‚</p>
<p>å¦å¤–èƒ½çœ‹å‡ºæ¥çš„æ˜¯ï¼Œæˆ‘ä»¬å­˜å‚¨è¡¨å¹¶ä¸æ˜¯ä½¿ç”¨äºŒç»´æ•°ç»„æˆ–å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œè€Œæ˜¯<strong>å­˜å‚¨ä¸ºé¡¹ï¼ˆitemï¼‰</strong>ï¼Œæœ‰åŠ©äºèŠ‚çœç©ºé—´ã€åŠ å¿«è¿è¡Œé€Ÿåº¦ç­‰ã€‚è¿™ç§æ–¹æ³•åœ¨ <code>QListWidget</code> å’Œ <code>QTreeWidget</code> ç±»ä¸­ä¹Ÿèƒ½çœ‹åˆ°ï¼ˆå¯¹åº” <code>QListWidgetItem</code> å’Œ <code>QTreeWidgetItem</code> ç±»ï¼‰ï¼›</p>
<p>æ­¤å¤–ï¼Œå¯¹äºæ›´å¤§æ•°æ®é‡çš„åº”ç”¨åœºæ™¯ï¼ŒQt è¿˜æ”¯æŒæ¨¡å‹/è§†å›¾ç±»ï¼ˆmodel/viewï¼‰ï¼Œä»¥åä»‹ç»ã€‚</p>
<p>å†æ¥å®ç°å…¶ä»–ç”¨åˆ°çš„å‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QString <span class="hljs-title">HolySheet::currentLocation</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-comment">// currentRow() å’Œ currentColumn() è¿˜æ˜¯ QTableWidget çš„åŸç”Ÿå‡½æ•°</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">QString</span>(<span class="hljs-string">&#x27;A&#x27;</span> + <span class="hljs-built_in">currentColumn</span>()<br>                + QString::<span class="hljs-built_in">number</span>(<span class="hljs-built_in">currentRow</span>() + <span class="hljs-number">1</span>));<br>&#125;<br><br><span class="hljs-comment">// åŸæœ¬åœ¨ MainWindow ä¸­çš„ç”¨é€”æ˜¯å±•ç¤ºåœ¨ formulaLabel ä¸­çš„</span><br><span class="hljs-function">QString <span class="hljs-title">HolySheet::currentFormula</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> formula(<span class="hljs-built_in">currentRow</span>(), <span class="hljs-built_in">currentColumn</span>());    <span class="hljs-comment">// ä¸Šé¢çš„å–å…¬å¼å‡½æ•°</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::somethingChanged</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// ä¸ºä»€ä¹ˆä¸ç›´æ¥ emit modified() çš„åŸå› åœ¨è¿™</span><br>    <span class="hljs-keyword">if</span> (autoRecalc) <span class="hljs-built_in">recalculate</span>();<br>    <span class="hljs-function">emit <span class="hljs-title">modified</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="4-3-3-è¡¨æ ¼æ•°æ®çš„å­˜å–"><a href="#4-3-3-è¡¨æ ¼æ•°æ®çš„å­˜å–" class="headerlink" title="4.3.3 è¡¨æ ¼æ•°æ®çš„å­˜å–"></a>4.3.3 è¡¨æ ¼æ•°æ®çš„å­˜å–</h3><p>å†æ¥çœ‹<strong>è¡¨æ•°æ®çš„å­˜å‚¨å’Œè¯»å–</strong>çš„é—®é¢˜ã€‚æˆ‘ä»¬è¦ç”¨ä¸€ç§<strong>è‡ªå®šä¹‰çš„äºŒè¿›åˆ¶æ ¼å¼</strong>æ¥å®ç° <code>HolySheet</code> æ–‡ä»¶çš„è¯»å–å’Œå­˜å‚¨ã€‚è¿™æ—¶å°±ç”¨åˆ°äº† <strong><code>QFile</code> ç±»å’Œ <code>QDataStream</code> ç±»</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">HolySheet::writeFile</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; fileName)</span> </span>&#123;<br>    <span class="hljs-function">QFile <span class="hljs-title">file</span><span class="hljs-params">(fileName)</span></span>;<br>    <span class="hljs-comment">// å¦‚æœåªå†™çš„æ‰“å¼€æ–¹å¼å¤±è´¥ï¼Œè¯´æ˜æ–‡ä»¶ä¸å­˜åœ¨æˆ–æœ‰æƒé™é—®é¢˜ç­‰</span><br>    <span class="hljs-keyword">if</span> (!file.<span class="hljs-built_in">open</span>(QIODevice::WriteOnly)) &#123;<br>        QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;HolySheet&quot;</span>),<br>                            <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Cannot write file %1:\n%2.&quot;</span>)<br>                            .<span class="hljs-built_in">arg</span>(file.<span class="hljs-built_in">fileName</span>())<br>                            .<span class="hljs-built_in">arg</span>(file.<span class="hljs-built_in">errorString</span>()));<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-function">QDataStream <span class="hljs-title">out</span><span class="hljs-params">(&amp;file)</span></span>;<br>    <span class="hljs-comment">// è¿™ä¸ªç‰ˆæœ¬çœ‹ä½ çš„ Qt ç‰ˆæœ¬ã€‚ä¾‹å¦‚ 5.12 ç‰ˆæœ¬å°±ç”¨ QDataStream::Qt_5_12</span><br>    out.<span class="hljs-built_in">setVersion</span>(QDataStream::Qt_5_14);<br>    out &lt;&lt; <span class="hljs-built_in">quint32</span>(MagicNumber);        <span class="hljs-comment">// æ··æ·†ä½œç”¨ï¼Œä½ å¯ä»¥éšä¾¿æ”¹ MagicNumber</span><br>    <br>    <span class="hljs-comment">// æ›´æ”¹é¼ æ ‡æŒ‡é’ˆæ ·å¼ä¸º â€œç­‰å¾…â€</span><br>    QApplication::<span class="hljs-built_in">setOverrideCursor</span>(Qt::WaitCursor);<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> row = <span class="hljs-number">0</span>; row &lt; RowCount; ++row) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> col = <span class="hljs-number">0</span>; col &lt; ColumnCount; ++col) &#123;<br>            QString str = formula(row, col);<br>            <span class="hljs-keyword">if</span> (!str.<span class="hljs-built_in">isEmpty</span>())<br>                out &lt;&lt; <span class="hljs-built_in">quint16</span>(row) &lt;&lt; <span class="hljs-built_in">quint16</span>(col) &lt;&lt; str;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// è¿˜åŸé¼ æ ‡æŒ‡é’ˆæ ·å¼</span><br>    QApplication::<span class="hljs-built_in">restoreOverrideCursor</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œ<code>QDataStream</code> æ¨¡ä»¿äº†æ ‡å‡† C++ çš„æµï¼ˆ<code>stream</code>ï¼‰ç±»ï¼Œéƒ½ä½¿ç”¨ <code>&gt;&gt;/&lt;&lt;</code> è¿ç®—ç¬¦æ¥è¾“å…¥è¾“å‡ºæµï¼Œä¾‹å¦‚ï¼š<code>in &gt;&gt; x &gt;&gt; y;</code> å’Œ <code>out &lt;&lt; x &lt;&lt; y;</code>ã€‚</p>
<p>è¿™é‡Œè¿˜è€ƒè™‘åˆ° C++ çš„åŸºæœ¬ç±»å‹<strong>åœ¨ä¸åŒå¹³å°ä¸‹çš„ç©ºé—´å¤§å°ä¸åŒ</strong>ï¼Œæ‰€ä»¥å°†å®ƒä»¬å¼ºåˆ¶è½¬æ¢ä¸º <code>qint8/quint8/...(16ã€32)/qint64/quint64</code>ï¼Œå…¶ä¸­ <code>quint64</code> æœ€å®‰å…¨ï¼Œä½†å ç”¨ç©ºé—´ä¹Ÿæ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ç»“åˆå®é™…æ•°æ®èŒƒå›´ï¼Œä¸Šé¢çš„ä»£ç ä»¥ <code>quint16</code> ä¸ºä¾‹ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>HolySheet</code> ç¨‹åºçš„æ–‡ä»¶ï¼ˆ<code>*.hs</code>ï¼‰å­˜å‚¨æ ¼å¼ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">MagicNumber(æ··æ·†ç ï¼Œ32 bits, 4 Bytes) | row(16 bits) | column(16 bits) | string (32 bits) | row | column | string | ...<br></code></pre></td></tr></table></figure>
<p>è€Œå…·ä½“å­˜å‚¨æ–¹å¼ç”± <code>QDataStream</code> å†…éƒ¨å†³å®šã€‚ä¾‹å¦‚ï¼Œ<code>quint16</code> ä¼šè¢« <code>QDataStream</code> æŒ‰<strong>å°ç«¯åº</strong>å­˜æˆ 2 Bytesï¼Œ<code>QString</code> ä¼šè¢«å­˜æˆ <code>å­—ç¬¦ä¸²é•¿åº¦ + Unicodeå­—ç¬¦</code> å½¢å¼ï¼›</p>
<p><strong>è€Œä¸”ä¸åŒç‰ˆæœ¬çš„ Qt ï¼Œå­˜å‚¨æ–¹å¼ä¸åŒ</strong>ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸Šé¢è¦æŒ‡å®š <code>QDataStream</code> çš„ç‰ˆæœ¬ï¼ˆ<code>setVersion</code>ï¼‰ï¼›</p>
<p><code>QDataStream</code> é™¤äº†ä½¿ç”¨åœ¨ <code>QFile</code> ä¸Šï¼Œè¿˜èƒ½ç”¨åœ¨ <code>QBuffer</code>ã€<code>QProcess</code>ã€<code>QTcpSocket</code>ã€<code>QUdpSocket</code>ã€<code>QSslSocket</code> ç­‰ç±»ä¸­ã€‚</p>
<p>å¦‚æœä»…ä»…æ˜¯è¯»å–æ–‡æœ¬ï¼Œè¿˜å¯ä»¥ç”¨ <code>QTextStream</code> æ¥ä»£æ›¿ <code>QDataStream</code>ã€‚ä»¥åä¼šæ·±å…¥ä»‹ç»ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">HolySheet::readFile</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; fileName)</span> </span>&#123;<br>    <span class="hljs-function">QFile <span class="hljs-title">file</span><span class="hljs-params">(fileName)</span></span>;<br>    <span class="hljs-keyword">if</span> (!file.<span class="hljs-built_in">open</span>(QIODevice::ReadOnly)) &#123;<br>        QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;HolySheet&quot;</span>),<br>                            <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;Cannot read file %1:\n%2.&quot;</span>)<br>                            .<span class="hljs-built_in">arg</span>(file.<span class="hljs-built_in">fileName</span>())<br>                            .<span class="hljs-built_in">arg</span>(file.<span class="hljs-built_in">errorString</span>()));<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-function">QDataStream <span class="hljs-title">in</span><span class="hljs-params">(&amp;file)</span></span>;<br>    in.<span class="hljs-built_in">setVersion</span>(QDataStream::Qt_5_14);<br>    <br>    quint32 magic;<br>    in &gt;&gt; magic;<br>    <span class="hljs-keyword">if</span> (magic != MagicNumber) &#123;<br>        QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;HolySheet&quot;</span>),<br>                            <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;The file is broken / not a HolySheet file.&quot;</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-built_in">clear</span>();    <span class="hljs-comment">// è¯»å–æ–‡ä»¶ä¹‹å‰å·²ç»ç¡®è®¤è¿‡ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ¸…ç©ºè¡¨æ ¼</span><br>    <br>    quint16 row, column;<br>    QString str;<br>    <br>    QApplication::<span class="hljs-built_in">setOverrideCursor</span>(Qt::WaitCursor);<br>    <span class="hljs-keyword">while</span> (!in.<span class="hljs-built_in">atEnd</span>()) &#123;<br>        in &gt;&gt; row &gt;&gt; column &gt;&gt; str;<br>        <span class="hljs-built_in">setFormula</span>(row, column, str);<br>    &#125;<br>    QApplication::<span class="hljs-built_in">restoreOverrideCursor</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="4-3-4-è¡¨æ ¼ç¼–è¾‘åŠŸèƒ½"><a href="#4-3-4-è¡¨æ ¼ç¼–è¾‘åŠŸèƒ½" class="headerlink" title="4.3.4 è¡¨æ ¼ç¼–è¾‘åŠŸèƒ½"></a>4.3.4 è¡¨æ ¼ç¼–è¾‘åŠŸèƒ½</h3><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œ<code>HolySheet</code> é™¤ â€œå…¬å¼å¤„ç†åŠŸèƒ½â€ ä»¥å¤–çš„å…¶ä»–åŠŸèƒ½å·²ç»åŸºæœ¬å…·å¤‡ï¼ˆå‡†ç¡®åœ°è¯´æ˜¯æ¥å£åšå¥½äº†ï¼Œå¯ä»¥å½“ä½œ <code>Cell</code> ç±»å·²ç»å®ç°ï¼‰ï¼Œç°åœ¨æŠŠ <code>Edit</code> èœå•ä¸­å¯¹åº”çš„è¯¸å¦‚ <strong>å¤åˆ¶ã€ç²˜è´´ã€å‰ªåˆ‡ã€åˆ é™¤</strong> ç­‰åŠŸèƒ½è¡¥å……å®Œå…¨ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: HolySheet.cpp ------------------------------------</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::cut</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">copy</span>();<br>    <span class="hljs-built_in">del</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::copy</span><span class="hljs-params">()</span> </span>&#123;<br>    QTableWidgetSelectionRange range = <span class="hljs-built_in">selectedRange</span>();<br>    QString str;<br>    <br>    <span class="hljs-comment">// QTableWidgetSelectionRange::rowCount å’Œ columnCount æ˜¯åŸç”Ÿæ–¹æ³•</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; range.<span class="hljs-built_in">rowCount</span>(); ++i) &#123;<br>        <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) str += <span class="hljs-string">&quot;\n&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; range.<span class="hljs-built_in">columnCount</span>(); ++j) &#123;<br>            <span class="hljs-keyword">if</span> (j &gt; <span class="hljs-number">0</span>) str += <span class="hljs-string">&quot;\t&quot;</span>;<br>            <span class="hljs-comment">// QTableWidgetSelectionRange::topRow å’Œ bottomRow ä¹Ÿæ˜¯åŸç”Ÿæ–¹æ³•</span><br>            str += formula(range.<span class="hljs-built_in">topRow</span>() + i, range.<span class="hljs-built_in">leftColumn</span>() + j);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// è®¾ç½®ç³»ç»Ÿå‰ªåˆ‡æ¿çš„é™æ€æ–¹æ³•</span><br>    QApplication::<span class="hljs-built_in">clipboard</span>()-&gt;<span class="hljs-built_in">setText</span>(str);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„å¤åˆ¶æ–¹æ³•çš„ç»“æœè®¤ä¸ºï¼Œ<strong>æ¯åˆ—æ¯æ ¼é—´éš”ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼ˆ<code>\t</code>ï¼‰ï¼Œæ¯è¡Œé—´æ ¼ä¸€ä¸ªæ¢è¡Œç¬¦ï¼ˆ<code>\n</code>ï¼‰â€”â€”è¿™æ˜¯å‡ ä¹å…¨çƒé€šç”¨çš„æ ¼å¼</strong>ï¼Œ<code>Microsoft Excel</code> ä¹Ÿè¿™ä¹ˆç”¨ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç²˜è´´åˆ°å…¶ä»–å¤šæ•°è½¯ä»¶ä¸Šã€‚</p>
<p>å¯¹äº<strong>ç²˜è´´ã€åˆ é™¤</strong>ï¼ˆå‰ªåˆ‡åŒ…å«åœ¨å…¶ä¸­ï¼‰çš„æ“ä½œï¼Œä¼šå¯¼è‡´<strong>modified</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// è¿™é‡Œè€ƒéªŒä¿¡æ¯æå–çš„ç®€å•æ–¹æ³•çš„è®¾è®¡</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::paste</span><span class="hljs-params">()</span> </span>&#123;<br>    QTableWidgetSelectionRange range = <span class="hljs-built_in">selectedRange</span>();<br>    QString str = QApplication::<span class="hljs-built_in">clipboard</span>()-&gt;<span class="hljs-built_in">text</span>();<br>    <span class="hljs-comment">// ä¸‹é¢è§£æå‰ªåˆ‡æ¿ä¸­çš„å†…å®¹</span><br>    QStringList rows = str.<span class="hljs-built_in">split</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);        <span class="hljs-comment">// å’Œ Python å¾ˆåƒ</span><br>    <span class="hljs-type">int</span> numRows = rows.<span class="hljs-built_in">count</span>();<br>    <span class="hljs-type">int</span> numColumns = rows.<span class="hljs-built_in">first</span>().<span class="hljs-built_in">count</span>(<span class="hljs-string">&#x27;\t&#x27;</span>) + <span class="hljs-number">1</span>;<br>    <span class="hljs-comment">// åŒºåŸŸåˆæ³•æ€§æ£€éªŒ</span><br>    <span class="hljs-keyword">if</span> (range.<span class="hljs-built_in">rowCount</span>() * range.<span class="hljs-built_in">columnCount</span>() != <span class="hljs-number">1</span><br>       &amp;&amp; (range.<span class="hljs-built_in">rowCount</span>() != numRows || range.<span class="hljs-built_in">columnCount</span>() != numColumn)) &#123;<br>        QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;HolySheet&quot;</span>),<br>                            <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;The contents in the clipboard cannot be&quot;</span><br>                              <span class="hljs-string">&quot; pasted because the contents and the &quot;</span><br>                              <span class="hljs-string">&quot;selected area aren&#x27;t the same size.&quot;</span>));<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; numRows; ++i) &#123;<br>        QStringList columns = rows[i].<span class="hljs-built_in">split</span>(<span class="hljs-string">&#x27;\t&#x27;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; numColumns; ++j) &#123;<br>            <span class="hljs-type">int</span> row = range.<span class="hljs-built_in">topRow</span>() + i;<br>            <span class="hljs-type">int</span> column = range.<span class="hljs-built_in">leftColumn</span>() + j;<br>            <span class="hljs-keyword">if</span> (row &lt; RowCount &amp;&amp; column &lt; ColumnCount)<br>                <span class="hljs-built_in">setFormula</span>(row, column, columns[j]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">somethingChanged</span>();        <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘æ§½ï¼Œå…¶ä¸­ emit modified() ä¿¡å·</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::del</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// QTableWidget::selectedItems åŸç”Ÿå‡½æ•°</span><br>    QList&lt;QTableWidgetItem*&gt; items = <span class="hljs-built_in">selectedItems</span>();<br>    <span class="hljs-keyword">if</span> (!items.<span class="hljs-built_in">isEmpty</span>()) &#123;<br>        <span class="hljs-comment">// Qt è‡ªå¸¦çš„ foreachï¼Œæ¨¡ä»¿ Java</span><br>        foreach (QTableWidgetItem* item, items)<br>            <span class="hljs-keyword">delete</span> item;<br>        <span class="hljs-built_in">somethingChanged</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸Šé¢ç”¨äº†é‚£ä¹ˆå¤šæ¬¡è‡ªå®šä¹‰çš„ <code>selectedRange()</code> å‡½æ•°ï¼Œç°åœ¨çœ‹çœ‹å¦‚ä½•å®ç°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QTableWidgetSelectRange <span class="hljs-title">HolySheet::selectedRange</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-comment">// QTableWidget::selectedRanges() åŸç”Ÿå‡½æ•°</span><br>    <span class="hljs-comment">// è¿”å›æ”¾ç½®æ‰€æœ‰é€‰ä¸­çš„ã€è¿ç»­åŒºåŸŸå¯¹åº”çš„ QTableWidgetSelectionRange</span><br>    QList&lt;QTableWidgetSelectionRange&gt; ranges = <span class="hljs-built_in">selectedRanges</span>();<br>    <span class="hljs-keyword">if</span> (ranges.<span class="hljs-built_in">isEmpty</span>())<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">QTableWidgetSelectRange</span>();<br>    <span class="hljs-comment">// è¿˜è®°å¾—å—ï¼Ÿä¹‹å‰è®¾ç½® setSelectionMode(ContiguousSelection)</span><br>    <span class="hljs-comment">// åªä¼šé€‰æ‹©è¿ç»­åŒºåŸŸçš„å•å…ƒæ ¼ï¼Œæ‰€ä»¥ ranges çš„ size åªä¼šæ˜¯ 0 æˆ– 1</span><br>    <span class="hljs-keyword">return</span> range.<span class="hljs-built_in">first</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å†æ¥çœ‹ <code>MainWindow</code> çš„èœå•æ ä¸­ <code>select</code> å­èœå•ä¸­ï¼Œæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼ˆå¦å¤–ä¸€ä¸ª <code>selectAll</code> å‡½æ•°å°±æ˜¯ <code>QTableWidget</code> çš„åŸç”Ÿå‡½æ•°ï¼Œä¸ç”¨å†™ï¼Œç›´æ¥ <code>connect</code> å°±è¡Œï¼‰ï¼Œä¸€ä¸ªæ˜¯ <code>select column</code>ï¼Œå¦ä¸€ä¸ªæ˜¯ <code>select row</code>ï¼Œå®ƒä»¬å°±æ˜¯é€‰å®šå½“å‰é€‰ä¸­å•å…ƒæ ¼æ‰€åœ¨çš„åˆ— / è¡Œï¼Œåªéœ€è¦äº¤ç»™åŸç”Ÿçš„ <code>QTableWidget::selectColumn/selectRow(int)</code> å°±è¡Œï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::selectCurrentRow</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">selectRow</span>(<span class="hljs-built_in">currentRow</span>());<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::selectCurrentColumn</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">selectColumn</span>(<span class="hljs-built_in">currentColumn</span>());<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å†å®ç°å¿ƒå¿ƒå¿µå¿µçš„ <code>findNext</code>ã€<code>findPrev</code>ï¼ˆæ—©åœ¨ <code>findDialog</code> çš„ç¼–å†™ä¸Šå°±çœ‹åˆ°äº†ï¼‰ï¼š</p>
<blockquote>
<p>æ³¨æ„ï¼šæ— è®ºæ˜¯å‘å‰æ‰¾ï¼Œè¿˜æ˜¯å‘åæ‰¾ï¼Œéƒ½æ˜¯ä»å½“å‰é€‰ä¸­ä½ç½®å¼€å§‹çš„ï¼Œè¿™æ˜¯å…±è¯†</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::findNext</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; str, Qt::CaseSensitivity cs)</span> </span>&#123;<br>    <span class="hljs-comment">// å› ä¸ºè¦æ‰¾ä¸‹ä¸€ä¸ªï¼Œæ‰€ä»¥ä»åŒä¸€è¡Œã€ä¸‹ä¸€åˆ—å¼€å§‹</span><br>    <span class="hljs-comment">// æ€è€ƒï¼šä¸ºä»€ä¹ˆè¿™é‡Œä¸ç”¨è€ƒè™‘å‡ºç•Œï¼Ÿâ€”â€”æœ‰ while å¾ªç¯æ¡ä»¶ä¿è¯</span><br>    <span class="hljs-type">int</span> row = <span class="hljs-built_in">currentRow</span>(), column = <span class="hljs-built_in">currentColumn</span>() + <span class="hljs-number">1</span>;<br>    <br>    <span class="hljs-keyword">while</span> (row &lt; RowCount) &#123;<br>        <span class="hljs-keyword">while</span> (column &lt; ColumnCount) &#123;<br>            <span class="hljs-comment">// QString::contains(QString, Qt::CaseSensitivity) åŸç”Ÿå‡½æ•°</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">text</span>(row, column).<span class="hljs-built_in">contains</span>(str, cs)) &#123;<br>                <span class="hljs-built_in">clearSelection</span>();    <span class="hljs-comment">// æ¸…é™¤å½“å‰é€‰æ‹©</span><br>                <span class="hljs-built_in">setCurrentCell</span>(row, column);    <span class="hljs-comment">// é€‰æ‹©åˆ°ä¸‹ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„æ ¼å­</span><br>                <span class="hljs-built_in">activateWindow</span>();    <span class="hljs-comment">// ç„¦ç‚¹è½å›è¡¨æ ¼</span><br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            ++column;<br>        &#125;<br>        column = <span class="hljs-number">0</span>; ++row;<br>    &#125;<br>    <span class="hljs-comment">// ä½¿ç³»ç»Ÿé¸£å«ä¸€ä¸‹ï¼Œè¡¨ç¤ºæ²¡æ‰¾åˆ°</span><br>    QApplication::<span class="hljs-built_in">beep</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::findPrev</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; str, Qt::CaseSensitivity cs)</span> </span>&#123;<br>    <span class="hljs-comment">// å› ä¸ºè¦æŸ¥æ‰¾ä¸Šä¸€ä¸ªï¼Œæ‰€ä»¥ä»åŒä¸€è¡Œã€ä¸Šä¸€åˆ—å¼€å§‹</span><br>    <span class="hljs-type">int</span> row = <span class="hljs-built_in">currentRow</span>(), column = <span class="hljs-built_in">currentColumn</span>() - <span class="hljs-number">1</span>;<br>    <br>    <span class="hljs-keyword">while</span> (row &gt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">while</span> (column &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">text</span>(row, column).<span class="hljs-built_in">contains</span>(str, cs)) &#123;<br>                <span class="hljs-built_in">clearSelection</span>();<br>                <span class="hljs-built_in">setCurrentCell</span>(row, column);<br>                <span class="hljs-built_in">activateWindow</span>();<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            --column;<br>        &#125;<br>        column = ColumnCount - <span class="hljs-number">1</span>;<br>        --row;<br>    &#125;<br>    QApplication::<span class="hljs-built_in">beep</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å†æ¥å®ç°æ”¯æŒ <code>MainWindow</code> çš„ <code>Tools</code> å’Œ <code>Options</code> èœå•çš„åŠŸèƒ½ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// æ­¤å‡½æ•°æ˜¯å°†æ‰€æœ‰å•å…ƒæ ¼å…¨éƒ¨éå†ä¸€éï¼Œå¹¶æ ‡è®°å­˜åœ¨æ•°æ®çš„ cell å®ä¾‹ï¼Œ</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::recalculate</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> row = <span class="hljs-number">0</span>; row &lt; RowCount; ++row) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> column = <span class="hljs-number">0</span>; column &lt; ColumnCount; ++column) &#123;<br>            <span class="hljs-comment">// Cell::setDirty() ç­‰å¾…å®ç°</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">cell</span>(row, column)) <span class="hljs-built_in">cell</span>(row, column)-&gt;<span class="hljs-built_in">setDirty</span>();<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// ä¸Šé¢å¯¹äºæ‰€æœ‰æœ‰æ•°æ®çš„æ ¼å­éƒ½è°ƒç”¨äº† setDirty()ï¼Œ</span><br>    <span class="hljs-comment">// æ¥ä¸‹æ¥è°ƒç”¨åŸç”Ÿå‡½æ•° QTableWidget::viewpoint() è·å¾—å…¨å±€è§†å£</span><br>    <span class="hljs-comment">// å¯¹è§†å£ï¼ˆç±»å‹ï¼‰æ›´æ–°é‡æ–°ç»˜åˆ¶ update()ï¼Œè°ƒç”¨æ¯ä¸€ä¸ª â€œdirtyâ€ çš„æ ¼å­é‡æ–°è®¡ç®— text</span><br>    <span class="hljs-built_in">viewport</span>()-&gt;<span class="hljs-built_in">update</span>();<br>&#125;<br><br><span class="hljs-comment">// è®¾ç½®è‡ªåŠ¨é‡è®¡ç®—</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheet::setAutoRecalculate</span><span class="hljs-params">(<span class="hljs-type">bool</span> recalc)</span> </span>&#123;<br>    autoRecalc = recalc;<br>    <span class="hljs-keyword">if</span> (autoRecalc) <span class="hljs-built_in">recalculate</span>();    <span class="hljs-comment">// è®¾ç½®åç«‹å³å…ˆç”Ÿæ•ˆä¸€æ¬¡</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="4-3-5-è¡¨æ ¼çš„æ’åºåŠŸèƒ½"><a href="#4-3-5-è¡¨æ ¼çš„æ’åºåŠŸèƒ½" class="headerlink" title="4.3.5 è¡¨æ ¼çš„æ’åºåŠŸèƒ½"></a>4.3.5 è¡¨æ ¼çš„æ’åºåŠŸèƒ½</h3><p>æ¥ä¸‹æ¥è§£é‡Š <code>HolySheetCompare</code> ç±» å’Œ <code>HolySheet::sort()</code> æ’åºçš„å®ç°åŸç†ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦æƒ³èµ· <code>sort</code> æ“ä½œçš„ç”¨æˆ·ä½¿ç”¨æ–¹æ³•å°±æ˜¯ï¼š<strong>å…ˆé€‰ä¸­ä¸€ä¸ªåŒºåŸŸï¼Œç„¶ååœ¨å¼¹å‡ºçš„ <code>sortDialog</code> å¯¹è¯æ¡†ä¸­é€‰æ‹©ç¬¬ä¸€ã€äºŒã€ä¸‰é”®ï¼ˆæ¯”è¾ƒçš„åˆ—æ•°ï¼‰å’Œå‡é™åºçš„è¦æ±‚ï¼Œæœ€ç»ˆç¨‹åºæŒ‰æ•°æ®å’Œè¦æ±‚æ’åº</strong>ï¼›</p>
<p><strong>æˆ‘ä»¬ç®€å•è®¾è®¡ç»™è¡¨æ ¼æ’åºçš„ç®—æ³•</strong>ï¼š</p>
<ol>
<li><p>å°†é€‰ä¸­çš„åŒºåŸŸåˆ†å‰²æˆ <strong>è¡Œåˆ—è¡¨</strong>ï¼ˆæ¯ä¸€è¡Œåœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œä¸åŒåˆ—çš„ä½œä¸ºåˆ—è¡¨çš„ä¸åŒå…ƒç´ ï¼‰ï¼Œå¯¹è¿™äº›è¡Œåˆ—è¡¨è¿›è¡Œç¼–å·ï¼›</p>
</li>
<li><p>ä½¿ç”¨ Qt è‡ªå¸¦çš„ <code>qStableSort</code> ç®—æ³•ï¼ˆçœ‹åˆ°åå­—å°±çŸ¥é“æ˜¯ç¨³å®šçš„æ’åºç®—æ³•ï¼‰ï¼Œå®ƒçš„å‚æ•°ä¸ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">elemT</span>&gt;<br><span class="hljs-built_in">qStableSort</span>(<br>    QList&lt;elemT&gt;::iterator iter_start,<br>    QList&lt;elemT&gt;::iterator iter_end,<br>    <span class="hljs-built_in">bool</span> (comp)(elemT obj1, elemT obj2)    <span class="hljs-comment">// è¿™ä¸æ˜¯æ­£è§„å†™æ³•ï¼Œæºä»£ç æ˜¯typename</span><br>)<br></code></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>comp</code> å‡½æ•°æŒ‡é’ˆ<strong>ä¸€å®šè¦å¯¹ä¼ å…¥çš„æ‰€æœ‰å¯èƒ½çš„ <code>elemT</code> ç±»æ•°æ®éƒ½èƒ½æ¯”è¾ƒ</strong>ï¼Œè¦æ±‚ï¼š<strong>å¦‚æœç¬¬ä¸€å‚æ•°å°äºç¬¬äºŒå‚æ•°ï¼Œåˆ™è¿”å› <code>true</code>ï¼Œåä¹‹æ— è®ºå¦‚ä½•è¿”å› <code>false</code>ï¼Œé‚£ä¹ˆæœ€åæ˜¯å‡åºæ’åº</strong>ï¼›</p>
<blockquote>
<p>å¦‚æœæƒ³é™åºï¼Œåªè¦è®© <code>comp</code> æŒ‡å‘çš„å‡½æ•°åœ¨å¤§äºå…³ç³»æ—¶è¿”å› <code>true</code> å°±è¡Œï¼›</p>
</blockquote>
<p>è¿™é‡Œåˆ©ç”¨ä¼ å…¥çš„å°†è¡Œåˆ—è¡¨ä½œä¸ºæ’åºçš„æœ€å°å•å…ƒï¼Œæ‰€ä»¥ä¼ ç»™ <code>qStableSort</code> çš„ç¬¬ä¸€ã€äºŒå‚æ•°éƒ½ä¼šæ˜¯ <code>QList&lt;QStringList&gt;</code> ç±»å‹ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°çš„å‡½æ•°æŒ‡é’ˆ<strong>æ˜¯è®¾è®¡çš„æ ¸å¿ƒ</strong>ï¼Œç±»å‹è¦æ±‚ï¼š<code>bool (comp)(QStringList, QStringList)</code>ï¼Œ<strong>å¹¶ä¸”èƒ½å¤ŸæŒ‰ <code>QStringList</code> ä¸­æŒ‡å®šçš„é”®è¿›è¡Œä¾æ­¤æ’åº</strong>ï¼›</p>
</li>
<li><p>æœ€ååªéœ€æŠŠæ’åºå¥½çš„ <code>QList&lt;QStringList&gt;</code> é‡æ–°å†™å…¥å½“å‰åˆ—è¡¨ï¼Œå¹¶ä¸”æ ‡è®°ä¸º â€œmodifiedâ€ å°±å®Œæˆäº†ã€‚</p>
</li>
</ol>
<p>ä¸ºäº†å®Œæˆä¸Šé¢çš„ç¬¬äºŒæ­¥çš„è¦æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡å‡ºäº† <code>HolySheetCompare</code> ç±»ï¼Œä½¿å…¶<strong>ä¸ä»…èƒ½å¤Ÿä¿å­˜ç”¨æˆ·æ’åºçš„éœ€æ±‚ä¿¡æ¯ï¼Œè¿˜èƒ½å¹¶ä¸”èƒ½å¤ŸæŒ‰ç”¨æˆ·æŒ‡å®šçš„é”®è¿›è¡Œå…ƒç´ å…ˆååˆ¤åˆ«</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: HolySheet.h</span><br><span class="hljs-keyword">namespace</span> hsCompare &#123;<br>    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> KeyCount = <span class="hljs-number">3</span>;<br>&#125;;<br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> hsCompare;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HolySheetCompare</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// è¿™é‡Œé‡è½½æ‹¬å·è¿ç®—ç¬¦ï¼Œä½¿å¾—è¿™ä¸ªç±»èƒ½æœ‰å‡½æ•°ä¸€æ ·çš„è¡Œä¸ºï¼šcompare(A, B) -&gt; bool</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-type">const</span> QStringList&amp; row1, <span class="hljs-type">const</span> QStringList&amp; row2)</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-comment">// ä¿å­˜ç¬¬ n é”®åœ¨ QStringList ä¸­çš„ç´¢å¼•</span><br>    <span class="hljs-type">int</span> keys[KeyCount];<br>    <span class="hljs-comment">// ä¿å­˜ç¬¬ n é”®æ˜¯å¦ä¸ºå‡åº</span><br>    <span class="hljs-type">bool</span> ascending[KeyCount];<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯å®ç°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: HolySheet.cpp</span><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">HolySheetCompare::operator</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-type">const</span> QStringList&amp; row1, <span class="hljs-type">const</span> QStringList&amp; row2)</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-comment">// ä»ç¬¬ä¸€é”®åˆ°ç¬¬ä¸‰é”®ï¼Œå¦‚æœå½“å‰é”®æ¯”è¾ƒçš„æ•°æ®ä¸åŒï¼Œé‚£ä¹ˆå¯ä»¥å¾—å‡ºç»“æœï¼Œç»“æŸå•æ¬¡æ¯”è¾ƒï¼›</span><br>    <span class="hljs-comment">// å¦åˆ™ï¼Œè¿›å…¥ä¸‹ä¸€é”®çš„æ¯”è¾ƒï¼›</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; KeyCount; ++i) &#123;<br>        <span class="hljs-type">int</span> column = keys[i];    <span class="hljs-comment">// å½“å‰æ¯”è¾ƒçš„é”®çš„åˆ—ç´¢å¼•</span><br>        <span class="hljs-comment">// -1 çš„å«ä¹‰æ˜¯ç”¨æˆ·æ²¡æœ‰è¦æ±‚è¿™ä¸ªé”®ï¼ˆå¯¹åº” comboBox ç•Œé¢ä¸­çš„ Noneï¼‰</span><br>        <span class="hljs-comment">// column != -1 è¯´æ˜ç”¨æˆ·é€‰æ‹©äº†è¿™ä¸ªé”®ï¼ˆè¦æ¯”è¾ƒï¼Œå¦åˆ™å°±ä¸æ¯”äº†ï¼‰</span><br>        <span class="hljs-keyword">if</span> (column != <span class="hljs-number">-1</span>) &#123;<br>            <span class="hljs-keyword">if</span>(row1[column] != row2[column]) &#123;    <span class="hljs-comment">// è¯´æ˜è¿™ä¸ªé”®å°±èƒ½å¾—å‡ºç»“æœ</span><br>                <span class="hljs-comment">// qStableSort çš„è¦æ±‚ã€‚è¯¦ç»†è§ä¸Šé¢çš„å‚æ•°åˆ†æ</span><br>                <span class="hljs-keyword">if</span> (ascending[i]) <span class="hljs-keyword">return</span> row1[column] &lt; row2[column];<br>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> row1[column] &gt; row2[column];<br>            &#125;<br>            <span class="hljs-comment">// å¦‚æœæœ¬é”®ç›¸åŒï¼Œè¯´æ˜æ— æ³•æ¯”è¾ƒï¼Œéœ€è¦è¿›è¡Œä¸‹ä¸€ä¸ªé”®çš„æ¯”è¾ƒ</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    <span class="hljs-comment">// æ‰€æœ‰èƒ½æ¯”è¾ƒçš„é”®éƒ½æ¯”å®Œäº†ï¼Œè¿˜æ˜¯ç›¸åŒï¼ˆä¸æ˜¯å°äºï¼‰ï¼Œæ‰€ä»¥è¿”å› false</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½å®Œæ•´å®ç° <code>HolySheet::sort</code> å‡½æ•°äº†ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HolySheeet::sort</span><span class="hljs-params">(<span class="hljs-type">const</span> HolySheetCompare&amp; compare)</span> </span>&#123;<br>    QList&lt;QStringList&gt; rows;    <span class="hljs-comment">// è¡Œåˆ—è¡¨</span><br>    QTableWidgetSelectionRange range = <span class="hljs-built_in">selectedRange</span>();<br>    <span class="hljs-type">int</span> i;    <span class="hljs-comment">// æå‡ºæ¥ï¼Œå› ä¸ºé¢‘ç¹ç”¨åˆ°è®¡æ•°å˜é‡</span><br>    <br>    <span class="hljs-comment">// éå†æ¯ä¸€è¡Œ</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; range.<span class="hljs-built_in">rowCount</span>(); ++i) &#123;<br>        QStringList curRow;    <span class="hljs-comment">// å½“å‰è¯»åˆ°çš„è¡Œ</span><br>        <span class="hljs-comment">// å¯¹å½“å‰è¡Œçš„æ¯ä¸€åˆ—éå†</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; range.<span class="hljs-built_in">columnCount</span>(); ++i)<br>            curRow.<span class="hljs-built_in">append</span>(formula(range.<span class="hljs-built_in">topRow</span>() + i,<br>                                  range.<span class="hljs-built_in">leftColumn</span>() + j));<br>        rows.<span class="hljs-built_in">append</span>(curRow);<br>    &#125;<br>    <span class="hljs-built_in">qStableSort</span>(rows.<span class="hljs-built_in">begin</span>(), rows.<span class="hljs-built_in">end</span>(), compare);<br>    <span class="hljs-comment">// æŠŠè¡Œåˆ—è¡¨æ”¾å›åŸä½ç½®</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; range.<span class="hljs-built_in">rowCount</span>(); ++i) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; range.<span class="hljs-built_in">columnCount</span>(); ++j)<br>            <span class="hljs-built_in">setFormula</span>(range.<span class="hljs-built_in">topRow</span>() + i,<br>                       range.<span class="hljs-built_in">leftColumn</span>() + j,<br>                       rows[i][j]);<br>    &#125;<br>    <span class="hljs-built_in">clearSelection</span>();    <span class="hljs-comment">// æ’åºå®Œæ¸…é™¤é€‰ä¸­</span><br>    <span class="hljs-built_in">somethingChanged</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="4-3-6-è¡¨æ ¼çš„å…¬å¼è®¡ç®—å®ç°"><a href="#4-3-6-è¡¨æ ¼çš„å…¬å¼è®¡ç®—å®ç°" class="headerlink" title="4.3.6 è¡¨æ ¼çš„å…¬å¼è®¡ç®—å®ç°"></a>4.3.6 è¡¨æ ¼çš„å…¬å¼è®¡ç®—å®ç°</h3><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œ<code>HolySheet</code> çš„å…¨éƒ¨è¦æ±‚éƒ½å®ç°å®Œæ¯•ï¼Œç°åœ¨è¿›è¡Œ <code>Cell</code> çš„å®šä¹‰å’Œå®ç°ï¼Œä¸€ä¸¾è§£å†³å…¬å¼è®¡ç®—é—®é¢˜ã€‚</p>
<p>æ ¹æ®ä¸Šé¢ <code>HolySheet</code> ç±»å¯¹äº <code>Cell</code> çš„è¯·æ±‚ï¼Œ<code>Cell</code> çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: Cell.h</span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QtWidgets/QTableWidgetItem&gt;</span></span><br><br><span class="hljs-comment">// ç”±äº Cell ç±»ä¸éœ€è¦ä¿¡å·-æ§½æœºåˆ¶ï¼Œæ‰€ä»¥å°±ä¸éœ€è¦ Q_OBJECT å®</span><br><span class="hljs-comment">// æ›´ä½•å†µ QTableWidgetItem å¹¶ä¸æ˜¯ç”± QObject æ´¾ç”Ÿè€Œæ¥</span><br><span class="hljs-comment">// è¿™ä¹Ÿæ˜¯ä¸ºäº†è®©é¡¹ï¼ˆitemï¼‰çš„å¼€é”€å°½å¯èƒ½åœ°ä½ã€è®¿é—®æ•ˆç‡å°½å¯èƒ½åœ°é«˜</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cell</span> : <span class="hljs-keyword">public</span> QTableWidgetItem &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Cell</span>();<br>    <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setFormula</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; formula)</span></span>;<br>    <span class="hljs-function">QString <span class="hljs-title">formula</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setDirty</span><span class="hljs-params">()</span></span>;<br>    <br>    <span class="hljs-comment">// ä»¥ä¸‹æ²¡è§è¿‡çš„å‡½æ•° / æ•°æ®æˆå‘˜ï¼Œä¼šåœ¨åé¢è®²å®ƒä»¬çš„å«ä¹‰</span><br>    <span class="hljs-function">QTableWidgetItem* <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setData</span><span class="hljs-params">(<span class="hljs-type">int</span> role, <span class="hljs-type">const</span> QVariant&amp; value)</span> <span class="hljs-keyword">override</span></span>;<br>    <span class="hljs-function">QVariant <span class="hljs-title">data</span><span class="hljs-params">(<span class="hljs-type">int</span> role)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span>;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function">QVariant <span class="hljs-title">value</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <br>    <span class="hljs-comment">// å½“å‰ç¼“å­˜çš„å•å…ƒæ ¼çš„å€¼</span><br>    <span class="hljs-keyword">mutable</span> QVariant cachedValue;<br>    <span class="hljs-comment">// è¿™ä¸ªå€¼æ˜¯å¦ä¸æ˜¯æœ€æ–°çš„ï¼Œå³ï¼šæ˜¯å¦éœ€è¦æ›´æ–°</span><br>    <span class="hljs-keyword">mutable</span> <span class="hljs-type">bool</span> cacheIsDirty;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>é¦–å…ˆè§£é‡ŠåŸºç¡€ C++ çŸ¥è¯†ï¼ˆå’Œ Qt æ²¡å…³ç³»ï¼‰â€”â€”ä»€ä¹ˆæ˜¯ <code>mutable</code> å…³é”®å­—ã€‚åœ¨ C++ é¢å‘å¯¹è±¡ä¸­ï¼Œ<code>const(constant)</code> å’Œ <code>mutable</code> æ˜¯ä¸€å¯¹å«ä¹‰æ°å¥½ç›¸åçš„å…³é”®å­—ã€‚</p>
<p>è€ƒè™‘è¿™ä¸ªåœºæ™¯ï¼š<strong>å¦‚æœæˆ‘æœ‰ä¸ªå‡½æ•°ï¼ˆ<code>func_1</code>ï¼‰ï¼Œåªæƒ³æ”¹å˜ä¸€ä¸ªæ•°æ®æˆå‘˜ï¼ˆ<code>A</code>ï¼‰ï¼Œå…¶ä»–ï¼ˆ<code>B/C/D/...</code>ï¼‰å˜é‡éƒ½ä¸å…è®¸å®ƒæ”¹å˜ï¼Œæƒ³è¦ä¿æŠ¤èµ·æ¥ã€‚</strong>ä¸ºäº†<strong>å¼ºè°ƒ</strong> â€œä¿æŠ¤æ•°æ®æˆå‘˜â€ è¿™ä¸€è¦æ±‚ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæƒ³æŠŠ <code>func_1</code> å£°æ˜ä¸º <code>const</code> å¸¸é‡å‡½æ•°ï¼Œä½†æ˜¯æ€ä¹ˆèƒ½æ”¹åˆ° <code>A</code> å‘¢ï¼Ÿ</p>
<p>æ²¡é”™ï¼æŠŠ <code>A</code> å£°æ˜ä¸º <code>mutable</code> å˜é‡å°±è¡Œäº†ï¼<strong>æ‰€è°“ <code>mutable</code> å…³é”®å­—çš„ä½œç”¨å°±æ˜¯ï¼šç±»ä¸­çš„ã€å‡¡è¢«æ­¤å…³é”®å­—ä¿®é¥°çš„æ•°æ®æˆå‘˜ï¼Œéƒ½å¯ä»¥è¢«å¸¸é‡å‡½æ•°ä¿®æ”¹ï¼</strong>è¿™æ ·åšå¯ä»¥èµ·åˆ°ä¸€ä¸ªä½œç”¨ï¼šå¼ºè°ƒ â€œè¿™ä¸ªé™æ€å‡½æ•°ä¸ä¼šä¿®æ”¹å…¶ä»–ä»»ä½•æ•°æ®â€ çš„ç‰¹ç‚¹ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// File: Cell.cpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Cell.h&quot;</span></span><br><br>Cell::<span class="hljs-built_in">Cell</span>() &#123; <span class="hljs-built_in">setDirty</span>(); &#125;    <span class="hljs-comment">// æ„é€ å‡½æ•°æ„æ€æ˜¯å•å…ƒæ ¼åˆšåˆ›å»ºæ—¶ï¼Œå°±éœ€è¦æ›´æ–°</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Cell::setDirty</span><span class="hljs-params">()</span> </span>&#123; cacheIsDirty = <span class="hljs-literal">true</span>; &#125;    <span class="hljs-comment">// å½“å‰ cell è®¾ç½®éœ€è¦æ›´æ–°</span><br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œæ²¡å¿…è¦ä¼ é€’çˆ¶å¯¹è±¡ï¼Œå› ä¸ºå½“ä½  <code>new</code> ä¸€ä¸ª <code>Cell</code> å¯¹è±¡ï¼Œå¹¶ä¸”ç”¨ <code>setItem()</code> æ’å…¥åˆ° <code>QTableWidget</code> å½“ä¸­æ—¶ï¼Œ<code>QTableWidget</code> ä¼š<strong>è‡ªåŠ¨è·å¾—å¯¹è¯¥ <code>Cell</code> å¯¹è±¡çš„æ§åˆ¶æƒï¼Œä¹Ÿä¼šè‡ªåŠ¨å¸®æ‚¨ææ„</strong>ã€‚</p>
<h3 id="4-3-7-è¡¥å……ï¼šQTableWidgetItem-ç±»çš„æœºç†ç®€ä»‹"><a href="#4-3-7-è¡¥å……ï¼šQTableWidgetItem-ç±»çš„æœºç†ç®€ä»‹" class="headerlink" title="4.3.7 è¡¥å……ï¼šQTableWidgetItem ç±»çš„æœºç†ç®€ä»‹"></a>4.3.7 è¡¥å……ï¼š<code>QTableWidgetItem</code> ç±»çš„æœºç†ç®€ä»‹</h3><p>ç°åœ¨ä¹Ÿä¸å¾—ä¸å›ç­”ï¼Œä¹‹å‰æå‡ºçš„é—®é¢˜ï¼š<strong>â€œä¸ºä»€ä¹ˆåœ¨ <code>HolySheet</code>ã€<code>Cell</code> é‡Œé¢éƒ½åªæœ‰ <code>setFormula</code>ï¼Œæ²¡æœ‰ <code>setText</code>ï¼Œä½†å´è¯´ â€˜å…¬å¼å’Œæ–‡æœ¬åˆ†å¼€å­˜å‚¨â€™ å‘¢ï¼Ÿâ€</strong></p>
<p>å®é™…ä¸Šï¼Œåœ¨ä¸Šé¢ <code>Cell.h</code> çš„å£°æ˜ä¸­ä¹Ÿèƒ½çœ‹åˆ°ï¼Œ<code>Cell</code> å’Œå®ƒçš„çˆ¶ç±»éƒ½é‡‡ç”¨ <strong><code>role</code> å‚æ•°æ¥æ§åˆ¶ <code>Data</code> çš„æ–¹æ³•ï¼Œè€Œè¿™å°±æ˜¯ <code>QTableWidgetItem</code> çš„è®¾è®¡ã€‚</strong></p>
<p>åœ¨ Qt ä¸­æœ‰å‡ ä¸ªæšä¸¾å€¼ï¼š<code>Qt::DisplayRole</code>ã€<code>Qt::EditRole</code>ã€<code>Qt::TextAlignmentRole</code>ï¼Œç”¨æ¥æŒ‡å®š <code>QTableWidgetItem</code> å­˜å‚¨æ•°æ®çš„ â€œä¸åŒæ¨¡å¼â€ï¼š</p>
<ul>
<li><code>Qt::EditRole</code> è¡¨ç¤ºç¼–è¾‘æ¨¡å¼ï¼ŒæŒ‡çš„æ˜¯å•å…ƒæ ¼çš„åŸå§‹å†…å®¹ï¼ˆrawï¼‰ï¼›</li>
<li><code>Qt::DisplayRole</code> è¡¨ç¤ºæ˜¾ç¤ºæ¨¡å¼ï¼ŒæŒ‡çš„æ˜¯å•å…ƒæ ¼çš„æ˜¾ç¤ºå†…å®¹ï¼›</li>
<li><code>Qt::TextAlignmentRole</code> è¡¨ç¤ºå¯¹é½æ ·å¼æ¨¡å¼ï¼ŒæŒ‡çš„æ˜¯å•å…ƒæ ¼çš„å¯¹é½æ–¹å¼ï¼›</li>
</ul>
<p>æ— è®ºæ˜¯åŸå¼å†…å®¹ï¼Œè¿˜æ˜¯æ˜¾ç¤ºå†…å®¹ï¼Œéƒ½ç”± <code>QTableWidgetItem::data(Qt::role)</code> è¿™ä¸ªåŸç”ŸåŸç”Ÿå‡½æ•°ç»Ÿä¸€è¿”å›ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>QTableWidgetItem</code> çš„æ˜¾ç¤ºå†…å®¹å’ŒåŸå§‹å†…å®¹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</p>
<p><strong>ä½†æ˜¯æˆ‘ä»¬çš„ç¨‹åºæ˜¯æ¨¡ä»¿ Excel è¡¨æ ¼ï¼Œè¦å¤„ç†å…¬å¼â€”â€”äºæ˜¯ä¹ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰äº† <code>data(Qt::role)</code> å‡½æ•°ï¼Œä½¿å¾—å…¬å¼æ‰€åœ¨å•å…ƒæ ¼çš„æ˜¾ç¤ºå†…å®¹å’ŒåŸå§‹å†…å®¹å¯èƒ½ä¸ä¸€æ ·</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QVariant <span class="hljs-title">Cell::data</span><span class="hljs-params">(<span class="hljs-type">int</span> role)</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-comment">// è°ƒç”¨æ–¹æƒ³è¦è·å¾—æ˜¾ç¤ºæ¨¡å¼ï¼ˆå·²è®¡ç®—ï¼‰çš„ä¿¡æ¯</span><br>    <span class="hljs-keyword">if</span> (role == Qt::DisplayRole) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">value</span>().<span class="hljs-built_in">isValid</span>()) <span class="hljs-keyword">return</span> <span class="hljs-built_in">value</span>().<span class="hljs-built_in">toString</span>();<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;####&quot;</span>;    <span class="hljs-comment">// è®¡ç®—å¤±è´¥ï¼Œä¸ç¬¦è¯­æ³•çš„å…¬å¼</span><br>    &#125;<br>    <span class="hljs-comment">// è°ƒç”¨æ–¹æƒ³è¦è·å¾—æ˜¾ç¤ºæ¨¡å¼ä¸­ï¼Œå†…å®¹ï¼ˆå·²è®¡ç®—ï¼‰æ˜¾ç¤ºçš„æ ¼å¼</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (role == Qt::TextAlignmentRole) &#123;<br>        <span class="hljs-comment">// å¦‚æœé‡Œé¢å­˜çš„æ˜¯å­—ç¬¦ä¸²ï¼ˆå·²è®¡ç®—ï¼‰</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">value</span>().<span class="hljs-built_in">type</span>() == QVariant::String) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(Qt::AlignLeft | Qt::AlignVCenter); <span class="hljs-comment">//å‚ç›´å±…ä¸­ï¼Œå·¦å¯¹é½</span><br>        &#125;<br>        <span class="hljs-comment">// å¦‚æœé‡Œé¢å­˜çš„æ˜¯æ•°æ®ï¼ˆå·²è®¡ç®—ï¼‰</span><br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(Qt::AlignRight | Qt::AlignVCenter);<span class="hljs-comment">//å‚ç›´å±…ä¸­ï¼Œå³å¯¹é½</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// è°ƒç”¨æ–¹æƒ³è¦è·å¾—è¡¨æ ¼çš„åŸå§‹å†…å®¹</span><br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œå°†æ ¼å­ä¸­çš„æ‰€æœ‰æ•°æ®åŸå°ä¸åŠ¨åœ°ç»™è°ƒç”¨æ–¹</span><br>        <span class="hljs-keyword">return</span> QTableWidgetItem::<span class="hljs-built_in">data</span>(role);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>é¦–å…ˆè§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ <code>if (value().isValid())</code>ï¼šè¿™ä¸ª <code>Cell::value()</code> æ˜¯ç­‰ä¼šä¼šå®ç°çš„è‡ªå®šä¹‰å‡½æ•°ï¼Œ<strong>ç”¨æ¥ä» EditRole çš„åŸå§‹å†…å®¹è®¡ç®—å‡º DisplayRole çš„å±•ç¤ºå†…å®¹ï¼Œæ¢è¨€ä¹‹ï¼Œè¿™ä¸ªå‡½æ•°ç”¨æ¥è®¡ç®—å…¬å¼çš„ï¼ï¼ï¼</strong></p>
<p>åªæœ‰å½“ â€œæ–‡æœ¬æ˜¯å…¬å¼ï¼Œå¹¶ä¸”ä¸ç¬¦åˆè¯­æ³•â€œçš„ï¼Œ<code>value()</code> å‡½æ•°æ‰ä¼šè¿”å› <code>QVariant()</code>ï¼Œå…¶ä»–çš„æ— è®ºæ˜¯<strong>çº¯æ–‡æœ¬ï¼ˆåŸå°ä¸åŠ¨ï¼‰</strong>ï¼Œè¿˜æ˜¯<strong>ç¬¦åˆè¯­æ³•çš„å…¬å¼ï¼ˆè§£æå¾—åˆ°ç­”æ¡ˆï¼‰</strong>éƒ½ä¼šè¿”å›æœ‰æ•°æ®çš„ <code>QVariant</code> å®ä¾‹ã€‚</p>
<p>å¤§å®¶å¯èƒ½ä¼šå¥‡æ€ªï¼Œ<code>QVariant::isValid()</code> æ˜¯ç”¨æ¥åˆ¤æ–­ä»€ä¹ˆæœ‰æ•ˆçš„ï¼Ÿäº‹å®ä¸Šï¼Œ<strong>åªæœ‰ä½¿ç”¨ <code>QVariant</code> çš„é»˜è®¤æ„é€ å‡½æ•°æ„é€ ï¼ˆæ— å‚æ•°ï¼‰å‡ºæ¥çš„å®ä¾‹ï¼Œå…¶ <code>isValid()</code> è¿”å›å€¼æ‰æ˜¯ <code>false</code>ï¼Œå…¶ä»–å«æœ‰æ•°æ®çš„å®ä¾‹éƒ½æ˜¯ <code>true</code></strong>ã€‚</p>
<p>ç°åœ¨å°±èƒ½è§£é‡Š â€œä¸ºä»€ä¹ˆåªæœ‰ <code>setFormula</code> æ²¡æœ‰ <code>setText</code>â€ çš„é—®é¢˜ã€‚</p>
<p>å› ä¸º <code>QTableWidgetItem::text()</code> æ˜¯åŸç”Ÿå‡½æ•°ï¼ˆè¿™é‡Œ <code>Cell</code> ç±»æ²¡æœ‰è¦†å†™ï¼Œå› ä¸ºæ»¡è¶³è¦æ±‚ï¼‰ï¼Œåœ¨å†…éƒ¨ä¼šè°ƒç”¨ <code>QTableWidgetItem::data(Qt::DisplayRole)</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š<strong><code>text()</code> è·å–çš„æ˜¯ â€œå±•ç¤ºæ¨¡å¼â€ çš„æ•°æ®ï¼Œ<code>formula()</code> è·å–çš„æ˜¯ åŸå§‹æ•°æ®</strong>ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦è®¾ç½®åŸå§‹æ•°æ®ï¼ˆ<code>Cell::setFormula</code>ï¼Œæ›´åº•å±‚è°ƒç”¨ <code>Cell::setData</code>ï¼‰ã€è®¾ç½®åŸå§‹æ•°æ®çš„è®¡ç®—æ–¹å¼ï¼ˆ<code>Cell::value</code> åŠç›¸å…³å‡½æ•°ï¼‰ï¼Œå°±èƒ½è®©å±•ç¤ºæ¨¡å¼ã€åŸå§‹å†…å®¹å„è‡ªå‘ˆç°å‡ºæˆ‘ä»¬æƒ³è¦çš„å†…å®¹ï¼</p>
<p>æ—¢ç„¶æˆ‘ä»¬ç°åœ¨çŸ¥é“äº† <code>setFormula</code>ã€<code>formula</code>ã€<code>value</code>ã€ <code>setData</code> çš„ä½œç”¨ï¼Œç°åœ¨æˆ‘ä»¬åˆ†åˆ«å®ç°å®ƒä»¬ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Cell::setFormula</span><span class="hljs-params">(<span class="hljs-type">const</span> QString&amp; formula)</span> </span>&#123;<br>    <span class="hljs-comment">// è°ƒç”¨åº•å±‚è‡ªå®šä¹‰çš„ data è®¾ç½®åŸå§‹å†…å®¹</span><br>    <span class="hljs-built_in">setData</span>(Qt::EditRole, formula);<br>&#125;<br><br><span class="hljs-function">QString <span class="hljs-title">Cell::formula</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-comment">// è°ƒç”¨è‡ªå®šä¹‰çš„ data ä»¥ QString å½¢å¼è¿”å›åŸå§‹æ•°æ®</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">data</span>(Qt::EditRole).<span class="hljs-built_in">toString</span>();<br>&#125;<br><br><span class="hljs-comment">// è¦†å†™åº•å±‚çš„ QTableWidgetItem::setDataï¼Œæ·»åŠ ä¸€ä¸ª â€œæ ‡è®° dirtyâ€ çš„åŠŸèƒ½</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Cell::setData</span><span class="hljs-params">(<span class="hljs-type">int</span> role, <span class="hljs-type">const</span> QVariant&amp; value)</span> </span>&#123;<br>    <span class="hljs-comment">// è®¾ç½®æ•°æ®çš„åŠŸèƒ½å’Œçˆ¶ç±»ä¸€æ ·</span><br>    QTableWidgetItem::<span class="hljs-built_in">setData</span>(role, value);<br>    <span class="hljs-comment">// å¢æ·»çš„æ˜¯æ ‡è®°åŠŸèƒ½</span><br>    <span class="hljs-keyword">if</span> (role == Qt::EditRole)<br>        <span class="hljs-built_in">setDirty</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å¯¹äº <code>Cell::setData</code> çš„ <code>if (role == Qt::EditRole)</code>ï¼Œæœ‰åŒå­¦å¯èƒ½ä¼šé—®ï¼Œä¸ºå•¥è¦åˆ¤æ–­ä¸€ä¸‹ï¼Ÿæ—¢ç„¶ä¿®æ”¹äº†ï¼Œç›´æ¥ <code>setDirty</code> ä¸å°±è¡Œï¼Ÿå…¶å®ä¸æ˜¯è¿™æ ·ã€‚</p>
<p>å‰é¢è¯´äº†ï¼Œç”¨æˆ·åªèƒ½æ”¹åŸå§‹æ•°æ® ï¼ˆ<code>Qt::EditRole</code>ï¼‰ï¼›è€Œå±•ç¤ºæ•°æ®ï¼ˆ<code>Qt::DisplayRole</code>ï¼‰æ˜¯ç¨‹åºå†…éƒ¨è®¡ç®—å…¬å¼ / çº¯æ–‡æœ¬çš„æ—¶å€™æ‰ä¼šæ›´æ”¹ã€‚<code>setDirty</code> <strong>åªéœ€è¦ï¼Œä¹Ÿåªèƒ½</strong> æ ‡è®°ç”¨æˆ·çš„ä¿®æ”¹è¡Œä¸ºã€‚ä¸€æ—¦æ ‡è®°äº†æœºå™¨çš„ä¿®æ”¹è¡Œä¸ºï¼Œè½»åˆ™æµªè´¹ç³»ç»Ÿèµ„æºï¼Œé‡åˆ™ä¼šé™·å…¥ â€œæœºå™¨æ›´æ–°å±•ç¤ºæ•°æ® -&gt; <code>setDirty</code> -&gt; æœºå™¨æ›´æ–°å±•ç¤ºæ•°æ® -&gt; â€¦â€ çš„<strong>æ­»å¾ªç¯</strong>ä¸­ã€‚</p>
<p>ç»§ç»­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// è¿™é‡Œå·ä¸ªæ‡’ï¼Œç”¨æˆ‘å¾ˆæ—©ä»¥å‰å†™çš„ç®€æ˜“è®¡ç®—å™¨ç¨‹åºï¼Œæ”¯æŒ+-*/^()è¿ç®—</span><br><span class="hljs-comment">// ç®€æ˜“è®¡ç®—å™¨ä¸åœ¨è¿™é‡Œå±•ç¤ºï¼Œè¯¦æƒ…è¯·çœ‹é¡¹ç›®æºç </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;calc.h&quot;</span></span><br><br><span class="hljs-comment">// value() åº•å±‚å‡½æ•°ï¼Œç”¨äºè®¡ç®—åŸå§‹æ•°æ®</span><br><span class="hljs-comment">// æ˜¯çº¯æ–‡æœ¬ / ç¬¦åˆè¯­æ³•çš„å…¬å¼ -&gt; return QVariant(è®¡ç®—ç»“æœ)</span><br><span class="hljs-comment">// æ˜¯ä¸ç¬¦åˆè¯­æ³•çš„å…¬å¼ -&gt; return QVariant()ï¼Œå¯ä»¥è¢« isValid() å‘ç°</span><br><span class="hljs-function">QVariant <span class="hljs-title">Cell::value</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (cacheIsDirty) &#123;<br>        cacheIsDirty = <span class="hljs-literal">false</span>;<br>        <br>        QString formulaStr = formula();<br>        <span class="hljs-keyword">if</span> (formulaStr.<span class="hljs-built_in">startsWith</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>))    <span class="hljs-comment">// å•å¼•å·å¼•èµ·çš„å†…å®¹ä»£è¡¨çº¯æ–‡æœ¬</span><br>            cachedValue = formulaStr.<span class="hljs-built_in">mid</span>(<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (formulaStr.<span class="hljs-built_in">startsWith</span>(<span class="hljs-string">&#x27;=&#x27;</span>)) &#123;    <span class="hljs-comment">// ä»¥ç­‰å·å¼€å¤´çš„æ˜¯å…¬å¼</span><br>            cachedValue = <span class="hljs-built_in">QVariant</span>();<br>            <span class="hljs-comment">// å°†ä¸­ç¼€è¡¨è¾¾å¼ä¸­æ‰€æœ‰å˜é‡ï¼ˆæ­£åˆ™å¼å¦‚ä¸‹ï¼‰å…¨éƒ¨é€’å½’æ›¿æ¢ä¸ºå·²è®¡ç®—å†…å®¹</span><br>            <span class="hljs-function">QRegularExpression <span class="hljs-title">exp</span><span class="hljs-params">(<span class="hljs-string">&quot;([a-zA-Z][1-9][0-9]&#123;0,2&#125;)&quot;</span>)</span></span>;<br>            QRegularExpressionMatch curMatch;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>                curMatch = exp.<span class="hljs-built_in">match</span>(formulaStr);<br>                <span class="hljs-keyword">if</span> (!curMatch.<span class="hljs-built_in">hasMatch</span>()) <span class="hljs-keyword">break</span>;<br>                QString var = curMatch.<span class="hljs-built_in">captured</span>(<span class="hljs-number">1</span>);<br>                QChar tmp = var[<span class="hljs-number">0</span>] - <span class="hljs-string">&#x27;A&#x27;</span>;<br>                <span class="hljs-type">int</span> column = tmp.<span class="hljs-built_in">toInt</span>(), row = var.<span class="hljs-built_in">mid</span>(<span class="hljs-number">1</span>).<span class="hljs-built_in">toInt</span>() - <span class="hljs-number">1</span>;<br>                Cell* varCell = <span class="hljs-built_in">static_cast</span>&lt;Cell*&gt;(<br>                    <span class="hljs-built_in">tableWidget</span>()-&gt;<span class="hljs-built_in">item</span>(row, column)<br>                );<br>                QString cur;<br>                <span class="hljs-keyword">if</span> (varCell) cur = varCell-&gt;<span class="hljs-built_in">text</span>();    <span class="hljs-comment">// é€’å½’æ›¿æ¢å†…å®¹</span><br>                <span class="hljs-keyword">else</span> cur = <span class="hljs-string">&quot;0.0&quot;</span>;<br>                formulaStr.<span class="hljs-built_in">replace</span>(<br>                    formulaStr.<span class="hljs-built_in">indexOf</span>(var),    <span class="hljs-comment">// offset</span><br>                    var.<span class="hljs-built_in">size</span>(),                    <span class="hljs-comment">// length</span><br>                    cur                            <span class="hljs-comment">// new string</span><br>                );<br>            &#125;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-function">calc <span class="hljs-title">calculator</span><span class="hljs-params">(formulaStr.toStdString().c_str())</span></span>;<br>                cachedValue = calculator.<span class="hljs-built_in">getResult</span>();<br>            &#125;<br>            <span class="hljs-built_in">catch</span> (exprErr err) &#123;    <span class="hljs-comment">// å…¬å¼è®¡ç®—é”™è¯¯</span><br>                QMessageBox::<span class="hljs-built_in">warning</span>(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">tr</span>(<span class="hljs-string">&quot;HolySheet&quot;</span>),<br>                                    <span class="hljs-built_in">tr</span>(err.<span class="hljs-built_in">what</span>()));<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;    <span class="hljs-comment">// æ˜¯çº¯æ–‡æœ¬ï¼Œä½†ä¸æ¸…æ¥šæ˜¯ä¸æ˜¯çº¯æ•°å­—</span><br>            <span class="hljs-type">bool</span> ok;    <span class="hljs-comment">//èƒ½å¦è½¬æ¢ä¸ºæ•°å­—</span><br>            <span class="hljs-type">double</span> d = formulaStr.<span class="hljs-built_in">toDouble</span>(&amp;ok);<br>            <span class="hljs-keyword">if</span> (ok) cachedValue = d;        <span class="hljs-comment">// èµ‹å€¼ä¸ºåŒç²¾åº¦æµ®ç‚¹æ•°</span><br>            <span class="hljs-keyword">else</span> cachedValue = formulaStr;    <span class="hljs-comment">// åªèƒ½ä½œä¸ºå­—ç¬¦ä¸²</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> cachedValue;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æœ€åå¯èƒ½éœ€è¦è¦†å†™ä¸€ä¸ªçˆ¶ç±»é‡Œçš„å‡½æ•° <code>QTableWidget::clone()</code>ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼Œå½“ç”¨æˆ·åœ¨è¡¨æ ¼ä¸­ä»æœªåˆ›å»ºè¿‡çš„å•å…ƒæ ¼ä¸­å†™å…¥æ•°æ®æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ <code>clone()</code> ä¼ é€’ç»™ä¹‹å‰çš„ <code>QTableWidget::setItemPrototype()</code>ï¼Œè¿™é‡Œéœ€è¦ç”¨ <code>Cell</code> ç±» <code>new</code>ï¼Œä¸èƒ½ç”¨çˆ¶ç±»æ¥ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">QTableWidgetItem* <span class="hljs-title">Cell::clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Cell</span>(*<span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™æ ·è¿”å›çš„è™½ç„¶æ˜¯çˆ¶ç±»æŒ‡é’ˆï¼Œä½†æ˜¯æŒ‡å‘å­ç±»çš„å¯¹è±¡ï¼Œåœ¨ <code>setItemPrototype</code> å‡½æ•°é‡Œä¼šè½¬æ¢å›å»ï¼Œæ‰€ä»¥æ»¡è¶³è¦æ±‚ã€‚</p>
<hr>
<p>è‡³æ­¤ï¼Œ<code>Cell</code>ã€<code>HolySheet</code> ç±»å·²ç»å…¨éƒ¨å®Œæˆï¼Œç°åœ¨åªéœ€è¦å›åˆ° <code>MainWindow</code> ä¸­ï¼ŒæŠŠå‰©ä¸‹è¿˜æ²¡åŠ å…¥çš„ä¸€äº› <code>Action</code> æ·»åŠ è¿›å»ï¼Œ<strong>æ•´ä¸ªç¨‹åºå°±å®Œæˆäº†</strong>ï¼</p>
<p>å¦‚æœä½ ä¸æ˜¯ IDE ç”¨æˆ·ï¼Œåˆ«å¿˜äº†å†™ä¸€å†™ <code>CMakeLists.txt/Makefile</code> æˆ–è€…è¿è¡Œè¿è¡Œ <code>qmake</code>ï¼ŒæŠŠé¡¹ç›®è·‘èµ·æ¥å§ ~</p>
<h2 id="4-4-ç« æœ«æ€»ç»“-amp-ä¸‹æ–‡é¢„å‘Š"><a href="#4-4-ç« æœ«æ€»ç»“-amp-ä¸‹æ–‡é¢„å‘Š" class="headerlink" title="4.4 ç« æœ«æ€»ç»“ &amp; ä¸‹æ–‡é¢„å‘Š"></a>4.4 ç« æœ«æ€»ç»“ &amp; ä¸‹æ–‡é¢„å‘Š</h2><p>ä¸‹é¢æ˜¯æœ¬äººæ€»ç»“çš„ Qt 5 ç±»å›¾ï¼Œå’Œä¸Šæ¬¡æ€»ç»“ç›¸æ¯”ï¼Œéå¸¸éå¸¸åœ°é•¿ã€‚éœ€è¦ <code>*.xmind/*.pdf/*.png</code> æ ¼å¼çš„åŒå­¦å¯ä»¥è”ç³»æœ¬äºº ~</p>
<p><img src="C4.png"></p>
<p><strong>åŒç³»åˆ—ä¸‹ä¸€ç¯‡æ–‡ç« é¢„å‘Šï¼šå°†ä¼šæ˜¯å…³äº Qt çš„ <code>event</code>ï¼ˆäº‹ä»¶ï¼‰ã€å›¾å½¢ç»˜åˆ¶ å’Œ æ¸¸æˆçš„å†…å®¹ã€‚</strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://sjtuxhw.top">SJTU-XHW</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://sjtuxhw.top/2023/08/16/%E4%BB%8EC-%E5%85%A5%E9%97%A8Qt%EF%BC%88%E4%BA%8C%EF%BC%89/">https://sjtuxhw.top/2023/08/16/%E4%BB%8EC-%E5%85%A5%E9%97%A8Qt%EF%BC%88%E4%BA%8C%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://sjtuxhw.top" target="_blank">SJTU-XHW's blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/myBlog/tags/Programming/">Programming</a><a class="post-meta__tags" href="/myBlog/tags/Qt/">Qt</a><a class="post-meta__tags" href="/myBlog/tags/C/">C++</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.sjtuxhw.top/cover_imgs/qt2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/myBlog/img/wechat_pay.jpg" target="_blank"><img class="post-qr-code-img" src="/myBlog/img/wechat_pay.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/myBlog/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/myBlog/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/myBlog/2023/08/30/%E4%BB%8EC-%E5%85%A5%E9%97%A8Qt%EF%BC%88%E4%B8%89%EF%BC%89/" title="ä»C++å…¥é—¨Qtï¼ˆä¸‰ï¼‰"><img class="cover" src="https://cdn.sjtuxhw.top/cover_imgs/qt3.jpg" onerror="onerror=null;src='/myBlog/img/404.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">ä»C++å…¥é—¨Qtï¼ˆä¸‰ï¼‰</div></div></a></div><div class="next-post pull-right"><a href="/myBlog/2023/08/07/2023-HDC-%E5%8F%82%E4%BC%9A%E7%AC%94%E8%AE%B0%E4%B8%8E%E6%84%9F%E6%82%9F/" title="2023 HDC å‚ä¼šç¬”è®°ä¸æ„Ÿæ‚Ÿ"><img class="cover" src="https://cdn.sjtuxhw.top/cover_imgs/2023-HDC.jpg" onerror="onerror=null;src='/myBlog/img/404.png'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">2023 HDC å‚ä¼šç¬”è®°ä¸æ„Ÿæ‚Ÿ</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/myBlog/2023/07/28/%E4%BB%8EC-%E5%85%A5%E9%97%A8Qt%EF%BC%88%E4%B8%80%EF%BC%89/" title="ä»C++å…¥é—¨Qtï¼ˆä¸€ï¼‰"><img class="cover" src="https://cdn.sjtuxhw.top/cover_imgs/qt1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-28</div><div class="title">ä»C++å…¥é—¨Qtï¼ˆä¸€ï¼‰</div></div></a></div><div><a href="/myBlog/2023/08/30/%E4%BB%8EC-%E5%85%A5%E9%97%A8Qt%EF%BC%88%E4%B8%89%EF%BC%89/" title="ä»C++å…¥é—¨Qtï¼ˆä¸‰ï¼‰"><img class="cover" src="https://cdn.sjtuxhw.top/cover_imgs/qt3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-30</div><div class="title">ä»C++å…¥é—¨Qtï¼ˆä¸‰ï¼‰</div></div></a></div><div><a href="/myBlog/2023/09/17/CSAPP-Notes-Part-1/" title="CSAPP Notes Part 1"><img class="cover" src="https://cdn.sjtuxhw.top/cover_imgs/csapp_123.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-17</div><div class="title">CSAPP Notes Part 1</div></div></a></div><div><a href="/myBlog/2023/11/11/CSAPP-Notes-Part-2/" title="CSAPP Notes Part 2"><img class="cover" src="https://cdn.sjtuxhw.top/cover_imgs/csapp_p2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-11</div><div class="title">CSAPP Notes Part 2</div></div></a></div><div><a href="/myBlog/2023/04/28/GNU-Tutor/" title="GNU-Tutor"><img class="cover" src="https://cdn.sjtuxhw.top/cover_imgs/GNU-Tutor.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-28</div><div class="title">GNU-Tutor</div></div></a></div><div><a href="/myBlog/2023/04/28/Java-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Java å­¦ä¹ ç¬”è®°ï¼ˆ1ï¼‰"><img class="cover" src="https://cdn.sjtuxhw.top/cover_imgs/java1.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-28</div><div class="title">Java å­¦ä¹ ç¬”è®°ï¼ˆ1ï¼‰</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/myBlog/img/favicon.ico" onerror="this.onerror=null;this.src='/myBlog/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">SJTU-XHW</div><div class="author-info__description">A blog to document learning and life</div></div><div class="card-info-data site-data is-center"><a href="/myBlog/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">33</div></a><a href="/myBlog/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">50</div></a><a href="/myBlog/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/SSRVodka"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/SSRVodka" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:sjtuxhw12345@sjtu.edu.cn" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://sjtuxhw.top/myBlog/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss" style="color: #a200ff;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">Thanks for visiting! â€|â€¢'-'â€¢) âœ§</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-4-%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84-Qt-%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE"><span class="toc-text">Chapter 4 ç¬¬ä¸€ä¸ªå®Œæ•´çš„ Qt å…¥é—¨é¡¹ç›®</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%88%9B%E5%BB%BA%E4%B8%BB%E7%AA%97%E5%8F%A3-UI"><span class="toc-text">4.1 åˆ›å»ºä¸»çª—å£ UI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E5%AD%90%E7%B1%BB%E5%8C%96-QMainWindow"><span class="toc-text">4.1.1 å­ç±»åŒ– QMainWindow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E5%AE%9E%E7%8E%B0%E8%8F%9C%E5%8D%95%E6%A0%8F%E3%80%81%E4%B8%8A%E4%B8%8B%E6%96%87%E8%8F%9C%E5%8D%95%E5%92%8C%E5%B7%A5%E5%85%B7%E6%A0%8F"><span class="toc-text">4.1.2 å®ç°èœå•æ ã€ä¸Šä¸‹æ–‡èœå•å’Œå·¥å…·æ </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-%E8%AE%BE%E7%BD%AE%E7%8A%B6%E6%80%81%E6%A0%8F"><span class="toc-text">4.1.3 è®¾ç½®çŠ¶æ€æ </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E4%B8%BB%E7%AA%97%E5%8F%A3%E7%9A%84%E5%BA%95%E5%B1%82%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0"><span class="toc-text">4.2 ä¸»çª—å£çš„åº•å±‚å‡½æ•°å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-File-%E8%8F%9C%E5%8D%95"><span class="toc-text">4.2.1 File èœå•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E4%B8%BB%E7%AA%97%E5%8F%A3%E8%B0%83%E7%94%A8-Dialog%EF%BC%9A%E6%A8%A1%E6%80%81%E5%92%8C%E9%9D%9E%E6%A8%A1%E6%80%81"><span class="toc-text">4.2.2 ä¸»çª—å£è°ƒç”¨ Dialogï¼šæ¨¡æ€å’Œéæ¨¡æ€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E8%AE%BE%E7%BD%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">4.2.3 è®¾ç½®çš„æŒä¹…åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-%E9%94%A6%E4%B8%8A%E6%B7%BB%E8%8A%B1%EF%BC%9A%E5%A4%9A%E6%96%87%E6%A1%A3%E6%A8%A1%E5%BC%8F"><span class="toc-text">4.2.4 é”¦ä¸Šæ·»èŠ±ï¼šå¤šæ–‡æ¡£æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-%E9%94%A6%E4%B8%8A%E6%B7%BB%E8%8A%B1%EF%BC%9A%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E7%94%BB%E9%9D%A2"><span class="toc-text">4.2.5 é”¦ä¸Šæ·»èŠ±ï¼šç¨‹åºå¯åŠ¨ç”»é¢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E7%A8%8B%E5%BA%8F%E4%B8%AD%E5%A4%AE%E7%AA%97%E5%8F%A3%E5%AE%9E%E7%8E%B0%EF%BC%9AQTableWidget"><span class="toc-text">4.3 ç¨‹åºä¸­å¤®çª—å£å®ç°ï¼šQTableWidget</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-%E8%A1%A8%E6%A0%BC%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-text">4.3.1 è¡¨æ ¼çš„å®šä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-%E8%A1%A8%E6%A0%BC%E7%9A%84-%E2%80%9C%E6%96%87%E6%9C%AC%E2%80%9D-%E5%92%8C-%E2%80%9C%E5%85%AC%E5%BC%8F%E2%80%9D"><span class="toc-text">4.3.2 è¡¨æ ¼çš„ â€œæ–‡æœ¬â€ å’Œ â€œå…¬å¼â€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-3-%E8%A1%A8%E6%A0%BC%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AD%98%E5%8F%96"><span class="toc-text">4.3.3 è¡¨æ ¼æ•°æ®çš„å­˜å–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-4-%E8%A1%A8%E6%A0%BC%E7%BC%96%E8%BE%91%E5%8A%9F%E8%83%BD"><span class="toc-text">4.3.4 è¡¨æ ¼ç¼–è¾‘åŠŸèƒ½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-5-%E8%A1%A8%E6%A0%BC%E7%9A%84%E6%8E%92%E5%BA%8F%E5%8A%9F%E8%83%BD"><span class="toc-text">4.3.5 è¡¨æ ¼çš„æ’åºåŠŸèƒ½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-6-%E8%A1%A8%E6%A0%BC%E7%9A%84%E5%85%AC%E5%BC%8F%E8%AE%A1%E7%AE%97%E5%AE%9E%E7%8E%B0"><span class="toc-text">4.3.6 è¡¨æ ¼çš„å…¬å¼è®¡ç®—å®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-7-%E8%A1%A5%E5%85%85%EF%BC%9AQTableWidgetItem-%E7%B1%BB%E7%9A%84%E6%9C%BA%E7%90%86%E7%AE%80%E4%BB%8B"><span class="toc-text">4.3.7 è¡¥å……ï¼šQTableWidgetItem ç±»çš„æœºç†ç®€ä»‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E7%AB%A0%E6%9C%AB%E6%80%BB%E7%BB%93-amp-%E4%B8%8B%E6%96%87%E9%A2%84%E5%91%8A"><span class="toc-text">4.4 ç« æœ«æ€»ç»“ &amp; ä¸‹æ–‡é¢„å‘Š</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/myBlog/2024/02/27/React%E6%A1%86%E6%9E%B6%E9%80%9F%E9%80%9A/" title="Reactæ¡†æ¶é€Ÿé€š"><img src="https://cdn.sjtuxhw.top/cover_imgs/react.jpg" onerror="this.onerror=null;this.src='/myBlog/img/404.png'" alt="Reactæ¡†æ¶é€Ÿé€š"/></a><div class="content"><a class="title" href="/myBlog/2024/02/27/React%E6%A1%86%E6%9E%B6%E9%80%9F%E9%80%9A/" title="Reactæ¡†æ¶é€Ÿé€š">Reactæ¡†æ¶é€Ÿé€š</a><time datetime="2024-02-27T07:30:41.000Z" title="å‘è¡¨äº 2024-02-27 15:30:41">2024-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/myBlog/2024/02/25/JavaScript%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-2/" title="JavaScriptå…¥é—¨ç¬”è®°-(2)"><img src="https://cdn.sjtuxhw.top/cover_imgs/javascript2.jpeg" onerror="this.onerror=null;this.src='/myBlog/img/404.png'" alt="JavaScriptå…¥é—¨ç¬”è®°-(2)"/></a><div class="content"><a class="title" href="/myBlog/2024/02/25/JavaScript%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0-2/" title="JavaScriptå…¥é—¨ç¬”è®°-(2)">JavaScriptå…¥é—¨ç¬”è®°-(2)</a><time datetime="2024-02-25T03:25:22.000Z" title="å‘è¡¨äº 2024-02-25 11:25:22">2024-02-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/myBlog/2024/02/20/JavaScript%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/" title="JavaScriptå…¥é—¨ç¬”è®°"><img src="https://cdn.sjtuxhw.top/cover_imgs/javascript.jpg" onerror="this.onerror=null;this.src='/myBlog/img/404.png'" alt="JavaScriptå…¥é—¨ç¬”è®°"/></a><div class="content"><a class="title" href="/myBlog/2024/02/20/JavaScript%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/" title="JavaScriptå…¥é—¨ç¬”è®°">JavaScriptå…¥é—¨ç¬”è®°</a><time datetime="2024-02-20T13:17:09.000Z" title="å‘è¡¨äº 2024-02-20 21:17:09">2024-02-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/myBlog/2024/01/15/%E6%B5%85%E6%9E%90-TTY-Subsystem/" title="æµ…æ TTY Subsystem"><img src="https://cdn.sjtuxhw.top/cover_imgs/tty.jpg" onerror="this.onerror=null;this.src='/myBlog/img/404.png'" alt="æµ…æ TTY Subsystem"/></a><div class="content"><a class="title" href="/myBlog/2024/01/15/%E6%B5%85%E6%9E%90-TTY-Subsystem/" title="æµ…æ TTY Subsystem">æµ…æ TTY Subsystem</a><time datetime="2024-01-14T23:12:02.000Z" title="å‘è¡¨äº 2024-01-15 07:12:02">2024-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/myBlog/2024/01/13/%E6%94%BE%E5%81%87%EF%BC%81%E5%90%90%E6%A7%BD%EF%BC%81/" title="æ”¾å‡ï¼åæ§½ï¼"><img src="https://cdn.sjtuxhw.top/cover_imgs/tease.jpg" onerror="this.onerror=null;this.src='/myBlog/img/404.png'" alt="æ”¾å‡ï¼åæ§½ï¼"/></a><div class="content"><a class="title" href="/myBlog/2024/01/13/%E6%94%BE%E5%81%87%EF%BC%81%E5%90%90%E6%A7%BD%EF%BC%81/" title="æ”¾å‡ï¼åæ§½ï¼">æ”¾å‡ï¼åæ§½ï¼</a><time datetime="2024-01-13T06:33:01.000Z" title="å‘è¡¨äº 2024-01-13 14:33:01">2024-01-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By SJTU-XHW  |  tech SJTU saves the world</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="https://beian.miit.gov.cn" rel="external nofollow noreferrer" id="beian" target="_blank">ICPå¤‡æ¡ˆï¼šæ²ªICPå¤‡2023012264-1å·</a> <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" rel="external nofollow noreferrer" target="_blank"> &nbsp;|&nbsp;&nbsp;æœ¬ç½‘ç«™ç”± <img src="/img/upCloud_logo.png" title="upcloud" alt="upcloud" height="30px"> æä¾›CDNåŠ é€Ÿ/äº‘å­˜å‚¨æœåŠ¡ </a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();" rel="external nofollow noreferrer"><i class="fa-solid fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();" rel="external nofollow noreferrer"><i class="fa-solid fa-arrow-rotate-right"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();" rel="external nofollow noreferrer"><i class="fa-solid fa-arrow-right"></i></a><a class="rightMenu-item" id="menu-radompage" href="javascript:window.location.href = window.location.origin;" rel="external nofollow noreferrer"><i class="fa-solid fa-house"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();" rel="external nofollow noreferrer"><i class="fa-solid fa-copy"></i><span>å¤åˆ¶</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:rmf.switchDarkMode();" rel="external nofollow noreferrer"><i class="fa-solid fa-circle-half-stroke"></i><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item" href="javascript:rmf.switchReadMode();" rel="external nofollow noreferrer"><i class="fa-solid fa-book"></i><span>é˜…è¯»æ¨¡å¼</span></a></div></div><div><script src="/myBlog/js/utils.js"></script><script src="/myBlog/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.sjtuxhw.top',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(init)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.sjtuxhw.top',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
      GLOBAL_CONFIG_SITE.isPost && getCount()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[å›¾ç‰‡]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[é“¾æ¥]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[ä»£ç ]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.sjtuxhw.top',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "æ— æ³•è·å–è¯„è®ºï¼Œè¯·ç¡®è®¤ç›¸å…³é…ç½®æ˜¯å¦æ­£ç¡®"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'æ²¡æœ‰è¯„è®º'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script src="/myBlog/js/jquery-3.7.0.min.js"></script><script src="/myBlog/js/rightmenu.js"></script><div class="aplayer no-destroy" data-id="6898044781" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"></div><script src="/myBlog/js/mourn.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="/myBlog/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/myBlog/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/myBlog/js/search/local-search.js"></script></div></div></body></html>